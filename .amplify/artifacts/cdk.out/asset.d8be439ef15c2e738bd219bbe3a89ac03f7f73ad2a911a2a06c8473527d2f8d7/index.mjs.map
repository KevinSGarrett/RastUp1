{
  "version": 3,
  "sources": ["../../../../node_modules/@aws-amplify/backend-function/src/lambda-shims/cjs_shim.ts", "../../../../amplify/functions/viewer/handler.ts"],
  "sourcesContent": ["import { createRequire } from 'node:module';\nimport path from 'node:path';\nimport url from 'node:url';\nglobal.require = createRequire(import.meta.url);\nglobal.__filename = url.fileURLToPath(import.meta.url);\nglobal.__dirname = path.dirname(__filename);\n", "// amplify/functions/viewer/handler.ts\r\n\r\ntype Viewer = {\r\n  id: string;\r\n  email: string | null;\r\n  groups: string[];\r\n  username?: string | null;\r\n  emailVerified?: boolean;\r\n  signInProvider?: string | null;\r\n  issuer?: string | null;\r\n};\r\n\r\nexport const handler = async (event: any): Promise<Viewer> => {\r\n  const identity = event?.identity ?? {};\r\n  const claims = identity?.claims ?? {};\r\n\r\n  // Core subject identifier (Cognito sub / username)\r\n  const sub =\r\n    identity?.sub ??\r\n    identity?.userId ??\r\n    claims.sub ??\r\n    claims[\"cognito:username\"] ??\r\n    \"anonymous\";\r\n\r\n  // Primary email, if present on the token\r\n  const email =\r\n    claims.email ??\r\n    claims[\"custom:email\"] ??\r\n    null;\r\n\r\n  // Username from identity / claims\r\n  const username =\r\n    identity?.username ??\r\n    claims[\"cognito:username\"] ??\r\n    claims.username ??\r\n    null;\r\n\r\n  // email_verified often comes as a boolean but can be a string\r\n  const emailVerifiedRaw =\r\n    claims[\"email_verified\"] ??\r\n    claims[\"custom:email_verified\"];\r\n\r\n  let emailVerified: boolean | undefined;\r\n  if (typeof emailVerifiedRaw === \"boolean\") {\r\n    emailVerified = emailVerifiedRaw;\r\n  } else if (typeof emailVerifiedRaw === \"string\") {\r\n    emailVerified = emailVerifiedRaw.toLowerCase() === \"true\";\r\n  }\r\n\r\n  // Groups \u2013 always return an array\r\n  const groupsRaw =\r\n    claims[\"cognito:groups\"] ??\r\n    identity?.groups ??\r\n    [];\r\n\r\n  const groups = Array.isArray(groupsRaw)\r\n    ? groupsRaw.map((g) => String(g))\r\n    : [];\r\n\r\n  // Best-effort provider + issuer detection\r\n  const signInProvider =\r\n    claims[\"cognito:identity_provider\"] ??\r\n    claims[\"cognito:authentication_provider\"] ??\r\n    null;\r\n\r\n  const issuer =\r\n    identity?.issuer ??\r\n    claims.iss ??\r\n    null;\r\n\r\n  return {\r\n    id: String(sub),\r\n    email: email ? String(email) : null,\r\n    groups,\r\n    username: username ? String(username) : null,\r\n    emailVerified,\r\n    signInProvider: signInProvider ? String(signInProvider) : null,\r\n    issuer: issuer ? String(issuer) : null,\r\n  };\r\n};\r\n"],
  "mappings": ";AAAA,OAAS,iBAAAA,MAAqB,cAC9B,OAAOC,MAAU,YACjB,OAAOC,MAAS,WAChB,OAAO,QAAUF,EAAc,YAAY,GAAG,EAC9C,OAAO,WAAaE,EAAI,cAAc,YAAY,GAAG,EACrD,OAAO,UAAYD,EAAK,QAAQ,UAAU,ECOnC,IAAME,EAAU,MAAOC,GAAgC,CAC5D,IAAMC,EAAWD,GAAO,UAAY,CAAC,EAC/BE,EAASD,GAAU,QAAU,CAAC,EAG9BE,EACJF,GAAU,KACVA,GAAU,QACVC,EAAO,KACPA,EAAO,kBAAkB,GACzB,YAGIE,EACJF,EAAO,OACPA,EAAO,cAAc,GACrB,KAGIG,EACJJ,GAAU,UACVC,EAAO,kBAAkB,GACzBA,EAAO,UACP,KAGII,EACJJ,EAAO,gBACPA,EAAO,uBAAuB,EAE5BK,EACA,OAAOD,GAAqB,UAC9BC,EAAgBD,EACP,OAAOA,GAAqB,WACrCC,EAAgBD,EAAiB,YAAY,IAAM,QAIrD,IAAME,EACJN,EAAO,gBAAgB,GACvBD,GAAU,QACV,CAAC,EAEGQ,EAAS,MAAM,QAAQD,CAAS,EAClCA,EAAU,IAAKE,GAAM,OAAOA,CAAC,CAAC,EAC9B,CAAC,EAGCC,EACJT,EAAO,2BAA2B,GAClCA,EAAO,iCAAiC,GACxC,KAEIU,EACJX,GAAU,QACVC,EAAO,KACP,KAEF,MAAO,CACL,GAAI,OAAOC,CAAG,EACd,MAAOC,EAAQ,OAAOA,CAAK,EAAI,KAC/B,OAAAK,EACA,SAAUJ,EAAW,OAAOA,CAAQ,EAAI,KACxC,cAAAE,EACA,eAAgBI,EAAiB,OAAOA,CAAc,EAAI,KAC1D,OAAQC,EAAS,OAAOA,CAAM,EAAI,IACpC,CACF",
  "names": ["createRequire", "path", "url", "handler", "event", "identity", "claims", "sub", "email", "username", "emailVerifiedRaw", "emailVerified", "groupsRaw", "groups", "g", "signInProvider", "issuer"]
}
