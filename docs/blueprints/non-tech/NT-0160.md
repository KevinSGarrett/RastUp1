<!-- id: NT-0160 | source: ProjectPlans\Combined_Master_PLAIN_Non_Tech_001.docx | range: 576000-580000 -->

eg: requested → accepted → in_progress → delivered → completed
→ (optional) disputed → resolved\
LBG: created → paid → all legs completed → closed\
Studio: onboarding → verified → reverify_due → suspended\
Promotion Campaign: active → paused → completed → archived\
Payout: queued → sent → failed (retryable) → settled\
Deposit: authorized → captured/voided → released (or retained by claim)

State changes emit §5.1 events (e.g., booking.accept, fin.payout.sent,
studio.verify.approve).

F\) Referential Integrity & Cascades

No hard deletes for: users, profiles, studios, legs, LBGs, charges,
payouts, docs. Use deleted_at (soft) or legal hold flags.

Cascade rules (logical, via jobs):

User merge (see §4.14.14): reparent all child records to the canonical
user_id; service_profile_ids either merge (same role) or remain distinct
(multibrand).

Profile delete (soft): remove from search; keep bookings/reviews intact
(historical).

Studio delete (soft): pause new bookings; preserve history; deposits
must be closed.

Foreign keys enforced in Silver/Gold models; Bronze is eventappendonly.

G\) MultiRole Modeling (why profiles matter)

Search & pricing live on service_profile_id, keeping criteria clean per
role (model vs photographer vs videographer vs creator).

Reviews and Rep Score compute per profile, then roll up to userlevel
(display both on profile).

Messaging is per booking; inbox groups threads by role ("Model Inbox",
"Photographer Inbox") for clarity.

H\) LBG Semantics (grouping multiple legs)

An LBG ties multiple legs (e.g., Talent + Studio) so the buyer can check
out once and receive a Group Receipt (see §4.12).

Cancel/Dispute is legscoped; the other leg remains intact. Group status
reflects all legs.

Payments: one charge_id at checkout linked to lbg_id, lineitems to each
booking_leg_id.

Receipts & Docs: each leg has its own SOW/Release; group receipt links
both.

I\) Indexing & Partition Hints (warehouse view)

Facts partitioned by dt and clustered by city_id, role, lbg_id or
booking_leg_id (per table).

Dim tables (SCD2) use valid_from/valid_to and natural keys
(service_profile_id, city_id).

Unique constraints:

review_id unique per booking_leg_id per reviewer.

promotion_campaign_id unique per service_profile_id per time window.

One active w9_id per payee user_id.

Join paths used by BI are fixed in §5.5 (star schema).

J\) Examples (how things join)

Example 1 --- Provider earnings for a week

fact_payout (Gold) → filter sent_at between dates & user_id = provider.

Drill into payout breakdown table → join booking_leg_id lines → join
dim_service_profile to show role and city.

Sum net cents; show legs & group them by lbg_id if needed.

Example 2 --- Reviews & Rep for a photographer

Get service_profile_id where role=photographer for user_id.

Join fact_booking_leg (completed legs) → review_id and ratings.

Compute profile Rep Score (timeweighted); separately compute user Rep
from all profiles.

Example 3 --- Group receipt

lbg_id → list legs in fact_booking_leg.

For each leg: join doc_id for SOW/Release, join fact_payment line items;
union to build group totals.

K\) Validation Rules (loadtime checks)

A booking_leg_id must have: buyer user_id, provider service_profile_id,
city_id, start_at \< end_at, and one state at a time.

A charge_id linked to an lbg_id must reconcile to the sum of included
leg lines ± buyer fee/tax.

A review_id must reference a completed leg and match the buyer on that
leg.

A deposit_id must reference a studio leg.

A form1099_id must map to an eligible payee and the sum of payouts for
that tax year.

L\) Acceptance Criteria (mark §5.2 FINAL)

ID catalog (names, prefixes, examples) published and used consistently
by all services & events.

Entity graph documented with cardinalities; enforced via Silver/Gold FK
tests.

LBG semantics implemented: legs roll up, payments group at checkout,
receipts/doc links per leg + group.

Multirole separation: search/reviews/rep attached to service_profile_i