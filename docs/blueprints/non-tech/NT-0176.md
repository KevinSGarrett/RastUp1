<!-- id: NT-0176 | source: ProjectPlans\Combined_Master_PLAIN_Non_Tech_001.docx | range: 633600-637600 -->

eatable.

A\) Scope & Objectives

Where we test: SDK/Edge → Bus → Bronze → Silver → Gold → Semantic layer
(metrics) → BI/Exports.

What we test: Contracts, IDs & referential integrity, business
invariants, money & reconciliations, freshness & completeness, privacy &
masking, anomaly baselines.

How we act: Quarantine bad records, gate finance close, flag dashboards,
and page owners with clear runbooks.

B\) Layered Check Matrix (who/when/what)

C\) Test Categories & Examples (starter suite)

1\) Contract & Schema Tests (events)

Required fields present; types correct (money = int cents).

Enums valid: leg_role ∈ {talent, studio}; method ∈ {card, ach}.

No forbidden PII: raw email/phone/address; block at edge (already in
§5.1/§5.7).

Example (Edge validator rule)

If payload.email present → reject and log data.ingest.deny:
forbidden_pii.

2\) Identity & Referential Integrity

Every booking_leg_id in Silver must have a service_profile_id,
buyer_user_id, and city_id.

Every charge_id in Gold lines maps to an lbg_id and to existing legs for
line allocation.

No orphan docs: doc_id must reference an existing booking_leg_id.

Check SQL (Silver → Gold)

SELECT COUNT(\*) AS orphan_legs

FROM silver.fin_events f

LEFT JOIN gold.fact_booking_leg b ON f.booking_leg_id = b.booking_leg_id

WHERE f.event_name LIKE \'fin.%\' AND b.booking_leg_id IS NULL;

Threshold: orphan_legs = 0 (P1 if \>0).

3\) Business Invariants

Time windows: start_at \< end_at; accepted_at ≤ due_at (when
deliverables due).

Status transitions: No illegal jumps (e.g., declined → completed).

NSFW guard: When Safe Mode off for a buyer, paid placements must still
respect policy flags.

4\) Money & Reconciliation

Charge lines sum: Σ fact_payment_line.line_cents =
fact_payment.amount_cents.

Leg allocations: Σ perleg allocations (buyer_fee, tax, processor) =
parent totals (tolerance ≤ 1 cent per charge).

Payouts: Σ fact_payout_leg.net_to_provider_cents =
fact_payout.amount_cents.

Settlements recon: Daily Σ charges/refunds vs processor settlement file
(variance ≤ 0.5%).

Deposits: auth \>= capture + (void \| release); no negative balances.

5\) Freshness & Completeness

Ops freshness: Silver tables lag \< 15 min (p95).

Finance close: Gold finance complete by 06:00 local.

Completeness: For each day/city, \# of completed legs in Gold ≥ 99% of
Silver by 07:00 (after late arrivals).

6\) Privacy & Masking

Masked by default: Emails/phones in Gold must equal masked pattern;
verify no raw patterns via DLP scan.

Vault joins: Blocked in analyst contexts; any query touching
vault_pii.\* outside Tax/Legal → alert + deny.

7\) Statistical/Anomaly Baselines

Click invalid rate (Boost): expected \< 7%; \> 15% triggers P1
investigation.

Zero result rate spikes: baseline + 3σ; flag search regressions.

Rep score distribution weekly drift: JensenShannon distance \> threshold
→ review scoring pipeline.

Unit economics: Take rate dayoverday delta \> 2 p.p. → notify Finance &
Growth.

8\) Metrics Catalog Consistency (from §5.6)

Tile definition hash must match catalog; if not, show "Definition
changed" banner.

Ratios recomputed at query grain; no avgofaverages allowed (semantic
guard).

D\) Severity & Gating (what we block vs warn)

Gating rules:

Finance close blocked on P0 money checks; release requires signoff from
Finance lead.

Payouts job pauses automatically if negative net or variance breaches.

Promotions autothrottle if invalid clicks breach P1 threshold.

E\) Ownership, Frequency & Tooling

Ascode tests in repo (/dq/), versioned with data pipelines; owners: Data
Eng (pipelines), Finance (money rules), Analytics (semantic tests),
Privacy (PII/DLP).

Schedules:

Edge/Silver: continuous;

Gold finance: nightly;

Catalog/semantic: nightly + on deploy;

DLP: nightly;

Baselines: daily/weekly jobs.

Dashboards: Admin Analytics cockpit (§4.14.12) shows DQ status:
red/amber/green per table/metric; freshness gauges; recon variances; DLQ
counts.

Alerts: Slack + email routes from O