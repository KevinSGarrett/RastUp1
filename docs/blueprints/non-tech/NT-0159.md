<!-- id: NT-0159 | source: ProjectPlans\Combined_Master_PLAIN_Non_Tech_001.docx | range: 572400-576400 -->

h
examples.

CI gating for schema validation & "no breaking changes without new
name."

Sample payloads validated endtoend into Bronze; test tables show
expected rows.

K\) Why this works

Stable for consumers (dashboards, finance, ML) because producers evolve
additively.

Auditable because every event has consistent IDs, timestamps, and
privacy classification.

Search/LBG aware so key marketplace concepts roll up cleanly.

Lowrisk evolution via schema registry + CI and clear deprecation paths.

§5.2 --- Canonical IDs & Entity Graph

Goal: Define stable, opaque IDs and a precise entity graph so bookings,
payments, messaging, docs, studios, promotions, tax, and safety all join
cleanly. Prevent double counting, enable LBG (Linked Booking Group)
rollups, and support merges, soft deletions, and audits without code
rewrites.

A\) Scope & Design Goals

One source of truth for IDs, relationships, and cardinalities across
Sections 1--4.

Opaque, nonguessable IDs (no PII embedded).

LBGaware joins: legs (Talent, Studio) roll up to an LBG where
applicable.

No hard deletes on principals (users, bookings, studios): use soft
delete / tombstones and legal holds (see §4.14.15).

Compatible with §5.1 events and §4.14.x admin ops (bulk tools, disputes,
finance, tax, studios).

B\) ID Strategy (format, creation, safety)

Format: 26char ULID/UUIDv7style opaque strings, URLsafe, lowercase,
prefixed for readability.\
Generation: Serverside only; idempotent creators accept client retries
without duplicating (caller supplies a natural key or request id).\
Environment: IDs are environmentscoped (never move between
Sandbox/Prod).\
PII: IDs never encode emails, names, or locations.

Example: usr_01HE9Z7A5S6E3Z1B8QK3J8N3QX (prefix + ULID body)

C\) Canonical ID Catalog (v1)

Rule: Reviews, pricing, availability, and search exposure are tied to
service_profile_id, not user_id---this keeps multirole users clean.

D\) Entity Graph & Cardinalities (core)

Users & Profiles

user_id 1---M service_profile_id (one per role; can be multiple of the
same role if needed later---v1 uses one)

user_id 1---M studio_id (host can own several studios)

Bookings

lbg_id 1---M booking_leg_id (0 or many legs; singleleg bookings have an
LBG too for uniformity)

Each booking_leg_id belongs to exactly one service_profile_id (provider)
and one buyer user_id

booking_leg_id 1---M doc_id (SOW, Releases, Change Orders)

Messaging

message_thread_id belongs to a booking_leg_id or lbg_id (group thread);
messages reference the thread

Reviews & References

review_id belongs to booking_leg_id (source of truth) and attaches to
service_profile_id

reference_id belongs to a user_id pair; optional artifact asset_id or
external link

Payments

charge_id belongs to lbg_id (group checkout) and references each
booking_leg_id in line items

refund_id belongs to charge_id; may reference specific leg lines

payout_id belongs to user_id (seller) and aggregates multiple
booking_leg_id settlements

deposit_id belongs to a studio leg (booking_leg_id with leg_role=studio)

Promotions

promotion_campaign_id belongs to a service_profile_id; click charges
link to the campaign and the viewer (hashed)

Safety/Support

ts_case_id and support_case_id reference whichever scope applies:
user_id, service_profile_id, booking_leg_id, or lbg_id

Tax/Compliance

w9_id belongs to user_id (payee), not profile; form1099_id belongs to
user_id per tax year

tax_calc_id belongs to lbg_id at checkout time

E\) Key Lifecycles (state machines)

Service Profile: draft → published → paused → banned (T&S) → deleted
(soft)\
Booking Leg: requested → accepted → in_progress → delivered → completed
→ (optional) disputed → resolved\
LBG: created → paid → all legs completed → closed\
Studio: onboarding → verified → reverify_due → suspended\
Promotion Campaign: active → paused → completed → archived\
Payout: queued → sent → failed (retryable) → settled\
Deposit: authorized → captured/voided → released (or retained by claim)

State c