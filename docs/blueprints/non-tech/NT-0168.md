<!-- id: NT-0168 | source: ProjectPlans\Combined_Master_PLAIN_Non_Tech_001.docx | range: 604800-608800 -->

s as above (fact_lbg,
fact_booking_leg, fact_payment + fact_payment_line, fact_payout +
fact_payout_leg, fact_deposit, fact_tax, fact_promo, fact_search,
fact_thread_activity, fact_support_case, fact_ts_case, fact_docs,
fact_social_snapshot).

Partitioning/clustering follow §5.4; money in cents; timestamps
consistent.

Allocation math implemented & reconciles to §5.3 finance close; DQ tests
green.

Semantic layer (next §5.6) maps these tables to curated
measures/dimensions; catalog entries created for each measure.

H\) Why this works

Clean grains and keys make queries fast and predictable.

LBG vs leg separation reflects real workflows (talent + studio) without
double counting.

SCD2 dims capture profile/policy changes historically for fair
analytics.

The set covers marketplace health, money, trust/safety, promotions, and
social in one consistent model.

§5.6 --- Metrics Catalog & Semantic Layer

Goal: Give every team one consistent, audited set of metrics---with
clear, versioned definitions; safe, LBGaware rollups; and a semantic
layer that prevents double counting and "SQL drift." Dashboards, alerts,
experiments, and ML features all read from this layer.

A\) What this delivers

A versioned Metrics Catalog (YAML/JSON) where each metric has: key,
owner, business definition, SQL logic path, grain, allowed dimensions,
filters, privacy tier, and test suite.

A semantic layer (views/API) that enforces correct joins and grains
(e.g., LBG vs leg), exposes curated measures/dimensions, and blocks
unsafe combinations.

Change safety: Metric semver, deprecation windows, and "definition hash"
tags on dashboards (matches §4.14.12).

B\) Modeling rules (global)

Grain first: Every metric declares its base grain (e.g., leg, LBG,
campaignday). Aggregations always respect that grain.

LBGaware: Leglevel money (provider earnings, payouts) uses
fact_booking_leg; grouplevel money (checkout totals) uses
fact_lbg/fact_payment.

Money in cents: All \$ in cents; semantic layer exposes both \*\_cents
and formatted USD.

Ratios: Always recompute as Σ numerator / Σ denominator at query time
(never average of ratios).

Attribution transparency: Promotions metrics report both "direct" and
"incremental (holdoutestimated)" values.

Defaults: Time grain = day, currency = USD, Safe Mode (SFW) on when
applicable.

C\) Core business definitions (v1)

These are the canonical definitions the catalog will encode.

GMV (Gross Merchandise Value) --- buyer spend on services excluding
buyer fee, taxes, and studio deposits.\
Formula (LBG grain):\
gmv_cents = subtotal_cents + addons_total_cents + travel_total_cents +
license_total_cents from gold.fact_lbg.\
Notes: deposits are not GMV; refunds tracked separately.

Platform Revenue (Bookings) --- provider fee + buyer fee (before
processor costs).\
Formula: provider_fee_cents + buyer_fee_cents allocated from
gold.fact_payment into gold.fact_booking_leg then summed.\
Variant: Net Booking Revenue = Platform Revenue − processor fees −
invalidclick credits (bookingrelated, if any).

Take Rate (%) --- platform_revenue / GMV.\
Variants: bookingonly vs. all (booking + promotions + early payout
fees).

Bookings --- count of completed legs (status completed).\
Where: gold.fact_booking_leg.

Cancellations (rate) --- cancels ÷ requests at leg grain; split by
buyerinitiated vs providerinitiated; policy band segments.\
Where: gold.fact_booking_leg (status=\'canceled\' and
policy_band_on_cancel).

Acceptance Rate --- accepts ÷ (accepts + declines) for provider;
rolespecific; controlled for Instant Book.\
Where: gold.fact_booking_leg events rollup (or derived from booking
status transitions).

Search→Inquiry Conversion --- inquiries opened ÷ search result clicks
(same role/city/day).\
Where: gold.fact_search + messaging opens leading to a thread
(msg.thread_open).

Inquiry→Booking Conversion --- booking requests ÷ inquiries
(threadlinked).\
Where: gold.fact_thread_activity + gold.fact_booking_leg.

Ontime Delivery Rate --- legs tha