<!-- id: NT-0163 | source: ProjectPlans\Combined_Master_PLAIN_Non_Tech_001.docx | range: 586800-590800 -->

mark 10--30 min; tune per
topic.

File sizes: Parquet 128--256 MB target; compaction jobs to coalesce
small files.

Partitioning: by dt; cluster by city_id, role, and lbg_id/booking_leg_id
where appropriate.

TTL: Bronze raw retained 90 days (configurable; see §5.12); Silver
retained per policy; Gold retained per retention (§4.14.15).

Hot paths: materialize BI views for heavy tiles (search CTR, promotions
ROAS).

I\) Reliability & Failure Modes (with playbooks)

Bus outage/backlog → backpressure; raise S1; autoscale consumers;
catchup metrics (lag minutes) on cockpit (§4.14.13).

Bronze write failures → circuit break to local spool; alarm; drain when
store healthy.

Schema drift → events to schema_violation DLQ; alert Data Eng; hotfix in
Schema Registry.

Downstream warehouse outage → buffer in object store; resume; mark
dashboards "partial" via freshness badges (§4.14.12).

Poison pill → capture sample to DLQ; sandbox reprocess; issue patch;
replay.

J\) Security & Compliance

Transport: TLS everywhere; admin producers require mTLS.

AuthZ: producer tokens bound to namespaces; ratelimits per token.

At rest: serverside encryption; restricted IAM per bucket/prefix.

Privacy: no raw PII beyond masked tokens in events; privacy_tier
enforced; sensitive tables isolated (see §5.7).

Access: Bronze is restricted; most users consume from Gold/Silver views
via RBAC.

K\) Telemetry (pipeline & health events)

Emit ops events (consumed by §4.14.12/§4.14.13 dashboards):

data.ingest.accept/deny (reason) • data.bus.lag_minutes •
data.bronze.write.ok/fail

data.silver.job.late_events (count, max_lateness) •
data.silver.upsert.errors

data.gold.close.start/finish/fail • data.recon.variance (amount_cents)

data.dlq.enqueue/resolve (family) • data.replay.start/finish

Freshness gauges per table.

L\) Acceptance Criteria (mark §5.3 FINAL)

Edge Collector enforces contracts, size limits, PII filter, auth,
idempotent retries.

Event Bus topics & keys set; perentity ordering preserved; backpressure
metrics visible.

Bronze landing: validated, deduped by event_id, partitioned, with DLQ
families and lineage stamps.

Silver streaming: typed tables, enrich joins, PII masked, watermarks for
late data, exactlyonce upserts.

CDC for dims available; SCD2 merge pattern in place.

Gold daily close builds finance/tax facts; reconciled to settlements;
SLA 06:00 local.

Replay/backfill tooling works; audit logs for replays; partitioned
recompute only.

Performance/cost controls (compaction, partitioning, TTL) configured;
freshness \<15 min for ops tables.

Security/RBAC applied; Bronze restricted; telemetry & DQ alerts wire to
Observability.

M\) Why this works

Opsfast, financetrue: streaming for freshness, batch for reconciliation.

Safe evolution: schema registry + additive contracts + quarantine
protect consumers.

Resilient & auditable: DLQs, replays, lineage stamps, and recon reports
keep trust high.

Costaware & scalable: partitioning, compaction, TTLs, and clustered
layouts limit warehouse spend

§5.4 --- Warehouse Layers & Privacy Zones

Goal: Make analytics fast and trustworthy without risking PII. Separate
raw logs from curated business tables, isolate sensitive fields in a
vault, and give each team the right layer with RBAC, masking, and
retention builtin. Be LBGaware (Linked Booking Group) so legs roll up
cleanly.

A\) Layers at a Glance (what each is for)

Rule: Dashboards in §4.14.12 read Gold/Gold_Restricted only. Silver is
for pipelines & ML feature building; Bronze is never used for BI.

B\) Physical Layout & Naming

Schemas / databases

bronze.\* (e.g., bronze.events_booking\_\_2025_11)

silver.\* (e.g., silver.booking_events, silver.dim_user_cdc)

gold.\* (e.g., gold.fact_booking_leg, gold.dim_service_profile)

gold_restricted.\* (masked views over gold.\*)

vault_pii.\* (e.g., vault_pii.user_contact, vault_pii.tax_forms)

gov.\* (catalog, lineage, dataquality, metric catalog, retention
ledgers)

Table naming rules

Events by domain in Si