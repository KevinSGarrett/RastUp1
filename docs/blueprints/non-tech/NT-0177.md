<!-- id: NT-0177 | source: ProjectPlans\Combined_Master_PLAIN_Non_Tech_001.docx | range: 637200-641200 -->

Finance (money rules), Analytics (semantic tests),
Privacy (PII/DLP).

Schedules:

Edge/Silver: continuous;

Gold finance: nightly;

Catalog/semantic: nightly + on deploy;

DLP: nightly;

Baselines: daily/weekly jobs.

Dashboards: Admin Analytics cockpit (§4.14.12) shows DQ status:
red/amber/green per table/metric; freshness gauges; recon variances; DLQ
counts.

Alerts: Slack + email routes from Observability (§4.14.13) with runbook
links.

F\) Example Tests (per table)

gold.fact_booking_leg

start_at \< end_at

status ∈ enum and legal transitions only

leg_role=\'studio\' ⇒ deposit_auth_cents may be nonnull;
leg_role=\'talent\' ⇒ deposit fields must be null

Σ allocations equals parent charge totals (join to fact_payment_line)

gold.fact_lbg

legs_count ≥ 1; money lines sum to GMV formula; amount_charged_cents =
gmv + buyer_fee + tax

gold.fact_payment + fact_payment_line

Lines sum to parent; 3DS present when method=\'card\' and challenge
flagged

gold.fact_promo

cpb_cents = spend_cents / bookings (division by zero prevented); invalid
click ratio thresholds

gold.fact_tax

Jurisdiction fields nonnull for taxed cities/states; latency within SLA;
exception rate \< 1%

Dims (SCD2)

No overlapping valid_from/valid_to for the same natural key; exactly one
current_flag=true

G\) Freshness & Completeness Monitors

Table freshness: materialized view of max updated_at per table; redline
if \>15 min for Silver ops tables.

Completeness: compare counts of completed legs in Silver vs Gold by
city/day after finance close; badge tiles if \<99%.

H\) Quarantine, Replays & Fix Flow (tie to §5.9)

Quarantine families: schema_violation, fk_missing, money_invariant,
privacy_violation.

Replay: after a fix (schema or code), reprocess quarantined batches via
Replay Tool; Gold recomputes only affected partitions.

Audit: all quarantines, replays, and manual overrides logged and
surfaced in Admin analytics.

I\) Documentation & Training

DQ runbooks for each P0/P1 failure with example queries, expected
impacts, and rollback steps.

Sandbox drills (§4.14.16): quarterly exercises for finance close gate,
promotions invalidclick spike, and freshness outage.

J\) Telemetry (DQ events)

dq.schema.fail/pass (event_name, version)

dq.fk_missing (table, count) • dq.invariant.fail (rule_id)

dq.recon.variance (cents) • dq.freshness.breach (table, minutes)

dq.dlp.hit (pattern, table) • dq.quarantine.enqueue/resolve

dq.gate.close.block/release (reason, approver)

K\) Acceptance Criteria (mark §5.8 FINAL)

Layered checks implemented from Edge → BI; failures categorized with
DLQs/quarantine.

Finance recon and allocation math tests gate daily close; payouts pause
on P0s.

Freshness monitors (\<15 min Silver; finance done by 06:00) with alerts
& tiles badges.

Referential & invariant tests cover all core facts/dims; SCD2 overlap
checks live.

Privacy/DLP scans nightly; exports watermarked; vault joins blocked for
analysts.

Baseline anomaly detectors active (invalid clicks, CTR, take rate, rep
distribution).

Replay tool integrated with quarantine; partial recompute only; all
actions audited.

DQ dashboard in Admin shows status, trends, and links to runbooks.

L\) Why this works

Prevents silent errors from creeping into payouts, taxes, and KPIs.

Gives teams clear gates and playbooks, so fixes are fast and traceable.

Keeps trust high with Finance and operators by reconciling to reality
every day.

§5.9 --- Backfills & Replays

Goal: Correct history safely, audibly, and cheaply---whether fixing a
bug, adopting a new schema, filling late data, or reclosing
finance---without double counting, breaking joins, or violating
privacy/retention policies.

A\) When to Replay vs Backfill (choose the right tool)

B\) Event Replay Policy (Bronzefirst, idempotent)

What it does\
Replays original events through the current pipeline so new
parsing/enrichment applies.

How

Replay Tool accepts event_name, date range, optional ids
(booking_leg_id, lbg_id, user_id).

Finds ev