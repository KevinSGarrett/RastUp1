<!-- id: NT-0164 | source: ProjectPlans\Combined_Master_PLAIN_Non_Tech_001.docx | range: 590400-594400 -->

(e.g., bronze.events_booking\_\_2025_11)

silver.\* (e.g., silver.booking_events, silver.dim_user_cdc)

gold.\* (e.g., gold.fact_booking_leg, gold.dim_service_profile)

gold_restricted.\* (masked views over gold.\*)

vault_pii.\* (e.g., vault_pii.user_contact, vault_pii.tax_forms)

gov.\* (catalog, lineage, dataquality, metric catalog, retention
ledgers)

Table naming rules

Events by domain in Silver: silver.\<domain\>\_events (e.g.,
silver.fin_events)

Facts/Dims in Gold: gold.fact\_\<subject\>, gold.dim\_\<entity\>

Materialized rollups: gold.mv\_\<subject\>\_\_\<grain\> (e.g.,
gold.mv_search_ctr\_\_day_city_role)

All Gold facts include lbg_id and/or booking_leg_id to support LBG
rollups.

C\) Privacy Zones & RBAC (who can see what)

Zones

Public/Operational (default): no raw PII; masked tokens only.

Restricted: masked PII view with limited unmaskability (percolumn,
perrole).

Sensitive: tax/background artifacts; accessible to Legal/Tax only with
twoperson approval (per §4.14.1 & §4.14.15).

Access groups (examples)

Finance → gold (all facts), gold_restricted (masked buyer emails), no
vault_pii (except recon contact via JustInTime elevation).

Trust & Safety → gold_restricted, selective Sensitive views for case
evidence via JIT.

Analytics/City Ops/Marketing → gold_restricted only.

Legal/Tax → vault_pii + Sensitive forms; downloads watermarked;
dualapproval to unmask.

Rowlevel security (RLS)

Optional city scoping for contractors: RLS filters rows by city_id.

Dynamic masking

Email/phone shown as j\*\*\*@example.com, (\*\*\*) \*\*\*1234 unless
unmasked by scope & reason.

D\) PII Strategy (tokens, vault, masking)

Tokenization at ingest: Emails/phones hashed/tokenized; only tokens flow
to Bronze/Silver/Gold.

Vault_PII holds minimal reversible mappings: user_id, token, encrypted
value (KMS), last4, verification flags, timestamps.

Unmask flow: Admin JIT elevation (reason + ticket) → scoped SQL function
→ audited view for a limited window; export watermarking enforced.

Never in events: SSNs/TINs, full card PANs, full addresses are not in
§5.1 payloads; W9/1099 PDFs live in vault_pii.tax_forms with access
gates.

E\) Retention & Lifecycle (cost + compliance)

Bronze: retain 90 days, then archive to cold storage; legal holds pause
deletes.

Silver: retain 12--24 months for ops analyses; compact monthly; purge
per retention schedule (§4.14.15).

Gold: retain per record class---finance/tax 7 years, T&S 5 years,
support 2--3 years, generic product facts 24 months;
softdelete/tombstone handled in dims.

Vault_PII: retain per legal policy (tax 7 years); deletion honored for
DSR where lawful (keep financial minimums).

Purge ledger in gov.retention_log writes counts, IDs (masked), policy
reason, and job run.

F\) Partitioning, Clustering & Indexing

Partition large facts by dt (UTC date), cluster by city_id, role, and
lbg_id/booking_leg_id.

Dims (SCD2): cluster by entity id; use valid_from/valid_to with current
row flags.

Search facts: cluster by role, city_id, query_hash.

Promotions: cluster by service_profile_id, city_id.

Tax & payouts: cluster by state, city_id, user_id for SLA queries.

G\) Gold Contract (what every fact must include)

Required columns in every fact\_\*:

dt (date), city_id, role (where applicable), lbg_id and/or
booking_leg_id, user_id (owner of the record, e.g., provider for
payouts), created_at, updated_at.

Money columns are integers in cents + currency (USD).

LBG vs leg flags: is_group_rollup (bool) or separate tables (see §5.5).

Source stamp: bronze_offset, event_version_hash.

Softdelete flag for rebuilds and backfills.

Dim contracts (dim\_\*):

Surrogate key, natural key (e.g., service_profile_id), SCD2 columns,
current_flag, deleted_at (nullable).

H\) Materializations & Performance

Materialized views for hot tiles in §4.14.12 (e.g., marketplace KPIs,
ROAS, search CTR).

Incremental refresh cadence: hourly for ops, daily for finance.

Compaction jobs coalesce small files into 128--256 MB