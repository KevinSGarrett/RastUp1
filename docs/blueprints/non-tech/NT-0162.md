<!-- id: NT-0162 | source: ProjectPlans\Combined_Master_PLAIN_Non_Tech_001.docx | range: 583200-587200 -->

h forbidden PII never
land (blocked at edge).

DLQs / Quarantine families:

schema_violation (unknown name/version, wrong types),

oversize (exceeds limits),

unknown_actor (missing/invalid ID),

contract_break (required field missing),

poison_pill (processor crash repro sample).

Lineage stamps: ingest_id, collector_id, bus_offset.

E\) Silver Transforms (streaming; \<15min SLA)

Engines: streaming jobs (tooling TBD in tech plan) consume bus → write
typed, partitioned Silver tables.

Common transforms

Flatten payload into typed columns; enforce enums; discard extra fields
into payload_extra (for forwardcompat).

Enrich with dimensions: dim_city, dim_service_profile, dim_user (CDC
feeds below).

PII masking: keep only hashed tokens; no raw PII fields.

Watermarks & lateness: allow 10--30 min eventtime lateness; recompute
small windows to capture stragglers.

Exactlyonce sinks: use merge/upsert on natural keys (e.g., event_id, or
(charge_id,leg_id,line_no) for facts).

Stateful joins (where needed): e.g., correlate fin.checkout_pay\_\* with
booking.request for sanity checks.

Silver tables (illustrative)

silver.events_search (query, filters, results_count, promoted flag)

silver.events_msg (thread/message actions)

silver.booking_events (request/accept/decline/cancel/change_order with
deltas)

silver.deliver_events (uploads, accepts, revision requests)

silver.fin_events (charges, refunds, payouts, deposits)

silver.promo_events (clicks valid/invalid, featured starts)

silver.tax_events (calc req/resp, 1099 delivery)

silver.ts_events / silver.support_events

silver.studio_events (verify, deposit lifecycle)

silver.docs_events (sow/release/change orders)

CDC feeds (reference dims)

From transactional DB to Silver: silver.dim_user_cdc,
silver.dim_service_profile_cdc, silver.dim_studio_cdc,
silver.dim_policy_cdc.

Built with SCD2 patterns (valid_from/to); merged nightly into Gold dims.

Data Quality guards (inline)

Reject impossible money math (negative totals); push to quarantine;
raise S2 alert (§4.14.13).

Check ID referential existence within a lookback window; missing dims
flagged.

F\) Gold Finance Close (daily batch; dayaccurate)

A deterministic batch (cron after local midnight) computes reconciled
finance/tax facts and other heavy facts:

Assemble leg lines from silver.fin_events and silver.booking_events.

Compute net lines: provider fee, buyer fee, discounts, taxes, processor
fees, reserves, early payout fees.

Reconcile against processor settlements (settlement feed) and deposit
captures; write variances.

Finalize facts: fact_payment, fact_payout, fact_tax, fact_deposit,
fact_lbg, fact_booking_leg (see §5.5).

Lock window (idempotent): reruns overwrite same day with same results;
variances tracked.

Emit DQ & recon reports to Finance dashboard (§4.14.12 D9).

SLA: Gold finance complete by 06:00 local daily; retries autoescalate to
SRE/Finance on failure.

G\) Replays, Backfills & Corrections

Event Replay Tool: select event_name, date range, optional IDs →
republish to bus with replayed_at and original occurred_at; Bronze dedup
uses event_id, so replays in Bronze are separate (replay=true) and flow
through Silver with merge keys to update rows.

Gold recompute: partitioned by dt; rerun only affected days (and
dependent windows).

Contract evolution: new fields flow through Silver with payload_extra
until consumers adopt; no breaking changes.

Audit trail: replays recorded in data.replay logs (who/why/range) and
visible in §4.14.12 Data QA.

H\) Performance, Scaling & Cost

Microbatch streaming intervals: 1--2 min; watermark 10--30 min; tune per
topic.

File sizes: Parquet 128--256 MB target; compaction jobs to coalesce
small files.

Partitioning: by dt; cluster by city_id, role, and lbg_id/booking_leg_id
where appropriate.

TTL: Bronze raw retained 90 days (configurable; see §5.12); Silver
retained per policy; Gold retained per retention (§4.14.15).

Hot paths: materialize BI views for heavy tiles (search CTR, p