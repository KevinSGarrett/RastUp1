<!-- id: NT-0166 | source: ProjectPlans\Combined_Master_PLAIN_Non_Tech_001.docx | range: 597600-601600 -->

.

PII: No raw PII; joins to masked dims only (see gold_restricted).

Soft delete: is_deleted (bool) present where entities can be retired;
history preserved.

Timestamps: created_at, updated_at; facts add occurred_at/finalized_at
as needed.

SCD2 dims: valid_from, valid_to, current_flag.

B\) Dimensions (SCD2)

gold.dim_user

gold.dim_service_profile (rolespecific)

gold.dim_studio

gold.dim_city

gold.dim_policy

gold.dim_promotion_campaign

gold.dim_doc_template

C\) Facts (business grain & columns)

1\) gold.fact_lbg --- Group checkout & lifecycle

Grain: one row per LBG per day (dt = date(paid_at); stable id lbg_id)\
Columns (subset):

Keys: dt, lbg_id, buyer_user_id, primary_city_id, legs_count,
has_talent_leg (bool), has_studio_leg (bool)

Money: subtotal_cents, addons_total_cents, travel_total_cents,
license_total_cents, buyer_fee_cents, tax_cents, amount_charged_cents,
refunds_total_cents, currency

Timestamps: created_at, paid_at, completed_at

Status: status (created\|paid\|completed\|closed), payment_method
(card\|ach)

2\) gold.fact_booking_leg --- Perprovider engagement

Grain: one row per booking leg (booking_leg_id)\
Columns:

Keys: dt = date(start_at), booking_leg_id, lbg_id, city_id, leg_role
(talent\|studio), service_role
(model\|photographer\|videographer\|creator), service_profile_id,
provider_user_id, buyer_user_id

Timing: start_at, end_at, duration_minutes, instant_book (bool)

Price lines: subtotal_cents, addons_cents, travel_cents, license_cents,
discounts_cents

Fees & tax: provider_fee_cents, buyer_fee_cents_alloc, tax_cents_alloc,
processor_fee_cents_alloc (allocations from LBG charge)

Payouts: net_to_provider_cents (after provider fee and processor alloc)

Studio deposit: deposit_auth_cents, deposit_captured_cents (studio legs
only)

Lifecycle: status
(requested\|accepted\|in_progress\|delivered\|completed\|disputed\|resolved\|canceled),
policy_band_on_cancel (nullable)

QA: deliverables_count, revisions_requested, accepted_at

Allocation note: Buyer fee, tax, and processor fees allocated to legs by
proportional contribution of subtotal+addons+travel+license. Totals tie
back to fact_payment.

3\) gold.fact_payment --- Charges, refunds, processors

Grain: one row per charge (charge_id), plus child table for leg lines.

Parent columns: dt = date(occurred_at), charge_id, lbg_id, amount_cents,
buyer_fee_cents, tax_cents, processor_fee_cents, method,
three_ds_challenged (bool), succeeded (bool), occurred_at

Child gold.fact_payment_line: charge_id, booking_leg_id, line_kind
(subtotal\|addons\|travel\|license\|refund), line_cents

4\) gold.fact_payout --- Money out to providers

Grain: one row per payout (payout_id) to a provider, plus child mapping
to legs.

Parent columns: dt = date(sent_at), payout_id, user_id (payee),
amount_cents, reserve_cents, early_payout_fee_cents, status
(queued\|sent\|failed\|settled), sent_at

Child gold.fact_payout_leg: payout_id, booking_leg_id,
net_to_provider_cents

5\) gold.fact_deposit --- Studio deposits

Grain: one row per deposit (deposit_id)

Columns: dt = date(action_at), deposit_id, booking_leg_id, studio_id,
auth_cents, captured_cents, voided_cents, released_cents, action
(authorize\|capture\|void\|release), action_at, reason
(damage_claim\|no_show\|other)

6\) gold.fact_tax --- Jurisdictional tax results

Grain: one row per tax calc (tax_calc_id)

Columns: dt = date(occurred_at), tax_calc_id, lbg_id, state, city,
taxable_base_cents, tax_cents, method (provider), exception (nullable),
latency_ms, occurred_at

7\) gold.fact_promo --- Boost/Featured performance

Grain: one row per campaign per day

Keys: dt, promotion_campaign_id, service_profile_id, city_id, role, type
(boost\|featured)

Spend & delivery: spend_cents, clicks_valid, clicks_invalid, impressions
(featured)

Outcomes: inquiries, bookings, gmv_attributed_cents,
gmv_incremental_cents (holdoutestimated), cpb_cents (cost per booking)

8\) gold.fact_search --- Query performance

Grain: one row per (dt, c