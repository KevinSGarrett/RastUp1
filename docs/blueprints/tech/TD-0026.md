<!-- id: TD-0026 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 93600-97600 -->

**Model Release (Adult, v1)** → fields enforce 18+ check; explicitly
  **disallows explicit content** on public surfaces; usage scope limited
  per blueprint positioning.
- **Studio House Rules (v1)** → capacity, amenity rules, deposit,
  damages, cleaning fees, overtime procedure.

**Signer roles**

- **Talent SOW:** Buyer & Seller (talent).
- **Model Release:** Model (may be same as talent or separate field),
  Photographer (counter‑sign). *No minors allowed at MVP.*
- **Studio House Rules:** Buyer (responsible party) & Studio
  Owner/Manager.

**Layout**

- Header: brand, booking ref (*lbg_id* / *leg_id*), doc id, template &
  clause versions.
- Footer: page X/Y, hash fingerprint, generated timestamp UTC.

## **1.5.E Pack assembly (Docs‑Before‑Pay)**

**When generated:**

- During checkout after *startCheckout*, **before** payment.
- For each **leg**, resolve which **template(s)** apply via city/role
  gates and pack them.

**Resolver inputs:**

- Leg times, location, price lines, tax quote, deposit policy (for
  studios), buyer/seller identities, role fields, SOW deliverables (from
  Brief/Shot list summary if present).

**Algorithm (high‑level):**

490. Determine applicable templates (by *leg.type*, city, role).
491. Validate all required variables can be bound; if not, return
     *DOC_VARS_MISSING* with a list.
492. Fill variables (see mapping in §1.5.F).
493. Render Markdown → PDF (headless Chromium or a template renderer).
494. Create envelopes with the e‑sign provider; map **signer roles →
     emails**; send.
495. Update *doc_pack* → *issued* and
     *doc_instance.envelope_status=\'sent\'*.
496. Block payment step until **every envelope** in both relevant packs
     is *completed*.

**Re‑issue rules:**

- If *start_at/end_at*, *location*, *deliverables*, *deposit_policy*, or
  **counterparty** changes → invalidate pack (*superseded*) and
  re‑generate (fresh template version selection).
- All **previous** PDFs remain immutable evidence; receipts reference
  the **active** pack.

## **1.5.F Variable binding (examples)**

  ------------------------------------------ -------------------------------------------------------------------------------------
  **Variable**                               **Source**
  *service_date*, *start_time*, *end_time*   *booking_leg.start_at/end_at* (UTC → local tz of city gate)
  *location_address*                         *studio.address_json* if studio leg, else buyer‑provided shoot location
  *buyer_legal_name*, *buyer_email*          Account profile / checkout identity
  *seller_legal_name*                        Talent SP owner legal name
  *deliverables_summary*                     From Brief/Shot list (if provided) + chosen packages
  *total_price*, *taxes*                     From leg price snapshot (*total_cents*, *tax_cents*)
  *cancellation_policy_summary*              Derived from *policy_json* bands
  *deposit_amount*                           *deposit_policy.auth_cents* (studio leg)
  *usage_scope*, *territory*, *duration*     Defaults from template, can be narrowed by seller; never wider than template allows
  *model_dob*                                From IDV provider (age 18+ required for Model Release at MVP)
  ------------------------------------------ -------------------------------------------------------------------------------------

Validation runs both in the **API** and during **render**. Any failure
returns explicit error codes.

## **1.5.G E‑sign adapter (Dropbox Sign / DocuSign)**

**Adapter contract**

- *create_envelope(doc_id, signer_map, pdf_s3)* → returns *envelope_id*,
  signer URLs (embedded) or email invites.
- *void_envelope(envelope_id, reason)* (on re‑issue).
- Webhooks: *envelope.sent*, *recipient.viewed*, *recipient.signed*,
  *envelope.completed*, *envelope.declined*, *envelope.voided*,
  *envelope.expired*.

**Security & idempotency**

- HMAC‑verified webhooks; store *provider_event_id*; dedupe.
- Signer links time‑limited; deep links route th