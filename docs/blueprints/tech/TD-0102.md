<!-- id: TD-0102 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 367200-371200 -->

.userId,*\
*template: \'weekly_city_digest\',*\
*vars: { city, \...blocks }*\
*});*\
*}*\
*}*\
*};*\

## **1.16-O. Lambda Skeleton --- Book Again (7/30/90)**

**Recommended filename/path:** *apps/functions/growthBookAgain7.ts*
(copy for 30/90)

*// growthBookAgain7.ts*\
*import { findEligibleRebooks } from \'../lib/rebookRepo\';*\
*import { sendEmail } from \'../lib/ses\';*\
\
*export const handler = async () =\> {*\
*const reb = await findEligibleRebooks({ daysAgo: 7 });*\
*for (const r of reb) {*\
*await sendEmail({*\
*toUserId: r.buyerId,*\
*template: \'book_again_7d\',*\
*vars: {*\
*spName: r.spName,*\
*packageName: r.packageName,*\
*packagePrice: r.packagePriceFmt,*\
*previewUrl: r.previewUrl,*\
*draftCheckoutLink: r.draftCheckoutLink,*\
*stopLink: r.stopLink*\
*}*\
*});*\
*}*\
*};*\

## **1.16-P. Cost & SLO Guardrails (growth jobs)**

**Recommended filename/path:** *observability/slo/growth-jobs.md*

*SLOs*\
* - Saved-search alert job completes \< 10 min p95; per-user dedupe
strictly 1/day/search.*\
* - Weekly digest job \< 20 min p95 per city cohort.*\
* - Book-again jobs \< 5 min p95 each run.*\
\
*Alarms*\
* - SES bounce/complaint spikes \> 0.3% rolling 24h -\> pause
digest/alerts, in-app only.*\
* - Lambda errors \> 1% or duration p95 \> SLO -\> investigate search
query shapes or batch sizes.*\
* - Dynamo TTL dead-letter \> 100/day -\> inspect dedupe miswrites.*\
\
*Cost*\
* - Prefer in-app notifications when SES threshold near daily cap.*\
* - Batch Typesense/OpenSearch queries for alerts by grouping identical
filters.*

# **§1.17 --- SEO, Web Performance & Content Discovery**

*(URL topology · metadata & canonicalization · JSON‑LD · robots/noindex
& Safe‑Mode · sitemaps · hreflang · ISR/SSR caching · Core Web Vitals
budgets · a11y synergy · admin content ops · telemetry · tests · cost)*

**Purpose.** Make the marketplace discoverable while keeping costs down
and content safe. This section defines *exactly* how we structure URLs,
metadata, structured data, crawlers access, internationalization
signals, build & caching strategy, performance budgets, admin workflows,
and monitoring---plus copy‑pasteable artifacts for your Word plan.

## **1.17.A Canon & invariants**

1763. **SFW on the open web.** Public pages show *SFW previews only*.
      Age‑gated/18+ content never leaves the app; no email with 18+
      previews.
1764. **Single canonical per concept.** Every profile, studio, case
      study, and city page has one canonical URL; alternates
      (share/UTM/tracking) 301 to the canonical.
1765. **Server‑rendered entry, cached at the edge.** We use Next.js
      **ISR/SSR** with CloudFront caching and smart revalidation (low
      cost).
1766. **Robots are guests, not owners.** We invite indexing of SFW
      listings and guides; we set *noindex* on anything gated,
      duplicated, or ephemeral (drafts, filters, session pages).
1767. **Accessibility improves SEO.** Headings, landmarks, alt text, and
      readable copy are mandatory---no image‑only text.

## **1.17.B URL topology (stable, human‑readable)**

**People (Service Profiles)**

- */p/{handle}* (canonical)
- */p/{handle}/packages/{slug}* (canonical for package detail)
- */p/{handle}?utm\_\** → 301 → */p/{handle}*

**Studios**

- */s/{slug}* (studio listing)
- */s/{slug}/rates* (rate table, SFW)

**Cities & discovery**

- */city/{city-slug}* --- city hub (SFW)
- */city/{city-slug}/people* --- SFW grid (server‑filtered)
- */city/{city-slug}/studios* --- SFW studios list
- */stories/{slug}* --- case studies/guides (SFW hero)

**System**

- */robots.txt*, */sitemap.xml* (+ segmented sitemaps)
- */legal/{tos\|privacy\|dmca}* (indexable)
- */help/\** (indexable FAQ)
- Anything transactional (*/checkout*, */messages*, */admin*) →
  *noindex, nofollow*.

## **1.17.C Metadata & canonicalization**

- **Required** ***\<head\>*** **tags per page:**

  - *\<title\>* unique, ≤60 chars; *\<meta name=\"description\"\>* ≤160
    chars.
  - \<link rel=\"canonical\" href=\"