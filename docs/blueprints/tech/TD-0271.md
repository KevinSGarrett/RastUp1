<!-- id: TD-0271 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 975600-979600 -->

g;
  webhook delivery via EventBridge/Lambda; no persistent partner
  connections.

## **1.27.2 External API surface (REST)**

**Base URL**: [*https://api.rastup.com/v1/*](https://api.rastup.com/v1/)

**Resources & verbs (MVP)**

- *GET /profiles* --- list public provider profiles (SFW‑safe):
  *?city=&role=&verified=&updated_after=*
- *GET /profiles/{id}* --- details (SFW fields only).
- *GET /studios* / *GET /studios/{id}* --- public studio inventory
  (amenities, verified, hourly bands).
- *GET /work* / *GET /work/{id}* --- SFW case studies.
- *GET /orders/{id}* --- limited order view for the partner who
  originated a referral or has an authorized linkage (no PII by
  default).
- *POST /briefs* --- create a **buyer brief** (RFP) with audience
  constraints; consumes buyer **brief credits** (§1.20).
- *POST /invites* --- create invitation links for a target
  provider/studio (no auto‑accept).
- *GET /payouts* --- partner‑scoped payout summaries for reconciliation
  (amounts, periods, IDs only).

**Query rules**

- All list endpoints are **cursor‑paginated** (*limit*, *cursor*); cap
  *limit* to 100.
- Public queries enforce *nsfw_band \<= 1*.
- Sort options: *updated_at*, *rating* (where available), *published_at*
  (work).
- **Caching**: CDN edge cache (60--300s) for unauthenticated public
  GETs.

## **1.27.3 Authentication & authorization (OAuth 2.0)**

- **Auth server**: Cognito (hosted UI for partner accounts) or custom
  OAuth on top of Cognito.

- **Grant**: Authorization Code + PKCE.

- **Tokens**: Access token (1 hour), Refresh token (30 days).

- **Client types**: *confidential* (server‑side apps) and *public*
  (limited, discouraged).

- **Scopes (MVP)**:

  - *read:public_inventory* --- GET profiles/studios/work.
  - *write:briefs* --- POST briefs.
  - *write:invites* --- create invites.
  - *read:orders:linked* --- read orders that carry the partner's
    referral id.
  - *read:payouts:self* --- payouts addressed to this partner account.

- **Consent screen**: shows scopes, privacy summary, link to partner
  terms.

**Artifacts**

- api/oauth/.well-known/openid-configuration
- *api/docs/scopes.md* --- human‑readable scope matrix and examples.

## **1.27.4 Rate limits, quotas & abuse controls**

- **Default**: 10 RPS burst, 2 RPS sustained per client, adjustable per
  partner plan.
- **Quotas**: 100k requests/day (public inventory); 5k webhook
  deliveries/day.
- **Abuse**: WAF allows only partner CIDRs optionally; anomaly detection
  → temporary blocks; 429 with *Retry-After*.
- **Idempotency**: all *POST* accept *Idempotency-Key* header; server
  stores 24h keys.

## **1.27.5 Webhooks (events, security, retries)**

**Event types (MVP)**

- *order.created\|paid\|cancelled\|refunded* (refund kernel results
  included).
- *message.created* (subject redacted; counts + IDs).
- *brief.created\|responses_threshold* (when responses cross a
  threshold).
- *payout.initiated\|succeeded\|failed*.
- *dmca.takedown\|restore* (only when partner previously ingested the
  asset via API/work feed).

**Security & delivery**

- **HMAC‑SHA256** signature over raw body using shared secret; header:
  *X-RastUp-Signature* and *X-RastUp-Timestamp*.
- Reject if timestamp skew \> 5 min.
- **Retries**: exponential backoff to 24h; DLQ after 10 attempts;
  replays available from **Events API** with pagination.
- **Idempotency**: partners must treat event *id* as unique; we never
  reorder within the same *aggregate_id* (order/thread).

**Artifacts**

- *api/webhooks/signing.md* --- signature verification examples (TS,
  Python).
- *contracts/webhooks/\*.json* --- JSON Schemas (pinned by version).

## **1.27.6 Versioning & compatibility**

- **REST**: URI‑level versioning (*/v1/\...*); additive changes only
  in‑place; breaking changes via */v2*.
- **Webhooks**: *X-RastUp-Event-Version* header; partners register
  accepted versions; we provide **compat** payloads for one version
  behind.
- **Deprecation**: 90‑day notice; email + dashboard