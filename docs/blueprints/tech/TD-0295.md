<!-- id: TD-0295 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1062000-1066000 -->

*
- **M.** SBOM & Dependency Policy *(new, as you requested)*
- **N.** Disaster Recovery Matrix (RTO/RPO) & DR Runbooks *(new)*
- **O.** Data Governance (Retention, Classification, Masking, Lineage)
  *(new)*
- **P.** Requirements Traceability Matrix (RTM) --- framework & seed
  entries *(new)*

## **Appendix I --- Configuration & Flags Registry (paste‑ready)**

**Purpose.** Single source of truth for environment variables, secrets,
feature flags, and safe defaults.

**I.1 Registry file & columns**

- File: *ops/config/registry.md*
- Columns: **Key**, **Service**, **Env** (*dev\|stage\|prod*), **Type**,
  **Default**, **Allowed values**, **Secret store**, **Owner**,
  **Rotation**, **Notes**.

**I.2 Canonical entries (representative)**

- *APP_ENV* --- web/api --- all --- enum --- *dev* ---
  *{dev,stage,prod}* --- plain --- Platform --- n/a --- telemetry
  sampling.
- *GRAPHQL_URL* --- web --- dev/stage --- URL --- (env‑specific) ---
  must be HTTPS in prod --- plain --- Platform --- n/a.
- *JWT_AUDIENCE* --- api --- all --- string --- *rastup-app* --- fixed
  --- plain --- Security --- n/a.
- *DB_SECRET_ARN* --- api --- stage/prod --- ARN --- none --- required
  --- **Secrets Manager** --- Security --- **90d**.
- *KMS_KEY_APP* --- api --- prod --- ARN --- none --- required ---
  **KMS** --- Security --- **annual**.
- *STRIPE_SECRET_KEY* --- api --- stage/prod --- secret --- none ---
  required --- **Secrets Manager** --- Finance --- rotate on leak.
- *STRIPE_WEBHOOK_SECRET* --- api --- stage/prod --- secret --- none ---
  required --- **Secrets Manager** --- Finance --- rotate on leak.
- *TYPESENSE_API_KEY* --- api/indexer --- all --- secret --- none ---
  required --- **Secrets Manager** --- Search --- **180d**.
- *EMAIL_FROM* --- notifications --- prod --- email ---
  [*noreply@rastup.com*](mailto:noreply@rastup.com) --- domain must pass
  DMARC --- Comms --- n/a.
- *SAFE_MODE_DEFAULT* --- web/api --- all --- bool --- *true* ---
  true/false --- Safety --- n/a.
- *FEATURE_INSTANT_BOOK* --- web/api --- all --- flag --- *off* ---
  *{off,canary,100%}* --- Launch --- n/a.

**I.3 Secrets handling & rotation**

- All *\*\_SECRET\** keys in **AWS Secrets Manager** (least‑privilege
  IAM).
- Rotation runbook: *ops/runbooks/secret_rotation.md* (generate → deploy
  → verify → decommission).

**I.4 Feature flags**

- File: *ops/config/flags.yaml* (key, owner, rollout plan, kill switch).
- Changes by PR or via Admin console with audit events.

**I.5 Acceptance**

- Services boot using only keys in registry; CI fails unknown keys;
  secrets rotation rehearsal quarterly.

## **Appendix J --- API Error & Semantics Registry (paste‑ready)**

**Purpose.** Predictable errors across REST, GraphQL, and webhooks;
clear idempotency and pagination.

**J.1 Error model**

- **HTTP**: *400* validation, *401* auth, *403* authz, *404* not found,
  *409* conflict, *422* domain rule, *429* rate limit, *5xx* server.
- **GraphQL**: *errors\[\].extensions.code* in *{BAD_USER_INPUT,
  UNAUTHENTICATED, FORBIDDEN, NOT_FOUND, CONFLICT, RATE_LIMITED,
  INTERNAL}*.
- **Webhooks**: signed; *2xx* success; non‑*2xx* retries with backoff;
  *410* unsubscribes.

**J.2 Canonical error codes (subset)**

- *AUTH.INVALID_CREDENTIALS* (401) --- "Email or password is incorrect."
- *AUTH.MFA_REQUIRED* (401) --- "Step‑up verification required."
- *BOOKING.SLOT_TAKEN* (409) --- "That time was just booked. Pick
  another slot."
- *PAYMENT.CARD_DECLINED* (402 / GraphQL error) --- "Your bank declined
  the charge."
- *RATE.LIMITED* (429) --- *X‑RateLimit‑\** + *Retry‑After* headers.
- *WEBHOOK.SIGNATURE_INVALID* (400) --- "Signature invalid or timestamp
  skew too large."

**J.3 Idempotency**

- All *POST* accept *Idempotency‑Key*; duplicate returns prior
  **status+body** with *Idempotent‑Replay: true*.

**J.4 Pagination**

- Cursor‑based; response includes *next_cursor*; absence = end.
  Per‑endpoint *limit* caps documented.

**J.5 Deprecation**

- *Sunset* header + *Deprecat