<!-- id: TD-0088 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 316800-320800 -->

null default now()*\
*);*\
\
*\-- Calculated refund/goodwill outcomes (mirror §1.9 fee/tax logic)*\
*create table support_refund (*\
*refund_id text primary key, \-- srf\_\...*\
*case_id text not null references support_case(case_id) on delete
cascade,*\
*leg_id text,*\
*order_id text,*\
*amount_cents int not null,*\
*platform_fee_cents int not null,*\
*platform_fee_tax_cents int not null,*\
*reason text not null,*\
*processor_ref text, \-- refund id on Stripe*\
*status text not null check (status in
(\'proposed\',\'processing\',\'succeeded\',\'failed\')),*\
*created_at timestamptz not null default now()*\
*);*\
\
*\-- Payout holds (linked to legs/orders)*\
*create table payout_hold (*\
*hold_id text primary key, \-- sph\_\...*\
*case_id text not null references support_case(case_id),*\
*leg_id text,*\
*order_id text,*\
*amount_cents int not null, \-- up to the payable amount*\
*status text not null check (status in
(\'applied\',\'released\',\'expired\')),*\
*created_at timestamptz not null default now()*\
*);*\

**S3**:

- *support-evidence/* (immutable, WORM‑like via object‑lock if enabled)
  stores attachments (photos, manifests, logs PDF). Lifecycle →
  Intelligent‑Tiering \@30d; Glacier \@180d.

## **1.15.F Evidence & timeline stitching**

When a case opens or moves to **Investigating**, the system
auto‑collects:

- **Messages & action cards** (from §1.4) for the thread(s) related to
  *leg_id* or *request_id*.
- **Docs & signatures** (from §1.5)---hashes and acceptance timestamps.
- **Deliverables & approvals** (proofs/finals manifests).
- **Geo/time** events (check‑ins, scheduled time windows, IP/device
  changes).
- **Finance**: charge, refund, payout records (§1.9).
- **Comms**: notification delivery (for "no response" claims).
- **Risk**: user risk scores (§1.6.G).

Evidence appears in a **chronological timeline** within the case.

## **1.15.G API (GraphQL) & Support Center (user‑facing)**

*type SupportCase {*\
*caseId: ID!, type: String!, subtype: String, status: String!, severity:
String!,*\
*createdAt: AWSDateTime!, updatedAt: AWSDateTime!,*\
*lbgId: ID, legId: ID, orderId: ID, studioId: ID, creatorId: ID,*\
*reasonCode: String, ownerUserId: ID, slaDueAt: AWSDateTime*\
*}*\
*type SupportMessage {*\
*msgId: ID!, authorRole: String!, bodyMd: String!, createdAt:
AWSDateTime!*\
*attachments: \[Attachment!\]!*\
*}*\
*type SupportRefund { refundId: ID!, amountCents: Int!, status: String!,
createdAt: AWSDateTime! }*\
\
*type Query {*\
*mySupportCases(cursor:String, limit:Int=20): \[SupportCase!\]!*\
*supportCase(caseId: ID!): SupportCase!*\
*supportMessages(caseId: ID!, cursor:String, limit:Int=50):
\[SupportMessage!\]!*\
*}*\
\
*input OpenCaseInput {*\
*type: String!, subtype: String, severity: String = \"normal\",*\
*lbgId: ID, legId: ID, orderId: ID, studioId: ID, creatorId: ID,*\
*reasonCode: String, bodyMd: String!, attachments:\[AttachmentInput!\]*\
*}*\
\
*type Mutation {*\
*openCase(input: OpenCaseInput!): SupportCase!*\
*postSupportMessage(caseId: ID!, bodyMd: String!,
attachments:\[AttachmentInput!\]): SupportMessage!*\
*closeCase(caseId: ID!): Boolean!*\
*}*\

**Guards**

- Role‑scoped visibility: buyer sees their cases; seller/creator sees
  cases naming them; agents see all.
- Attachments scanned (NSFW/AV) as in §1.14.4.
- Rate‑limits on open‑case attempts.

**Support Center UI**

- "Report a problem" flows pre‑filled from booking/order context.
- Case list, case detail with timeline, message composer, attachment
  upload, status chips.

## **1.15.H Email bridge (SES) & routing**

- **Inbound**:
  [*case+{case_id}@support.rastup.com*](mailto:case+%7bcase_id%7d@support.rastup.com)
  → SES inbound rule → Lambda → *support_message* append (author
  detection via DKIM/DMARC + token).
- **Outbound**: replies include *Message‑ID*/*In‑Reply‑To*;
  List‑Unsubscribe for marketing categories unaffected.
- **Auto‑ack**: immediate "we received your request" message with case
  id and SLA.

## **1.15.I Automations, macr