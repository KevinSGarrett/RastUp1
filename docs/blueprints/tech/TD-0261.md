<!-- id: TD-0261 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 939600-943600 -->

ial**: payouts, amounts, tax forms (W‑9/W‑8), Stripe
  identifiers (no PAN).
- **Sensitive‑Media**: NSFW originals (never on public surfaces).

**Inventory artefacts**

- *security/data_inventory.md* --- tables, fields, class, retention.
- *security/flows/\*.svg* --- data flows (web/app ↔ AppSync/Lambda ↔
  Aurora/S3/Stripe/Typesense).
- *security/dpa_registry.md* --- processors & sub‑processors (Stripe,
  email/SMS, image CDN).

## **1.24.3 Threat model (high‑level)**

- **Auth/session**: credential stuffing, session fixation, token theft.
- **Access controls**: horizontal privilege escalation across roles
  (buyer/provider/admin).
- **Content**: NSFW leakage, DMCA evasion, malicious uploads.
- **Payments**: refund abuse, chargeback fraud, payout diversion.
- **Platform**: SSRF/XSS/SQLi, misconfigured S3 buckets, excessive IAM
  permissions.
- **Supply abuse**: review rings, profile spam, promotions gaming
  (mitigations in §1.20).
- **Privacy**: over‑collection, log PII leakage, retention overage.

Mitigations below map one‑to‑one to threats.

## **1.24.4 Identity, auth & session security**

- **User auth**: Cognito hosted UI + social login; enforce **MFA
  optional** for buyers, **MFA recommended/required** for providers;
  password policy with breach checks (k‑anon list).
- **Admin SSO**: Google/Microsoft via SAML/OIDC; step‑up MFA for
  privileged actions; IP allowlists + WAF on admin routes.
- **Session**: HTTP‑only, Secure, SameSite=Lax cookies for web; rotating
  refresh tokens on app; 30‑min inactivity timeout; 24‑hour absolute for
  web sessions.
- **Authorization**: ABAC + RBAC (*role*, *city_scope*, *team*)
  evaluated in AppSync resolvers; deny‑by‑default.
- **Device trust** (optional): risk scoring on unfamiliar device +
  high‑risk actions (payout change → step‑up).

Artifacts: *security/authz_policies.md*, *api/middleware/authz.ts*
(policy evaluators), login rate‑limit & lockout.

## **1.24.5 Network, infrastructure & key management**

- **VPC**: private subnets for Aurora & ECS; only Lambdas/ALBs can reach
  them; VPC endpoints for S3/Secrets.
- **WAF**: SQLi/XSS, bot control, geo rate‑limits; captcha challenge on
  abuse; admin URLs behind stricter rules.
- **TLS**: HSTS + TLS 1.2+ everywhere; CloudFront origin access
  identities; S3 buckets private by default.
- **KMS**: per‑domain keys (*kms/data*, *kms/logs*, *kms/backup*); key
  rotation annually; CMK access scoped to service roles.
- **CloudTrail**: org‑level, all accounts, delivered to S3 with Object
  Lock; **GuardDuty** enabled (cost‑scoped to prod + stage).
- **Secrets**: AWS Secrets Manager & SSM Parameter Store with 90‑day
  rotation; **no secrets in env vars** in code.

Artifacts: *infra/cdk/security.ts* (WAF, KMS, Trails),
*security/kms_key_plan.md*.

## **1.24.6 Application security (SDLC)**

- **Pre‑commit**: secret scan, lint, typecheck.
- **PR gates**: CodeQL SAST, dependency audit (*osv-scanner*), license
  policy, IaC linter (CDK diff validators), GraphQL schema contract
  tests.
- **DAST**: nightly OWASP ZAP against *stg* with allowlist; alerts
  create issues.
- **SBOM**: generated per build (CycloneDX) and archived; diffed on
  releases.
- **Vuln SLAs**: Critical 24h, High 7d, Medium 30d, Low 90d.
- **Pen‑tests**: pre‑GA and annually; remediation tracked.
- **Bug bounty**: optional private program post‑GA.

Artifacts: *.github/workflows/security-scans.yml*,
*security/sbom/README.md*, *security/vuln_sla.md*.

## **1.24.7 Data‑at‑rest & in‑transit controls**

- **At rest**:

  - Aurora: KMS‑encrypted; tables with PII flagged; **row‑level
    masking** in admin read paths.
  - S3: server‑side encryption; bucket policies deny public access; **S3
    WORM** for admin audit logs.
  - Typesense: EBS volume encryption; snapshots to S3 encrypted.

- **In transit**: TLS from clients → CloudFront → AppSync → Lambda; VPC
  TLS to Aurora; signed URLs for private S3 media.

- **Client storage**: only ephemeral; no PII in localStorage; tokens in
  HTT