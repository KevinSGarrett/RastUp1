<!-- id: TD-0326 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1173600-1177600 -->

. **Aurora:** PITR retention ≥ **7 days**; scheduled **snapshot
      copy** to *REGION_B*.
5590. **DynamoDB:** **Global Tables** for small, hot, ephemeral data.
5591. **DNS:** Route53 failover records with health checks; ACM certs
      prepared (CloudFront cert in *us‑east‑1*).
5592. **Reindex pipeline:** A single command/script can rebuild
      Typesense from DB (hot filters first).
5593. **Runbooks & drills:** Quarterly drills; time‑stamped results.

## **N.3 Backups, replication & rotation**

- **Aurora PITR:** automated; window covers at least one release cycle.
  **Snapshot copy** to *REGION_B* nightly.
- **S3:** *BucketPolicy* blocks *s3:DeleteObjectVersion* except via
  break‑glass role; Object Lock 7--30 days for compliance buckets.
- **DynamoDB:** Global Tables across A/B; enable PITR in both.
- **Configs:** Export CloudFront, WAF, Route53 configs to IaC; store in
  repo.
- **Secrets:** A small Lambda replicates secret updates A→B with
  encryption context.

## **N.4 Runbooks (step‑by‑step)**

Commands use placeholders --- set these at runtime:

*export PRIMARY=REGION_A*\
*export SECONDARY=REGION_B*\
*export AURORA_CLUSTER_ID=prod-core-cluster*\
*export NEW_CLUSTER_ID=dr-core-\$(date +%Y%m%d%H%M)*\
*export RESTORE_TS=\"2025-11-06T12:30:00Z\" \# use "latest restorable"
for corruption; exact TS for user error*\
*export TYPESENSE_ENDPOINT=https://ts-dr.example.com*\
*export S3_ORIG_BUCKET=media-originals-prod*\
*export S3_SFW_BUCKET=media-sfw-prod*\
*export HOSTED_ZONE_ID=Z123456*\
*export PROD_DOMAIN=rastup.com*\

### **RB‑N‑01 --- Regional failover (A → B)**

**When:** Region‑wide outage; multi‑AZ failure; long control‑plane
incident.\
**RTO target:** ≤ **90 min** (pilot‑light); faster with warm standby.

5599. **Declare SEV & freeze writes** (feature flag
      *global_readonly=true* if A partially alive).
5600. Stand up core in B via CDK:

*cdk deploy \--all \--profile prod \--context region=\$SECONDARY*\

5601. **Aurora restore in B** (from most recent cross‑region snapshot or
      PITR):\
      List snapshots:

*aws rds describe-db-cluster-snapshots \--region \$SECONDARY
\--db-cluster-identifier \$AURORA_CLUSTER_ID*\

Restore:

*aws rds restore-db-cluster-from-snapshot \\*\
*\--region \$SECONDARY \\*\
*\--db-cluster-identifier \$NEW_CLUSTER_ID \\*\
*\--snapshot-identifier
arn:aws:rds:\$SECONDARY:\...:cluster-snapshot:\... \\*\
*\--engine aurora-postgresql*\
*\# create a writer instance for the cluster*\
*aws rds create-db-instance \\*\
*\--region \$SECONDARY \\*\
*\--db-instance-identifier \${NEW_CLUSTER_ID}-writer \\*\
*\--db-cluster-identifier \$NEW_CLUSTER_ID \\*\
*\--db-instance-class db.serverless*\

5602. **Point app env to B DB/Lambdas/Typesense.** Update
      Secrets/Parameter Store in B with new endpoints.
5603. **Typesense in B (fresh cluster):** run reindex (RB‑N‑04).
5604. **CloudFront failover**: update origins to B; **Route53** swap
      (weighted→failover or health‑checked alias):

*aws route53 change-resource-record-sets \--hosted-zone-id
\$HOSTED_ZONE_ID \--change-batch*
[*file://ops/dr/route53-failover-to-B.json*](file://ops/dr/route53-failover-to-B.json)

5605. **Smoke tests:** auth, search, profile, checkout (test mode),
      messaging.
5606. **Lift read‑only**, monitor error rates.
5607. **Post‑incident:** document delta, costs, and back‑sync plan A↔B.

### **RB‑N‑02 --- Aurora point‑in‑time restore (logical corruption)**

**When:** bad migration, accidental mass delete/update, application
bug.\
**RPO:** ≤ **5--15 min** (to latest restorable) or exact known
timestamp.

5608. **Declare SEV, freeze writes** (*global_readonly=true*).
5609. **Restore new cluster to TS**:

*aws rds restore-db-cluster-to-point-in-time \\*\
*\--region \$PRIMARY \\*\
*\--db-cluster-identifier \$NEW_CLUSTER_ID \\*\
*\--source-db-cluster-identifier \$AURORA_CLUSTER_ID \\*\
*\--restore-to-time \"\$RESTORE_TS\" \\*\
*\--use-latest-restorable-time false \\*\
*\--engine aurora-postgresql*\
*aws rds create-db-instance 