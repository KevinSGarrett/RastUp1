<!-- id: TD-0021 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 75600-79600 -->

ActionCard!*\
*}*\

Each action card mutates both **DynamoDB** (message frame + CARD shadow)
and **Aurora** (leg/LBG state via §1.3 services). For example,
*requestExtra* calls the **Checkout/Amendments** service to price &
charge the delta.

### **C.4 Subscriptions**

*type Subscription {*\
*threadEvents(threadId: ID!): ThreadEvent! \# message new, edited,
action state, presence*\
*inboxEvents: InboxEvent! \# new thread, unread counts*\
*presence(threadId: ID!): PresenceEvent! \# typing, online/lastSeen*\
*}*\

## **1.4.D Project Panel tabs --- schemas & behavior**

### **D.1 Brief**

- **Schema**: title, goals, style references (links), mood notes,
  must‑have shots, constraints, budget notes.
- **Versioning**: optimistic concurrency; edits write a new version and
  emit *panel.brief.update*.

### **D.2 Moodboard**

- **Pins**: references to portfolio assets or external URLs (image cards
  with source attribution).
- **Ordering**: drag‑drop; server persists index.
- **NSFW**: Safe‑Mode rules (blur/hidden) apply to pins as with
  messages.

### **D.3 Shot list**

- **Items**: *{ id, name, notes, refs:\[pinId\], owner:userId, status:
  \"todo\|done\" }*.
- **Templates**: start from roles' presets; saved as reusable templates.
- **Stats**: completion percentage for the day; surfaces in thread
  header.

### **D.4 Files**

- **Buckets**: *Proofs* (previews in S3), *Finals* (external manifests).
- **Guardrails**: finals must be **external**; internal proofs have size
  limits; virus & NSFW scans on upload.
- **Manifests**: table in Aurora *deliverable_manifest (legId,
  manifestId, entries\[\], checksum, externalProvider, immutable=true)*.

### **D.5 Docs & e‑sign**

- Read‑only in panel: envelope status (per leg); links to PDF (hashed).
  If unsigned, show **action card** to prompt sign.

### **D.6 Expenses**

- Live rollup of **amendments** (extras/overtime) & **refunds** from
  §1.3; sum per leg and group; clickable to open receipts.

### **D.7 Actions**

- List **open action cards** (state machines): accept/decline/resubmit;
  all actions audit to thread + domain event.

## **1.4.E Action cards --- contract & state machines (examples)**

**All actions share:** *actionId*, *type*, *payload{}*, *state*,
*version*, *createdBy*, timestamps, and **idempotencyKey**.

- Reschedule

  - *payload*: *{ old: DateRange, proposed: DateRange }*
  - *state*: *PENDING → ACCEPTED\|DECLINED\|EXPIRED*
  - Accept transitions booking (§1.3) to new times if conflict‑free.

- Request Extra / Overtime

  - *payload*: *{ name, priceCents }* or *{ minutes }*
  - *state*: *PENDING → PAID\|DECLINED*
  - On approve → calls **Amendments**; on pay fail → *FAILED* with error
    code.

- Deliverables

  - Proof/Final cards include *manifestRef* to aura row.
  - Buyer: *APPROVE_DELIVERABLE* → *APPROVED*; or *REQUEST_REVISIONS* →
    *REVISION_REQUESTED* (optional extra cost via change order).

- Cancel/Refund

  - Calls §1.3 policy engine; returns quoted outcome; Support/Admin can
    override via console (dual‑approval).

- Deposit claim

  - Studio opens claim with amount + evidence; Support approves/denies;
    on approve → capture deposit hold.

- Dispute

  - Opens processor dispute row; triggers evidence kit builder; timeline
    pinned in panel.

## **1.4.F Presence, read receipts, typing**

- **Read receipts**: per participant, store *lastReadMsgId* and
  *lastReadAt*; messages with ts ≤ lastReadAt show as read.
- **Typing**: client emits ephemeral *typing=true* events
  throttle‑debounced; server writes presence TTL item; subscription
  broadcasts.
- **Online**: presence entries updated on ping; absences \> TTL means
  offline.

## **1.4.G Moderation, safety, anticircumvention**

- **Text filters**: regex + ML models for PII/banlist (emails, phone,
  Venmo/CashApp handles).

  - First hit → **nudge** (educational banner).
  - Repeat → **soft block** sending with "Use on‑platform checkout."
  - Abuse → escalation to T&S; rate‑limits or temp mutes per