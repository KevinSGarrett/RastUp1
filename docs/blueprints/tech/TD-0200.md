<!-- id: TD-0200 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 720000-724000 -->

{startTsLocal}} in
{{city}} is confirmed.\</mj-text\>*\
*\<mj-button href=\"{{ctaUrl}}\"\>Open booking\</mj-button\>*\
*\</mj-column\>\</mj-section\>\</mj-body\>\</mjml\>*\
*text_body: Booking confirmed with {{buyerName}} on {{startTsLocal}}.
Details: {{ctaUrl}}*\
*push_title: Booking confirmed*\
*push_body: {{buyerName}} --- {{startTsLocal}}. Tap for details.*\
*inapp_title: Booking confirmed*\
*inapp_body: {{buyerName}} on {{startTsLocal}}*\

## **1.10.8 Quiet Hours (DND) & critical exceptions**

- Users set a local window (e.g., 22:00--07:00). During Quiet Hours:

  - **Optional** notifications are queued for digest or delayed until
    window end.
  - **Transactional** non‑urgent items are delayed or delivered silently
    (in‑app only).
  - **Critical exceptions** always deliver: *booking.reminder_24h\|1h*,
    **reschedule expiring in \<6h** (Action Card), *payment.failed*,
    *payout.failed*, *safety.case.opened*. Your plan requires "requests
    still deliver silently with summaries," so we deliver in‑app banners
    and can email a **summary** if user enables exceptions.

NonTechBlueprint

## **1.10.9 Digests (daily/weekly)**

- **Builder** runs per user's timezone; assembles: new message requests,
  approvals pending, upcoming bookings (with ICS link), recent file
  uploads. This matches your "bundle every X hours unless 'Booking day'
  (then realtime)."

NonTechBlueprint

- **De‑dup**: if a transactional email already sent \<N hours ago,
  include only a summary line.
- **Opt‑in cadence**: active users default to **daily**, low‑activity to
  **weekly** (user can change).

## **1.10.10 Deliverability & suppression**

- **DNS**: SPF, DKIM, DMARC (start *p=quarantine*, move to *p=reject*
  post‑warmup).
- **Warmup**: ramp volumes using high‑engagement transactional email
  (booking & receipts) first.
- **Feedback loops**: SES webhooks write
  *notify_consent(action=\'hard_bounce\'\|\'complaint\')*; we
  **suppress** further sends and show an in‑app banner asking the user
  to reconfirm/email‑change.
- **Link tracking**: limited, never used on safety/IDV/legal mail.
- **From/Reply‑To**: consistent brand and SPF alignment.

## **1.10.11 Security, privacy, compliance**

- **Consent ledger** records every opt‑in/out/unsubscribe/resubscribe,
  with IP/UA and source; immutable.
- **Required‑service** emails (receipts, legal, security) cannot be
  disabled.
- **Age/NSFW**: never include NSFW previews in external channels; link
  to in‑app surfaces that honor Safe‑Mode defaults. (Your public
  surfaces are SFW by default.)

NonTechBlueprint

## **1.10.12 Rate limits & cost controls**

- **Per‑user/channel** token buckets for optional notifications;
  transactional exempt but idempotent.
- Monitor SES/Pinpoint spend; add an **adapter** for a secondary ESP if
  SES throttles.
- Register only **active** device tokens; expire tokens after 90 days of
  inactivity.

## **1.10.13 Observability & KPIs**

- **Events**: *notify.sent\|failed\|suppressed\|quieted*,
  *notify.open\|click* (email), *push.open*, *digest.sent*,
  *pref.changed*, *unsubscribe*.
- **Dashboards**: delivery rate, open/click, push opens, digest
  engagement, opt‑out rate, quiet‑hour suppression count, cost/1k sends,
  notifications per booking.
- Alerts on spikes in bounces/complaints, template compile errors,
  digest failures.

## **1.10.14 Work packages (Cursor --- 4 agents)**

- **Agent A --- Data & API**: migrations, resolvers, consent ledger,
  prefs UI endpoints.
- **Agent B --- Orchestrator & Templates**: event routing, MJML compile,
  localization scaffolding.
- **Agent C --- Delivery & Compliance**: SES/Pinpoint integration, DNS,
  bounce/complaint handlers.
- **Agent D --- Digests & Quiet**: digest builder, timezone scheduling,
  Quiet‑Hour logic & exceptions.

## **1.10.15 Test plan**

3276. **Preferences**: toggle per‑event/channel; verify optional sends
      suppressed; required‑service still deliver.
3277. **Quiet Hours**: optional messages delaye