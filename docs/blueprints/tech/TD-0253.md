<!-- id: TD-0253 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 910800-914800 -->

ngest & Contracts**: API Gateway/Lambda */e*, JSON
  schema registry & validator, Bronze S3 writer, DLQ.
- **Agent B --- Lake & Models**: Iceberg tables, CTAS to Silver, dbt
  project for Gold (sessions, funnels, attribution, experiments).
- **Agent C --- Experiments**: assignment, exposures, CUPED/Bayesian
  estimators, SRM alerts, results table & API.
- **Agent D --- Dashboards & Ops**: QuickSight/Superset dashboards,
  pipeline health monitors, cost & lag alerts, DSAR delete job.

## **1.21.15 Tests (representative)**

4199. **Schema validation**: invalid payload rejected to DLQ; valid
      passes; contract version bump triggers CI fail until model
      updated.
4200. **Identity stitch**: login event links anon_id to user_id;
      downstream models show consolidated identity.
4201. **Attribution**: with and without *click_token*; last‑non‑direct
      logic; fraud filter removes repeated rapid clicks.
4202. **Experiments**: sticky assignment; SRM detection on skew; CUPED
      reduces variance vs. raw.
4203. **End‑to‑end**: *search.query → result_click → profile.view →
      checkout.start → checkout.complete* flows through to *fact_orders*
      within SLA.
4204. **Privacy**: DSAR removes identity across all layers; cache
      invalidated; reports show anonymized aggregates only.
4205. **Cost**: transforms finish within time window; BI queries respect
      partitions.

## **1.21.16 Artifacts (paste‑ready)**

- *infra/analytics/ingest.yml* --- API Gateway + Lambda + Kinesis
  (optional) IaC.
- *analytics/schema/events/\*.json* --- event JSON Schemas (registry).
- *db/migrations/028_analytics.sql* --- Athena/Iceberg table DDLs.
- *analytics/dbt_project.yml* & *models/\** --- dbt project (sessions,
  funnels, attribution, experiments).
- *services/experiments/\** --- assignment & estimators.
- *observability/dashboards/analytics.md* --- pipeline & KPIs.
- *ops/runbooks/analytics-pipeline.md* --- deploy, rollback, reprocess,
  and DR procedures.

## **1.21.17 Acceptance criteria --- mark §1.21 FINAL only when ALL true**

4213. */e* ingest live; events land in Bronze and are visible in Silver
      within **≤ 5 minutes** (p95).
4214. Gold models (sessions, funnels, attribution, experiments)
      materialize daily; queries reproducibly compute KPIs.
4215. Attribution honors click‑token precedence and last‑non‑direct;
      fraud filters in place.
4216. Experiments operate with sticky assignment, SRM monitoring,
      CUPED/Bayesian estimators, and decision reports.
4217. Dashboards show marketplace & growth KPIs; pipeline health alarms
      live.
4218. Privacy: PII redaction, consent gating, and DSAR delete propagate
      across Bronze/Silver/Gold.
4219. Cost within budget (Athena/dbt primary; Redshift only for hot
      dashboards).

# **§1.22 --- Admin, Trust & Safety, and Back‑Office Console**

**Full Technical Development Plan (copy‑paste block for your master
doc)**

**Purpose.** Provide a secure, auditable, and efficient **internal
console** for Support, Trust & Safety, Finance, Content Editors, and
City Ops. Power **moderation**, **verification**,
**refunds/chargebacks**, **suspensions**, **feature flags**, and
**city‑level configs**. Integrates with **Orders & Refund Kernel
(§1.14--§1.15)**, **Studios Verification (§1.19)**, **Search/Safe‑Mode
(§1.18)**, **Promotions (§1.20)**, **Help Center (§1.20)**, and
**Analytics (§1.21)**. Built for **Amplify Gen‑2** + **AppSync** +
**Aurora** with **serverless** cost posture.

## **1.22.1 Objectives & invariants**

4220. **Least privilege.** Role‑based access with **scoped
      permissions**; sensitive actions require reason codes and dual
      controls where mandated.
4221. **Full auditability.** Every privileged read/write emits a
      **WORM** audit record with cryptographic chaining.
4222. **Safety gates by default.** SFW previews only; non‑SFW assets
      never render in public contexts; staff views are watermarked.
4223. **Fast & decisive.** One‑click macros for 