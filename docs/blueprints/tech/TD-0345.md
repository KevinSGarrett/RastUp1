<!-- id: TD-0345 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1242000-1246000 -->

 priceMin = faker.number.int({min:50,max:200});*\
*const priceMax = priceMin + faker.number.int({min:50,max:250});*\
*const city = pick(cities);*\
*await db.query(\`*\
*INSERT INTO profiles
(id,user_id,roles,headline,bio,price_min,price_max,city,country,lat,lng,verified,nsfw_band,published_at,updated_at)*\
*VALUES
(\$1,\$2,ARRAY\[\$3\],\$4,\$5,\$6,\$7,\$8,\$9,\$10,\$11,\$12,0,now(),now())*\
*ON CONFLICT (user_id) DO UPDATE SET roles=EXCLUDED.roles,
price_min=EXCLUDED.price_min, price_max=EXCLUDED.price_max,
updated_at=now()*\
*\`, \[faker.string.uuid(), userId, r, faker.person.jobTitle(),
faker.lorem.sentences(2), priceMin, priceMax, city.city, city.country,
city.lat, city.lng, verified\]);*\
*}*\
\
*async function seedReviews(profileUserIds:string\[\]) {*\
*for (const pid of profileUserIds) {*\
*const n = cfg.reviews_per_profile;*\
*for (let i=0;i\<n;i++) {*\
*const author = faker.string.uuid();*\
*await db.query(\`*\
*INSERT INTO reviews (id, author_id, subject_user_id, rating, body,
created_at)*\
*VALUES (\$1,\$2,\$3,\$4,\$5,now())*\
*ON CONFLICT (id) DO NOTHING*\
*\`, \[faker.string.uuid(), author, pid,
faker.number.int({min:4,max:5}), faker.lorem.sentences(2)\]);*\
*}*\
*}*\
*}*\
\
*async function seedMessages(users:string\[\]) {*\
*for (let i=0;i\<cfg.messages_threads;i++) {*\
*const a = pick(users), b = pick(users);*\
*if (a === b) continue;*\
*const threadId = faker.string.uuid();*\
*const count = faker.number.int({min:3,max:10});*\
*for (let m=0;m\<count;m++) {*\
*await db.query(\`*\
*INSERT INTO messages
(id,thread_id,sender_id,body_ciphertext,created_at)*\
*VALUES (\$1,\$2,\$3,pgp_sym_encrypt(\$4, \'nonprod_key\'), now() - (\$5
\|\| \' minutes\')::interval)*\
*ON CONFLICT (id) DO NOTHING*\
*\`, \[faker.string.uuid(), threadId, m%2===0?a:b,
faker.lorem.sentence(), faker.number.int({min:0,max:1440})\]);*\
*}*\
*}*\
*}*\
\
*async function main() {*\
*await db.query(\'BEGIN\');*\
*const users:string\[\] = \[\];*\
*for (let i=0;i\<cfg.users;i++) users.push(await upsertUser(i));*\
*const providerIds = users.slice(0,cfg.providers);*\
*for (const uid of providerIds) await upsertProfile(uid,
faker.datatype.boolean(0.3));*\
*await db.query(\'COMMIT\');*\
\
*await seedReviews(providerIds);*\
*await seedMessages(users);*\
\
*console.log(\`Seeded users=\${users.length},
providers=\${providerIds.length}\`);*\
*await db.end();*\
*}*\
*main().catch(async (e)=\>{ console.error(e); await db.end();
process.exit(1); });*\

The seeder **never sends emails** or hits Stripe. Any "welcome"
sideâ€‘effects must be behind *if (SANDBOX_MODE!==1)*.

Add *npm scripts*:

*\"scripts\": {*\
*\"seed:dev\": \"ts-node \--swc seeds/seed.ts dev\",*\
*\"seed:ci\": \"ts-node \--swc seeds/seed.ts ci\",*\
*\"seed:demo\": \"ts-node \--swc seeds/seed.ts demo\"*\
*}*\

## **S.6 Media fixtures (synthetic images to S3) ---** ***/media-fixtures/gen_images.ts***

*import { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\";*\
*import { createCanvas } from \"canvas\";*\
\
*const count = parseInt(process.env.COUNT \|\| \"300\", 10);*\
*const bucket = process.env.BUCKET \|\| \"rastup-dev-sfw\";*\
*const s3 = new S3Client({});*\
\
*function pngBytes(w:number,h:number,text:string) {*\
*const c = createCanvas(w,h); const ctx = c.getContext(\'2d\');*\
*ctx.fillStyle = \"#ddd\"; ctx.fillRect(0,0,w,h);*\
*ctx.fillStyle = \"#666\"; ctx.font = \"bold 28px sans-serif\";
ctx.textAlign=\"center\"; ctx.textBaseline=\"middle\";*\
*ctx.fillText(text, w/2, h/2);*\
*return c.toBuffer(\"image/png\");*\
*}*\
\
*(async () =\> {*\
*for (let i=0;i\<count;i++) {*\
*const key = \`sfw/demo\_\${i}.png\`;*\
*const body = pngBytes(1200, 800, \`Demo \${i}\`);*\
*await s3.send(new PutObjectCommand({ Bucket: bucket, Key: key, Body:
body, ContentType: \"image/png\", CacheControl:
\"public,max-age=31536000\" }));*\
*console.log(\`uploaded s3://\${bucket}/\${key}\`);*\
*}*\
*})();*\

- Produces neutral, SFW images with **no real people**.
- Manifest (*/media-fixtures/manifest.json*) lists keys/u