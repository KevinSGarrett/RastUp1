<!-- id: TD-0083 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 298800-302800 -->

pe handles retries at 3‑day cadence up to 4 retries; we mirror
  state changes; optional in‑product reminder at 24h before
  cancellation.

### **1.14.5.2 PPV, Tips, Requests (PaymentIntents)**

- Create **PaymentIntent** with:

  - *amount = price + tax + (optional platform fee tax) +
    application_fee_amount* (if platform collects fee).
  - *transfer_data\[destination\]=creator_connect_account* if routing
    funds immediately; otherwise capture centrally then **Transfer**.

- On *payment_intent.succeeded*:

  - **PPV** → insert *fansub_ppv_access*.
  - **Tip** → just record *fansub_order.status=\'succeeded\'*.
  - **Request** → set *fansub_request.status=\'paid\'*, link *order_id*.

### **1.14.5.3 Refunds & disputes**

- Refunds initiated by support or creator (subject to policy):
  *refund.created* & *refund.succeeded* webhooks → update
  *fansub_order.status=\'refunded\'* and revoke entitlements (PPV).

- Chargebacks (*charge.dispute.created*):

  - Set order *status=\'disputed\'*; hide finals; keep previews up;
    workflow in Admin console (evidence: manifest hashes, comms
    history).
  - GL expense entry per §1.9.D.5.

## **1.14.6 Tax & fee math (digital goods)**

- **Buyer line items** (per order/invoice):

*subtotal_cents (creator's content)*\

- content_tax_cents (digital services tax; adapter calculates)
- platform_fee_cents (0 at MVP unless policy says otherwise)
- platform_fee_tax_cents\
  = total_cents (charged)

<!-- -->

- **Platform revenue**: **only** the **platform_fee_cents** (and
  recognized when **collected**) per §1.9; we are not MoR for creator
  content unless explicitly configured (default: platform MoR for
  *platform fee*, not for content price; content is pass‑through).
- **Jurisdictions**: use adapter flags to treat content as **digital
  service**; store tax summary per invoice/order for audit.

## **1.14.7 Accounting & GL (platform side)**

- **At capture** (order or invoice paid):

*Dr Cash:Stripe total_cents*\
*Cr Liability:CreatorPayable subtotal_cents + content_tax_cents (if
pass-through)*\
*Cr Deferred:PlatformFees platform_fee_cents*\
*Cr Liability:TaxPayable:PlatformFeeTax platform_fee_tax_cents*\

- **At payout to creator**:

*Dr Liability:CreatorPayable transfer_amount_cents*\
*Cr Cash:Stripe transfer_amount_cents*\

- **When fee recognized** (immediate on invoice/order paid if we treat
  fee as earned at sale for Fan‑Sub):

*Dr Deferred:PlatformFees platform_fee_cents*\
*Cr Revenue:PlatformFees platform_fee_cents*\

- **Refunds/Chargebacks** mirror §1.9 logic (reverse earned if
  applicable).

If we configure **platform fee = 0** at MVP, platform revenue on Fan‑Sub
is **\$0** and accounting is simpler; we still incur Stripe fees as
expense.

## **1.14.8 State machines**

### **1.14.8.1 Custom Request flow (Step Functions)**

*States:*\
*QuoteIssued -\> (BuyerAccept?) -\> PaymentIntentCreated -\>
PaymentSucceeded*\
*-\> CreatorDelivers -\> (BuyerApproves? -\> Closed)*\
*-\> (BuyerRequestsRevision -\> CreatorDelivers) \[loop max N\]*\
*Cancelled/Refunded/Error (terminal)*\
*Guards:*\
* - IDV/age gates checked on every transition*\
* - Max revisions N configurable (default 2)*\
* - Auto-close after 7 days of inactivity post-delivery (no refund)*\

**Transitions (events & actions)**

- *BuyerAccept* → create PI; hold UI until Stripe returns *succeeded*.
- *PaymentSucceeded* → post system message, unlock **proofs**.
- *CreatorDelivers* → proofs posted; buyer can preview (watermarked).
- *BuyerApproves* → finals manifest recorded; receipt issued.
- *BuyerRequestsRevision* → loop with decrementing counter.
- *RefundIssued* → entitlements revoked; status *refunded*.

### **1.14.8.2 Subscription lifecycle**

- *trialing* (if enabled) → *active* on first invoice; *past_due* →
  *canceled* after dunning; *paused* (manual) halts entitlement updates;
  *canceled* allows access until *current_period_end*.

## **1.14.9 Moderation, DMCA & safety runbooks**

### **1.14.9.1 Moderation pipeline**

