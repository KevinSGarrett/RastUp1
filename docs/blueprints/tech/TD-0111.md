<!-- id: TD-0111 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 399600-403600 -->

e/IDV/esign providers), with **implementation‑grade** controls and
inline artifacts you can paste into the plan. This section will not
advance until it satisfies the **≥99.9%** bar.

## **1.18.A Security canon & threat model**

1915. **Least privilege & zero trust.** Every call is authenticated and
      authorized; no "trusted subnet."
1916. **Default‑deny at edges.** WAF blocks obvious bad traffic; API
      throttles by identity.
1917. **PII minimization.** Only store what we must; tokenize or hash
      where possible; keep PII out of logs.
1918. **Compartmentalization.** Separate AWS accounts per env
      (dev/stage/prod) and per blast radius (prod‑data, prod‑ops).
1919. **Tamper‑evident audit.** Immutable trails for money/IDV/policy
      actions.
1920. **Idempotence everywhere.** All webhooks & money operations
      idempotent (no double charges).
1921. **Cost aware.** Prefer managed services (Amplify, Cognito,
      AppSync, WAF, Security Hub) over self‑hosted appliances.

## **1.18.B Identity & access management (IAM) boundaries**

**Recommended path:** *security/policies/iam-boundaries.md*

- Accounts & org

  - AWS **Organizations** with SCPs: deny *\*:\** at root, deny public
    S3 unless explicitly allowed, deny KMS key deletion.
  - Separate accounts: *rastup-dev*, *rastup-stage*, *rastup-prod*, plus
    *rastup-shared* (log archive) and *rastup-security*.

- Roles

  - **Workload roles**: per Lambda/service with minimal permissions
    (AppSync resolver roles; S3 prefixes; DynamoDB tables).
  - **Human roles**: *AdminLimited* (break‑glass), *OpsReadOnly*,
    *Analyst*, *SecurityEngineer*. MFA enforced; session limits (1--4h).
  - **JIT elevation** via IAM Identity Center (formerly SSO) with
    approval; all admin actions audited.

**Inline artifact --- example least‑priv Dynamo policy**\
**Path:** *security/iam/policies/dynamo-least-priv.json*

*{*\
*\"Version\":\"2012-10-17\",*\
*\"Statement\":\[*\
*{\"Effect\":\"Allow\",\"Action\":\[\"dynamodb:PutItem\",\"dynamodb:GetItem\",\"dynamodb:UpdateItem\"\],*\
*\"Resource\":\"arn:aws:dynamodb:us-east-1:{{account}}:table/fansub_entitlement_cache\",*\
*\"Condition\":{\"ForAllValues:StringEquals\":{\"dynamodb:LeadingKeys\":\[\"USER#\"\]}}}*\
*\]*\
*}*\

## **1.18.C Authentication & authorization (Amplify/AppSync/Cognito)**

**AuthN**

- **Cognito User Pool** for end‑users (buyers/sellers/creators/studio
  owners) with email+password and optional social IdPs (Apple/Google).
- **Cognito Identity Pool** for federated access to limited S3 (signed
  uploads of previews only).
- **Admin/agent** access via **OIDC** (IdP such as Google
  Workspace/Okta) → separate AppSync auth mode.

**AuthZ (AppSync multi‑auth)**

- **Cognito JWT** for user operations; **IAM** for server‑to‑server;
  **OIDC** for internal tooling.
- Use **\@auth** rules + VTL/JS resolvers to enforce **row‑level**
  constraints (e.g., user can access only their threads, creator their
  own Fan‑Sub pages, admin by role claims).
- **Fine‑grained**: deny by default; allow by ownership (*ownerId ==
  \$ctx.identity.sub*), role claim (*has(\"admin\")*), or entitlement
  check (Dynamo cache read).

**Inline artifact --- AppSync auth modes**\
**Path:** *security/appsync/multi-auth.md*

*- Default Authorization: AMAZON_COGNITO_USER_POOLS*\
*- Additional:*\
* - AWS_IAM (trusted Lambdas + batch jobs)*\
* - OPENID_CONNECT (Admin console only)*\
*- API Key: \*\*disabled\*\* in prod*\

## **1.18.D Secrets & key management**

- **AWS Secrets Manager**: Stripe keys, Plaid (if adopted), e‑sign
  provider tokens, SMTP creds (if not SES), third‑party API tokens.
- **SSM Parameter Store**: non‑secret config (feature flags, limits).
- **KMS**: dedicated CMKs per data domain (*pii*, *finance*, *legal*)
  with **key policies** bound to minimal roles; automatic rotation
  enabled.

**Inline artifact --- Secrets naming convention**\
**Path:** *security/secrets/naming.md*

*/prod/stripe/secret_key*\
*/prod/stripe/webhook_secret*\
*