<!-- id: TD-0324 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1166400-1170400 -->

. Flip Safe‑Mode **global** (config flag).
5572. Purge CloudFront path for affected assets.
5573. Deindex entities from Typesense; add *policy_hold=true*.
5574. Post‑mortem: check pipeline regression tests; add new unit.

**RB‑U‑03 Partner Webhook Forgery**

5575. Move endpoint to **quarantine mode** (accept, store to DLQ only).
5576. Rotate secrets; re‑enable with tighter clock skew (±3 min).
5577. Re‑process quarantined events with new key.

## **U.9 Dashboards & KPIs**

**Dashboards:** *observability/dashboards/security.json*\
**KPIs:** login fail %, search QPS & block %, message spam rate, NSFW
moderation pass %, chargeback rate, webhook signature failures, WAF
block counts.\
**Targets:** All within thresholds defined in §1.24 and Appendix R;
spikes create tickets automatically.

## **U.10 Artifacts to add to repo**

*security/threat_model.md*\
*security/controls_matrix.csv*\
*safety/rules.yaml*\
*services/safety/evaluator.ts*\
*ops/waf/rules.json*\
*api/functions/rateGuard.js*\
*ops/runbooks/RB-U-01_credential_stuffing.md*\
*ops/runbooks/RB-U-02_nsfw_leak.md*\
*ops/runbooks/RB-U-03_webhook_forgery.md*\
*observability/dashboards/security.json*\

## **U.11 Acceptance (Appendix U = FINAL)**

- Controls matrix (U‑01...U‑12) present and linked to tests & alerts.
- *safety/rules.yaml* deployed; evaluator Lambda applying actions;
  strike ladder in effect.
- WAF rules active; AppSync pre‑resolver guard live on spam‑sensitive
  fields.
- Dashboards/alerts in place; last drill for **RB‑U‑01** and **RB‑U‑02**
  completed within SLA.
- Evidence stores (WORM audit, abuse_events) searchable for 180 days.

# **Appendix N --- Disaster Recovery (DR Matrix & Runbooks) --- deep version**

**Goal.** Recover **quickly** (RTO) with **minimal data loss** (RPO)
under likely failure modes: regional outage, data corruption, accidental
deletes, index loss, and third‑party disruption. This appendix is
**actionable** (step‑by‑step commands, scripts, and checklists) and
cost‑conscious (pilot‑light in secondary region with defined upgrade
path).

## **N.0 Scope & assumptions**

**Stack:** CloudFront + WAF → Next.js (Amplify Gen‑2 Hosting) → AppSync
(GraphQL) → Lambda → Aurora Postgres (Serverless v2) → DynamoDB (rate
limits, abuse flags) → S3 (media; originals private, SFW variants
public) → Typesense (search) → EventBridge → Stripe (payments).

**DR posture (MVP):**

- **Primary region:** *REGION_A* (active).
- **Secondary (pilot‑light) region:** *REGION_B* (preprovisioned IaC, S3
  CRR, DNS failover, DynamoDB Global Tables for small hot data).
- **Upgrade option:** move Aurora to **Multi‑Region** (e.g., Global
  Database/read‑replica) for sub‑minute RPO if/when justified.

## **N.1 RTO/RPO targets & DR matrix**

  ----------------------------------------- -------------------------- ------------------------ --------------------------------------- --------------------------------------------------------------- ------------------------------------------------------------------------------------------------------------ -------------------
  **System**                                **Source of Truth**        **RPO**                  **RTO**                                 **Replication/Backup**                                          **Failover Strategy**                                                                                        **Runbook**
  **Aurora Postgres**                       Orders, users, profiles    ≤ **5--15 min** (PITR)   ≤ **60--90 min**                        Automated PITR (7--30d), daily x‑region snapshot copy           **Restore to latest restorable time** in *REGION_A* (or *REGION_B* if regional outage), then attach writer   RB‑N‑02 / RB‑N‑01
  **DynamoDB** (rate limits, abuse flags)   Small/ephemeral            **\< 1 min**             **\< 15 min**                           **Global Tables** (A↔B)                                         Active‑active; app env chooses nearest table                                        