<!-- id: TD-0318 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1144800-1148800 -->

5 min**

**Checkout**

- Server processing (excl. 3DS challenge) â‰¤ **600 ms** p95

## **V.2 k6 Scenarios (copy to** ***perf/k6/*****)**

***perf/k6/search.js***

*import http from \'k6/http\';*\
*import { check, sleep } from \'k6\';*\
*import { Trend, Rate } from \'k6/metrics\';*\
\
*export let SearchLat = new Trend(\'search_latency_ms\');*\
*export let SearchOK = new Rate(\'search_ok\');*\
\
*export const options = {*\
*stages: \[*\
*{ duration: \'2m\', target: 50 }, // ramp*\
*{ duration: \'5m\', target: 200 }, // steady*\
*{ duration: \'2m\', target: 0 }, // ramp down*\
*\],*\
*thresholds: {*\
*\'search_latency_ms\': \[\'p(95)\<150\'\],*\
*\'search_ok\': \[\'rate\>0.995\'\],*\
*},*\
*};*\
\
*const BASE = \_\_ENV.BASE_URL \|\|
\'*[*https://rastup.com*](https://rastup.com)*\';*\
*const Q = encodeURIComponent(\'photographer\');*\
*const CITY = encodeURIComponent(\'los-angeles\');*\
\
*export default function () {*\
*const url =
\`\${BASE}/api/search/people?q=\${Q}&city=\${CITY}&limit=24\`;*\
*const res = http.get(url, { headers: { \'Accept\': \'application/json\'
}});*\
*SearchLat.add(res.timings.duration);*\
*const ok = check(res, {*\
*\'status 200\': r =\> r.status === 200,*\
*\'json present\': r =\> r.headers\[\'Content-Type\'\] &&
r.headers\[\'Content-Type\'\].includes(\'application/json\'),*\
*});*\
*SearchOK.add(ok);*\
*sleep(0.3);*\
*}*\

***perf/k6/checkout.js***

*import http from \'k6/http\';*\
*import { check, sleep } from \'k6\';*\
*import { Trend, Rate } from \'k6/metrics\';*\
\
*export let PayLat = new Trend(\'checkout_latency_ms\');*\
*export let PayOK = new Rate(\'checkout_ok\');*\
\
*export const options = {*\
*stages: \[*\
*{ duration: \'1m\', target: 20 },*\
*{ duration: \'4m\', target: 60 },*\
*{ duration: \'1m\', target: 0 },*\
*\],*\
*thresholds: {*\
*\'checkout_latency_ms\': \[\'p(95)\<600\'\],*\
*\'checkout_ok\': \[\'rate\>0.995\'\],*\
*},*\
*};*\
\
*const BASE = \_\_ENV.BASE_URL \|\|
\'*[*https://rastup.com*](https://rastup.com)*\';*\
\
*export default function () {*\
*// 1) Start a "quote" (fake user flow; replace with Stage endpoint)*\
*let res = http.post(\`\${BASE}/api/checkout/start\`, JSON.stringify({*\
*serviceProfileId: \'spf_demo\',*\
*startTs: new Date(Date.now()+86400000).toISOString(),*\
*endTs: new Date(Date.now()+90000000).toISOString(),*\
*extras: \[\]*\
*}), { headers: { \'Content-Type\': \'application/json\' }});*\
*check(res, { \'start 200\': r =\> r.status === 200 });*\
*PayLat.add(res.timings.duration);*\
\
*// 2) Confirm payment (mocked in Stage or test-mode)*\
*const body = { txnId: res.json(\'txnId\'), method: \'card:test\' };*\
*res = http.post(\`\${BASE}/api/checkout/confirm\`,
JSON.stringify(body), { headers: { \'Content-Type\':
\'application/json\' }});*\
*const ok = check(res, { \'confirm 200\': r =\> r.status === 200 });*\
*PayOK.add(ok);*\
*sleep(1);*\
*}*\

***perf/k6/messages.js***

*import http from \'k6/http\';*\
*import { sleep, check } from \'k6\';*\
*import { Trend, Rate } from \'k6/metrics\';*\
\
*export let MsgLat = new Trend(\'messages_latency_ms\');*\
*export let MsgOK = new Rate(\'messages_ok\');*\
\
*export const options = {*\
*vus: 50, duration: \'5m\',*\
*thresholds: { \'messages_latency_ms\': \[\'p(95)\<250\'\],
\'messages_ok\': \[\'rate\>0.995\'\] },*\
*};*\
\
*const BASE = \_\_ENV.BASE_URL \|\|
\'*[*https://rastup.com*](https://rastup.com)*\';*\
\
*export default function () {*\
*// get inbox*\
*let res = http.get(\`\${BASE}/api/messages/inbox\`, { headers: {
\'Accept\': \'application/json\' }});*\
*check(res, { \'inbox 200\': r =\> r.status === 200 });*\
*MsgLat.add(res.timings.duration);*\
*// open thread*\
*if (res.status === 200 && res.json(\'threads\')?.length) {*\
*const id = res.json(\'threads\')\[0\].id;*\
*res = http.get(\`\${BASE}/api/messages/thread/\${id}\`);*\
*const ok = check(res, { \'thread 200\': r =\> r.status === 200 });*\
*MsgOK.add(ok);*\
*}*\
*sleep(0.5);*\
*}*\

**CI workflow (*****.github/workflows/perf.yml*****)**

*name: perf*\
*