<!-- id: TD-0133 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 478800-482800 -->

 full technical detail (objects,
flows, folders, filters, credits, action cards, safety controls). The
non‑technical goals include role‑aware & booking‑aware threads, a single
source of truth for chat + project context, respectful fast
communication (receipts, templates), and strong
safety/anti‑circumvention tooling, including report/block and rate
limits.

NonTechBlueprint

In addition, Trust & Safety requires Safe‑Mode behavior on previews,
reporting flows, escalation, and harassment/doXXing protections that
also apply inside messaging.

NonTechBlueprint_Part3

## **1.23.1 Canon & Invariants**

- **Role‑aware, Booking‑aware:** Every thread is anchored to a **Role
  Context** (service profile) and, when applicable, a **Booking**. This
  mirrors the non‑tech "Roleaware & Bookingaware" principle.

NonTechBlueprint

- **Single source of truth:** Messages + structured **Project Panel**
  context (package, schedule, call sheet, contracts, deliverables,
  extras, payments) co‑exist in the thread.

NonTechBlueprint

- **Structured "Action Cards":** time proposals/reschedules, add‑ons,
  overtime, proofs/finals, approvals, expense receipts, mark‑completed,
  open dispute, share location, safety flag---sent as typed,
  machine‑readable cards.

NonTechBlueprint

- **Message Requests & Credits:** First‑time contacts land in
  **Requests**; users can **Accept/Decline/Block**. New conversation
  **credits** throttle cold outreach; replies and booking‑thread
  messaging remain unlimited. Contact filters (ID‑verified only, budget
  disclosed, date provided) are enforced before a message can be sent.

NonTechBlueprint

- **Safety & Policy:** Prominent **Report/Block**, rate limits, spam
  detection, and PII redaction tools for support are required. Messaging
  must respect Safe‑Mode on previews and use the policy escalation
  flows.

NonTechBlueprint_Part3

- **Privacy:** No sensitive EXIF by default on uploads; redactable
  message copies for legal/dispute workflows.
- **Cost posture:** Serverless realtime (AppSync + DynamoDB + S3 +
  Lambda) with pay‑per‑use; Typesense (shared) for message search
  snippets.

## **1.23.2 Data Model**

We follow the non‑tech "Objects (data model at a glance)"---**Thread**,
**Message**, **Attachment**, and **Project**---while adding
normalized/denormalized details to meet performance and safety
requirements.

NonTechBlueprint

### **1.23.2.1 DynamoDB (primary, realtime path)**

**Table:** ***msg_threads*** **(PK =** ***threadId*****, SK =
constant)**\
Attributes:

- *threadId* (string, *th\_...*) **PK**
- *type* (enum: *INQUIRY\|INVITE\|BOOKING\|DISPUTE\|SYSTEM*) ---
  non‑tech "Type" list.

NonTechBlueprint

- *roleContext* (string enum:
  *Model\|Photographer\|Videographer\|Creator* etc.) --- as per service
  profile role.

NonTechBlueprint

- *participants* (\[userId\])
- *bookingId* (nullable)
- *status* (enum:
  *OPEN\|AWAITING_REPLY\|PENDING_DECISION\|CONFIRMED\|COMPLETED\|DISPUTED\|ARCHIVED*)
  --- mirrors non‑tech.

NonTechBlueprint

- *lastMessageAt* (epoch ms), *unreadCountByUser* (map), *lastSenderId*
- *requestState* (enum: *REQUESTS\|ACCEPTED\|DECLINED*)
- *safetyFlags* ({blockedUserIds:\[\], mutedUserIds:\[\],
  tnsFlags:\[\]})
- *projectSnapshot* (summary subset for right‑pane Project Panel---see
  below)

**Table:** ***msg_messages*** **(PK =** ***threadId*****, SK =**
***ts#\<epoch\>#\<rand\>*** **for ordering)**\
Attributes:

- *threadId* (string) **PK**, *msgKey* (string) **SK**
- *messageId* (*m\_...*), *senderId*, *ts* (epoch ms)
- *kind* (enum: *TEXT\|ATTACHMENT\|ACTION\|SYSTEM\|STATE*)
- *content* (JSON; text markdown subset for *TEXT*)
- *attachments* (\[{*key*,*mime*,*bytes*,*hash*,*thumbKey*}\]) ---
  presigned S3 keys
- *action* (nullable Action Card payload; see §1.23.6)
- *stateChange* ({*type*: *READ\|DELIVERED\|TYPING_ON\|TYPING_OFF*,
  *targets*:\[userId\]})
- *safeModeBand* (int *0\|1\|2* for preview gating)
- *spamScore* (float), *policyTags* (\[*HARASSMENT\|DOXXING\|NSFW*..