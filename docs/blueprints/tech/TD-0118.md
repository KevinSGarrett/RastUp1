<!-- id: TD-0118 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 424800-428800 -->

o.amenities\": \"Amenities\",*\
*\"checkout.pay\": \"Pay {amount, number, ::currency/USD}\",*\
*\"a11y.skip\": \"Skip to main content\"*\
*}*\

**Loader (pseudocode)**\
**Path:** *i18n/loader.ts*

*export async function loadLocale(lang: string) {*\
*const res = await fetch(\`https://cdn.rastup.com/i18n/\${lang}.json\`,
{ cache: \'force-cache\' });*\
*return res.json();*\
*}*\

## **1.19.C Hreflang & negotiation**

**Recommended path:** *web/lib/hreflang.ts* (complements §1.17)

*export const locales =
\[\"en-US\",\"es-ES\",\"fr-FR\",\"ar\",\"de-DE\"\];*\
*export function linksFor(canonical: string, map:
Record\<string,string\>) {*\
*return Object.entries(map).map((\[lang, href\]) =\> \`\<link
rel=\"alternate\" hreflang=\"\${lang}\"
href=\"\${href}\"\>\`).join(\"\\n\")*\
* + \`\\n\<link rel=\"alternate\" hreflang=\"x-default\"
href=\"\${canonical}\"\>\`;*\
*}*\

# **§1.19 --- Internationalization (I18n), Localization (L10n) & Accessibility (A11y) --- Full Spec**

**Goal:** Ship a multilingual, accessible marketplace that preserves
SEO, Safe‑Mode rules, and performance budgets. Everything below is
**text‑only** for your Word doc and includes **Recommended
filename/path** tags for later lift into the repo. We keep costs low (no
heavy SaaS): JSON catalogs in S3, *Intl.\** APIs server/client, and
automated extraction/QA.

## **1.19.1 Canon & invariants**

2005. **Locale‑agnostic canonicals.** Canonical URLs **don't** contain
      locale; we add *hreflang* alternates (ties to §1.17).
2006. **Server‑rendered locale content** for public/SEO pages; client
      hydration matches server strings.
2007. **ICU MessageFormat** everywhere (plural, select, number/currency,
      dates).
2008. **RTL** supported from day one (Arabic/Hebrew): directional CSS,
      logical properties, bidi‑safe UI.
2009. **WCAG 2.2 AA**: keyboard, contrast, focus, forms, motion.
2010. **Cost**: catalogs in S3 (versioned), CDN‑cached; no per‑string
      paid APIs.
2011. **Safe‑Mode** rules: no 18+ previews in public pages/emails;
      localized strings **must not** bypass gating.

## **1.19.2 Data model & user preferences**

**SQL migration**\
**Recommended path:** *db/migrations/019_i18n_user_prefs.sql*

*alter table \"user\"*\
*add column locale text not null default \'en-US\',*\
*add column timezone text not null default \'UTC\',*\
*add column prefers_24h boolean not null default false,*\
*add column reduced_motion boolean not null default false,*\
*add column high_contrast boolean not null default false;*\
\
*create index on \"user\"(locale);*\
*create index on \"user\"(timezone);*\

**GraphQL SDL**\
**Recommended path:** *api/schema/i18n.graphql*

*type UserPrefs {*\
*locale: String!*\
*timezone: String!*\
*prefers24h: Boolean!*\
*reducedMotion: Boolean!*\
*highContrast: Boolean!*\
*}*\
*extend type Query { mePrefs: UserPrefs! }*\
*extend type Mutation {*\
*updatePrefs(locale: String, timezone: String, prefers24h: Boolean,
reducedMotion: Boolean, highContrast: Boolean): UserPrefs!*\
*}*\

**Policy:** never infer locale silently after the user explicitly
chooses one; store choice; still set *lang*/*dir* attributes
server‑side.

## **1.19.3 Locale catalogs & loading**

**Catalog structure (ICU MessageFormat)**\
**Recommended path:** *i18n/catalogs/en-US.json*

*{*\
*\"nav.home\": \"Home\",*\
*\"nav.city\": \"{city} creatives\",*\
*\"cta.book\": \"Book now\",*\
*\"price.perHour\": \"{amount, number, ::currency/USD} per hour\",*\
*\"availability.slots\": \"{count, plural, one {# slot} other {# slots}}
available\",*\
*\"a11y.skip\": \"Skip to main content\",*\
*\"safeMode.disclaimer\": \"Public previews are SFW. Some content
requires Safe-Mode OFF and age verification.\"*\
*}*\

**Other locales** (create *es-ES.json*, *fr-FR.json*, *ar.json*, etc.)
with identical keys; avoid string concatenation---always parametrize.

**Loader (server & client)**\
**Recommended path:** *i18n/loader.ts*

*export async function loadLocaleCatalog(lang: string) {*\
*const url = \`