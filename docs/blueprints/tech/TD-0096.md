<!-- id: TD-0096 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 345600-349600 -->

lur,2 block*\
*city text,*\
*verified_chip boolean not null default false,*\
*is_published boolean not null default false,*\
*created_at timestamptz not null default now(),*\
*updated_at timestamptz not null default now()*\
*);*\
*create index if not exists idx_feed_post_pub on feed_post(is_published,
created_at desc);*\
*create index if not exists idx_feed_post_city on feed_post(city);*\
\
*create table if not exists referral_program (*\
*program_id text primary key, \-- rpr\_\...*\
*kind text not null check (kind in
(\'provider_invites_provider\',\'buyer_invites_buyer\',\'cross_side\')),*\
*reward_bips int not null default 0,*\
*reward_fixed_cents int not null default 0,*\
*credit_scope text not null, \-- e.g., \'buyer_fee_only\'*\
*monthly_cap int not null default 5,*\
*active boolean not null default true,*\
*created_at timestamptz not null default now()*\
*);*\
\
*create table if not exists referral_invite (*\
*invite_id text primary key, \-- rfi\_\...*\
*program_id text not null references referral_program(program_id),*\
*inviter_user_id text not null,*\
*invitee_user_id text,*\
*invitee_email_sha text not null,*\
*source text, \-- \'sharecard\',\'linkinbio\', etc.*\
*device_fp text,*\
*ip_addr_sha text,*\
*created_at timestamptz not null default now(),*\
*accepted_at timestamptz*\
*);*\
*create index if not exists idx_rfi_inviter on
referral_invite(inviter_user_id, created_at desc);*\
*create index if not exists idx_rfi_email on
referral_invite(invitee_email_sha);*\
\
*create table if not exists credit_ledger (*\
*entry_id text primary key, \-- crl\_\...*\
*user_id text not null,*\
*kind text not null check (kind in
(\'award\',\'clawback\',\'redeem\')),*\
*program_id text,*\
*amount_cents int not null,*\
*currency text not null default \'USD\',*\
*reason text not null,*\
*related_id text,*\
*created_at timestamptz not null default now()*\
*);*\
*create index if not exists idx_credit_user on credit_ledger(user_id,
created_at desc);*\
\
*commit;*\

## **1.16‑B. DynamoDB --- hot‑path/TTL tables**

**Recommended filename/path:** *infra/dynamodb/016_growth_ttl_tables.md*
*(doc note for infra CDK)*

*Table: saved_search_dedupe*\
*Key: PK = search_id, SK = alert_date (YYYY-MM-DD)*\
*Attributes: ttl_epoch (Number)*\
*Purpose: ensure ≤1 alert/day/search; items auto-expire via TTL.*\
\
*Table: feed_fanout_cursor*\
*Key: PK = user_id, SK = \'cursor\'*\
*Attributes: last_seen_created_at (ISO), last_seen_id*\
*Purpose: incremental paging for unified feed.*\
\
*Table: referral_device_daily*\
*Key: PK = device_fp#YYYY-MM-DD, SK = program_id*\
*Attributes: ip_hash, count*\
*TTL: next day*\
*Purpose: rate-limit & fraud signal for invites/accepts.*\

## **1.16‑C. GraphQL SDL --- Saved Search, Feed, Referrals**

**Recommended filename/path:** *api/schema/growth.graphql*

*\# growth.graphql*\
\
*scalar AWSJSON*\
*scalar AWSDate*\
*scalar AWSDateTime*\
\
*type SavedSearch {*\
*searchId: ID!*\
*scope: String!*\
*city: String!*\
*queryJson: AWSJSON!*\
*pausedUntil: AWSDate*\
*lastAlertDt: AWSDate*\
*createdAt: AWSDateTime!*\
*updatedAt: AWSDateTime!*\
*}*\
\
*type SavedSearchAlert {*\
*alertId: ID!*\
*searchId: ID!*\
*alertDt: AWSDate!*\
*matchCount: Int!*\
*emailSent: Boolean!*\
*inappCreated: Boolean!*\
*createdAt: AWSDateTime!*\
*}*\
\
*type FeedCard {*\
*feedId: ID!*\
*authorId: ID!*\
*roleTags: \[String!\]!*\
*kind: String!*\
*title: String!*\
*bodyMd: String*\
*mediaPreview: AWSJSON!*\
*city: String*\
*verifiedChip: Boolean!*\
*createdAt: AWSDateTime!*\
*}*\
\
*type FeedPage { items: \[FeedCard!\]!, cursor: String }*\
\
*type ReferralInvite { inviteId: ID!, programId: ID!, inviterUserId:
ID!, acceptedAt: AWSDateTime }*\
*type CreditLedger { entryId: ID!, userId: ID!, kind: String!,
amountCents: Int!, reason: String!, createdAt: AWSDateTime! }*\
\
*input SavedSearchInput { scope: String!, city: String!, queryJson:
AWSJSON! }*\
\
*type Query {*\
*mySavedSearches: \[SavedSearch!\]!*\
*myFeed(cursor: String, limit: Int = 25, tab: String): F