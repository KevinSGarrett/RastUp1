<!-- id: TD-0069 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 248400-252400 -->

YTES anomalies (cost), QuickSight refresh
failures.

## **1.13.N Test plan (CI + stage)**

**Contracts & ingestion**

1347. Validate JSON Schemas for all events; generate fixtures; reject
      malformed example.
1348. Simulate Firehose → S3 path; partitions and Glue catalog creation
      verified.

**Transforms**\
3) Build Silver facts with sample events; ensure referential integrity;
Great Expectations pass.\
4) Build Gold marts; compare against golden KPIs.

**Ops freshness**\
5) NRT materialized views update within 10 min under synthetic load.

**Experimentation**\
6) Bucketing sticky across login; exposure logged once; per‑variant
metrics computed.

**Privacy & DSAR**\
7) DSAR tombstone leads to exclusion in Silver/Gold; Bronze read‑time
exclusion works; legal hold override blocks purge.

**BI**\
8) SPICE extracts refresh; dashboards render within targets.

**Cost**\
9) Athena queries using partition filters; scanned bytes within budget;
lifecycle transitions occur.

## **1.13.O Work packages (Cursor agents)**

- **Agent C --- Ingestion & Modeling**\
  WP‑DATA‑ING‑01: Event schemas & validation; EventBridge + Firehose S3
  pipeline.\
  WP‑DATA‑ING‑02: Bronze→Silver ETL (Glue/Athena CTAS) + dbt project
  skeleton.
- **Agent B --- Quality & Privacy**\
  WP‑DATA‑QTY‑01: Great Expectations suite; alerts; DSAR tombstone flow;
  Lake Formation grants.
- **Agent A --- BI & Experiments**\
  WP‑DATA‑BI‑01: QuickSight datasets & dashboards; SPICE schedules; data
  dictionary.\
  WP‑EXP‑01: Assignment & exposure logging; guardrail metric jobs;
  analysis notebooks.
- **Agent D --- Ops & Admin**\
  WP‑DATA‑OPS‑01: NRT materialized views (ops); backfill runner; schema
  registry UI.\
  WP‑COST‑01: Athena scanned‑bytes monitor; lifecycle & partition
  housekeeping jobs.

## **1.13.P Acceptance criteria (mark §1.13 FINAL only when ALL true)**

1353. Event pipeline ingests and lands Bronze with SLO **≤ 60 s p95**;
      schemas validated.
1354. Silver facts and dimensions materialize with tests passing; Gold
      marts compute KPIs correctly.
1355. NRT ops views feed Admin consoles within **≤ 10 min p95**.
1356. Experimentation framework logs exposures, runs metrics with
      guardrails, and supports CUPED/sequential analysis.
1357. Privacy: no PII in events; DSAR works; Lake Formation permissions
      enforced; legal holds respected.
1358. BI dashboards live for Executive/City
      Ops/Trust/Finance/Growth/Comms; SPICE refresh success ≥ 99%.
1359. Cost: Athena scanned bytes within target; lifecycle rules active;
      no unnecessary compute.
1360. Telemetry & alerts cover pipeline lag, data quality, cost
      anomalies, and BI refresh health.

# **§1.13 --- Data Platform, Analytics & Experimentation (Expanded)**

Below I expand each subsection with **executable‑grade detail**:
concrete event schemas, ingestion & storage configs, Athena/CTAS/dbt
models, data‑quality suites, DSAR/retention, Lake Formation permissions,
NRT ops views, experimentation machinery, BI datasets, and cost/alerting
runbooks. You can drop these artifacts into the repo (under */data/* and
*/amplify/backend/observability/*) and wire them with your Amplify Gen 2
stacks.

## **1.13.C (expanded) --- Event Envelope & Contracts**

### **C.1 Canonical envelope (JSON Schema v1)**

*{*\
*\"\$id\":
\"*[*https://rastup.com/schemas/event-envelope.v1.json*](https://rastup.com/schemas/event-envelope.v1.json)*\",*\
*\"\$schema\":
\"*[*https://json-schema.org/draft/2020-12/schema*](https://json-schema.org/draft/2020-12/schema)*\",*\
*\"type\": \"object\",*\
*\"required\": \[\"event\", \"v\", \"occurred_at\", \"received_at\",
\"context\", \"ids\", \"payload\"\],*\
*\"properties\": {*\
*\"event\": { \"type\": \"string\", \"pattern\": \"\^\[a-z0-9\_.\]+\$\"
},*\
*\"v\": { \"type\": \"integer\", \"enum\": \[1\] },*\
*\"occurred_at\": { \"type\": \"string\", \"format\": \"date-time\" },*\
*\"received_at\": { \"type\": \"string\", \"format\": \"date-time\" },*\
*\"user_id\": { \"ty