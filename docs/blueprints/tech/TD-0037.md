<!-- id: TD-0037 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 133200-137200 -->

, or policy not met.
- *PROMO_CPC_BELOW_FLOOR* --- CPC under city/role floor.
- *PROMO_BUDGET_EXHAUSTED* --- daily/total budget hit.
- *PROMO_INVALID_CITY* --- city not allowlisted.
- *PROMO_PAYMENT_FAILED* --- top‑up failed.
- *PROMO_SUSPENDED* --- admin or auto policy suspension.
- *PROMO_CLICK_INVALIDATED* --- click rejected; user is never shown
  this, used in logs/analytics.

## **1.7.N Performance & cost**

- **Server path**: ad selection is a lightweight filter + sample on a
  cached active list per *(surface, city, role)*; no heavy joins.
- **Cache**: refresh active campaigns every 30--60s; query‑result
  cursors keep rotation stable.
- **Storage**: events compacted hourly; cold storage lifecycle after 90
  days.
- **Compute**: fraud scoring runs in near‑real‑time with modest
  concurrency; batch re‑processing off‑peak.

## **1.7.O Test plan (CI + sandbox)**

**Correctness**

715. Eligible campaign appears only when it **matches filters** and
     city; ineligible campaigns never show.
716. Density caps respected with mixed inventory; no back‑to‑back
     promoted cards unless flag forces.
717. Featured slot reserved; if empty, organic card fills.

**Budget & pacing**\
4) Daily budget drains gradually in **even** mode under stable traffic;
accelerated spends faster.\
5) Budget exhausted → campaign paused; resumes next day or after top‑up.

**Fraud & billing**\
6) Duplicate clicks within window deduped; bot UA/ip patterns flagged;
only valid clicks billed.\
7) Post‑hoc invalidation issues **make‑good credits**.\
8) Ledger totals == Σ(valid_clicks × CPC); recon green vs Stripe
top‑ups.

**Admin**\
9) Floor & cap updates take effect with versioning; rollback works;
two‑person approval enforced.\
10) Campaign suspension/restore applies immediately; audit logged.

**Performance**\
11) p95 selection ≤ 30 ms after cache warm; ≤ 120 ms cold; overall
search p95 still meets §1.2 SLOs.

**UX**\
12) "Promoted" chip visible; disclosure link opens policy page;
analytics counts impressions/clicks.

## **1.7.P Work packages (Cursor agents)**

- **Agent C --- Serving & Fraud**\
  WP‑PROMO‑SERVE‑01: Active‑campaign cache, matcher, blender; density
  caps.\
  WP‑PROMO‑FRAUD‑01: Click endpoint, dedupe, heuristics, make‑good
  credits, WAF integration.
- **Agent B --- Ledger & Billing**\
  WP‑PROMO‑LEDGER‑01: Budget ledger (+recon jobs), top‑ups via Stripe,
  statements.\
  WP‑PROMO‑RECON‑01: Daily recon and variance gating.
- **Agent A --- Web**\
  WP‑PROMO‑WEB‑01: Promoted card chips, disclosures; seller Campaign
  Manager pages (create, budgets, stats).
- **Agent D --- Admin & QA**\
  WP‑PROMO‑ADMIN‑01: Policy board, fraud dashboard, campaign review,
  audits.\
  WP‑PROMO‑QA‑01: Full test matrix automation; synthetic traffic
  generator.

## **1.7.Q Acceptance criteria (mark §1.7 FINAL only when ALL true)**

722. Promoted units **never** bypass filters or city gates and are
     transparently labeled.
723. Density caps and diversity rules hold; blending preserves organic
     integrity and fairness.
724. Eligibility gates (IDV/completeness/safety) enforced; auto‑pause on
     breaches.
725. Budgets, pacing, pauses/resumes work; spend never exceeds budget
     caps.
726. Click validation rejects duplicates/bad traffic; make‑good credits
     issued; fraud dashboard active.
727. Billing (prepaid) works with Stripe; ledger equals Σ(valid_clicks ×
     CPC); recon green.
728. Admin policy edits versioned with dual approval; suspensions &
     credits audited.
729. p95 selection latency within target; infra/costs within budget
     alarms for 48h synthetic load.

# **§1.8 --- Reviews & Reputation**

*(per-entity scopes · write rules · fraud controls · weighting & decay ·
surfacing · moderation & appeals · admin · telemetry · tests · cost)*

**Purpose.** Implement a trustworthy reputation system that reflects
real, recent performance, scoped correctly to *people* (Service
Profiles) and *places* (Studios). Prevent abuse (self-reviews, review
r