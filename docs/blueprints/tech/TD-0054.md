<!-- id: TD-0054 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 194400-198400 -->

s preferences, quiet hours, dedupe, and batching.
988. Message audits stored with immutable link to rendered bodies
     (email) or payload snapshots (push/SMS/in‑app).
989. User Preference & Quiet Hours UI/APIs functional; List‑Unsubscribe
     endpoints live and audited.
990. Channel workers respect cost gates (e.g., SMS limited to critical
     flows where configured).
991. Idempotency & retries verified; dedupe prevents burst spam.

# **§1.10 --- Notifications & Comms**

**Part 2/2: deliverability, suppression, in‑app center, experiments &
localization, tracking & privacy, admin, telemetry/SLOs, full test
matrix, acceptance**

This completes the communications layer begun in §1.10 (Part 1). We
won't move to the next major subsection until §1.10 passes the 99.9%
bar.

## **1.10.R Deliverability setup (email)**

**R.1 Domain authentication (SES, production domain e.g.,**
***notify.rastup.com*****)**

- **SPF**: *v=spf1 include:amazonses.com -all*
- **DKIM**: enable **Easy DKIM** in SES; publish 3 CNAMEs; rotate
  annually (calendar reminder + auto‑rotate playbook).
- **DMARC**: start with *v=DMARC1; p=quarantine;*
  [*rua=mailto:dmarc@rastup.com*](mailto:rua=mailto:dmarc@rastup.com)*;*
  [*ruf=mailto:dmarc@rastup.com*](mailto:ruf=mailto:dmarc@rastup.com)*;
  fo=1; pct=50*, graduate to *p=reject* after warmup.
- **BIMI** (optional, post‑DMARC‑reject): publish SVG logo and VMC
  (later, cost‑gated flag).

**R.2 SES configuration**

- Verify domain + sender identities
  ([*no-reply@notify.rastup.com*](mailto:no-reply@notify.rastup.com) for
  system, *billing@notify...* for finance, *support@...* for support).
- **Event destinations** → SNS topics for *Delivery*, *Bounce*,
  *Complaint*, *Open* (optional), *Click* (optional).
- Shared IPs at MVP; consider **dedicated IPs** after steady volume
  (requires warmup).

**R.3 IP warmup (if dedicated IPs)**

- Ramp plan for first 2--4 weeks: daily volume ladder + mix of
  high‑engagement templates (booking receipts) to build reputation.
- Dashboards: deliverability by mailbox provider (Gmail, Outlook,
  Yahoo), bounce/complaint thresholds.

**R.4 From/Reply‑To policy**

- Transactional: *From: RastUp \<no-reply@notify...\>* with **Reply‑To
  support** when useful.
- Avoid sending marketing from transactional subdomain.

## **1.10.S Bounce/complaint handling & suppression**

**S.1 Webhooks → suppression list**

- **Hard bounce** or **complaint** → write *comms_suppression*
  (*channel=\'email\'*, *reason=\'hard_bounce\'\|\'complaint\'*,
  *address_hash=SHA256(email)*), set
  *comms_message.status=\'bounced\'\|\'complained\'*.
- **Soft bounces** (4xx) → retry with backoff; if ≥3 within 72h →
  convert to suppression (*reason=\'manual\'*) pending user correction.

**S.2 Unsubscribe & re‑permissioning**

- **List‑Unsubscribe**: one‑click HTTPS endpoint sets
  *comms_pref.email.promotions=false* (and any non‑critical marketing
  categories).
- Re‑permission only via explicit user action in settings; no automatic
  re‑enable after a bounce/complaint.

**S.3 Global blocklist**

- Maintain **platform blocklist** (legal/compliance). Any send to these
  addresses is dropped with *status=\'suppressed\'* and audited.

## **1.10.T In‑app Notification Center (details)**

**T.1 Data & pagination**

- *inapp_notification* (already defined) stores immutable items; add
  indices for *(user_id, created_at desc)*.
- Pagination: cursor by *(created_at, id)* to ensure stable ordering.

**T.2 UX contract**

- **Bell** icon shows unread count; badge hides during DND/quiet hours
  logic (but count still increments).
- **Grouping**: coalesce similar events (e.g., "3 new thread updates").
- **Actions**: "Mark all read", per‑item "Mark read", per‑group clear.
- **Pinning**: high‑priority items (security, legal) appear pinned until
  dismissed.

**T.3 Retention**

- Default retention 90 days; archive older items (user can fetch via
  "Load older" until 1 year, then cold storage).
- Privacy: no sensitive PII in in‑