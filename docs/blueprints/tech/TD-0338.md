<!-- id: TD-0338 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1216800-1220800 -->

ons.json***

*{*\
*\"rest\": { \"stable\": \"v1\", \"supported\": \[\"v1\",\"v2-beta\"\],
\"sunsets\": { \"v1\": \"2026-03-31\" } },*\
*\"graphql\": { \"schemaHash\": \"a9f3...\", \"deprecated\":
\[{\"field\":\"Booking.price\",\"sunset\":\"2026-03-31\"}\] },*\
*\"webhooks\": { \"versions\": \[1,2\], \"default\": 1 }*\
*}*\

## **Q.7 Contract tests & CI gates**

**GraphQL**

- Use **GraphQL Inspector** (or similar) to **fail PRs on breaking
  changes**.
- Persisted operations checked against new schema.
- CI step (pseudocode):

*graphql-inspector diff schema-old.graphql schema-new.graphql
\--fail-on=breaking*\

**REST**

- **OpenAPI** contract + **Schemathesis** (or Dredd) to validate
  implementation and **backward compatibility** of responses.

*schemathesis run openapi/v1.yaml \--checks all \--stateful=links
\--workers 4*\

**Webhooks**

- JSON Schemas in *openapi/webhooks/v1/\*.schema.json*; CI validates
  example payloads and handler code against schema.

**Release gate**

- Block release if any **Critical/High** breaking change detected
  without *major: true* label and approved migration doc.

## **Q.8 API Gateway & caching notes (REST)**

- **Stages**: *v1*, *v2* map to distinct **deployments**; IAM roles
  scoped per stage.

- **CDN**: CloudFront caches by **path**; set:

  - *Cache-Control: public, max-age=60, stale-while-revalidate=60* for
    safe GETs.
  - *Vary: Accept-Encoding* (path carries version).

- **Rate limit headers** (Appendix R):

  - *X-RateLimit-Limit*, *X-RateLimit-Remaining*, *X-RateLimit-Reset*.

**Gateway mapping (example)**

*{*\
*\"openapi\": \"3.1.0\",*\
*\"servers\": \[{ \"url\":
\"*[*https://api.rastup.com/v1*](https://api.rastup.com/v1)*\" }\],*\
*\"paths\": {*\
*\"/people\": { \"get\": { \"operationId\": \"listPeople\", \... } },*\
*\"/orders\": { \"post\": { \"operationId\": \"createOrder\", \... } }*\
*}*\
*}*\

## **Q.9 SDKs & tolerant clients**

- **Official SDKs** pin to a **major** and warn on
  **Deprecation/Sunset** headers.
- **Tolerant reader**: ignore unknown fields; treat unknown enum as
  *UNKNOWN*.
- **Retries/idempotency** aligned with Appendix J; *Idempotency-Key*
  header for POSTs.

## **Q.10 Examples (copy‑paste)**

**REST v1**

*GET /v1/people?city=los-angeles&role=photographer*\
*Accept: application/json*\

**REST v2 (beta)**

*GET /v2/people?city=los-angeles&role=photographer&cursor=abc*\
*Accept: application/json*\

**Webhook test delivery (set version)**

*PATCH /v1/webhooks/{id}*\
*Content-Type: application/json*\
\
*{ \"version\": 2, \"contentType\": \"application/json\" }*\

**GraphQL deprecation surfaced to clients (introspection snippet)**

*{*\
*\"name\": \"price\",*\
*\"isDeprecated\": true,*\
*\"deprecationReason\": \"Use priceCents. Sunset: 2026-03-31.*
[*https://docs.rastup.com/changelog#priceCents*](https://docs.rastup.com/changelog#priceCents)*\"*\
*}*\

## **Q.11 Artifacts to add to repo**

*docs/CHANGELOG.md*\
*docs/versions.json*\
*docs/migrations/UPGRADE_to_v2.md*\
*openapi/v1.yaml*\
*openapi/v2.yaml \# when ready*\
*openapi/webhooks/v1/order.confirmed.schema.json*\
*api/schema/\*.graphql \# SDL snapshots per release*\
*tools/contract/graphql-inspector.config.js*\
*tools/contract/schemathesis.config.yaml*\

**CI additions (*****.github/workflows/api-contract.yml*****)**

*name: api-contract*\
*on: \[pull_request\]*\
*jobs:*\
*graphql:*\
*runs-on: ubuntu-latest*\
*steps:*\
* - uses: actions/checkout@v4*\
* - run: npx graphql-inspector diff api/schema/current.graphql
api/schema/next.graphql \--fail-on=breaking*\
*rest:*\
*runs-on: ubuntu-latest*\
*steps:*\
* - uses: actions/checkout@v4*\
* - run: pip install schemathesis*\
* - run: schemathesis run openapi/v1.yaml \--checks all*\

## **Q.12 Communication plan (per change)**

5740. Update **CHANGELOG.md** + **versions.json**.
5741. Create **migration guide** if required.
5742. Email **API contacts**; in‑product banner for integrators.
5743. Add **Deprecation/Sunset** headers for affected endpoints for t