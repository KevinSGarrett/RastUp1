<!-- id: TD-0328 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1180800-1184800 -->

**List events since that point (pseudocode)**:

*\# Using curl or Stripe SDK; pagination by created timestamp*\
*curl -G*
[*https://api.stripe.com/v1/events*](https://api.stripe.com/v1/events)
*\\*\
*-u sk_live\_\...: \\*\
*\--data-urlencode \"created\[gte\]=\<unix_ts\>\" \\*\
*\--data-urlencode \"limit=100\"*\

5626. **Replay** each event into your **idempotent** handler (HTTP POST)
      or **call the processor** directly with retrieved payloads (avoid
      signature check in replay mode; mark *replayed=true*).
5627. **Reconcile** orders/payouts; inspect DLQ.

### **RB‑N‑07 --- Email (SES/secondary) failover**

**When:** SES region incident or block.

5628. **Switch provider credentials** (Secrets in region B).
5629. **Re‑send failed critical notifications** (queue maintains failed
      IDs).
5630. **Warm‑up rate** to avoid reputation spikes.

### **RB‑N‑08 --- CloudFront/DNS invalidation & cutback**

- **Invalidate** critical paths after restores.
- **Rollback** Route53 to primary when stable; keep B warm for 24--48h.

## **N.5 Scripts & templates (repo paths)**

*ops/dr/aurora_pitr_restore.sh*\
*ops/dr/aurora_restore_from_snapshot.sh*\
*ops/dr/s3-restore-list.sh*\
*ops/dr/typesense_reindex.ts*\
*ops/dr/route53-failover-to-B.json*\
*ops/dr/route53-restore-to-A.json*\
*ops/dr/checks/smoke.sh*\
*ops/dr/checks/data_consistency.sql*\

***ops/dr/aurora_pitr_restore.sh*** **(template)**

*#!/usr/bin/env bash*\
*set -euo pipefail*\
*: \"\${PRIMARY:?} \${AURORA_CLUSTER_ID:?} \${RESTORE_TS:?}\"*\
*NEW_CLUSTER_ID=\"dr-core-\$(date +%Y%m%d%H%M)\"*\
*aws rds restore-db-cluster-to-point-in-time \\*\
*\--region \"\$PRIMARY\" \\*\
*\--db-cluster-identifier \"\$NEW_CLUSTER_ID\" \\*\
*\--source-db-cluster-identifier \"\$AURORA_CLUSTER_ID\" \\*\
*\--restore-to-time \"\$RESTORE_TS\" \\*\
*\--use-latest-restorable-time false \\*\
*\--engine aurora-postgresql*\
*aws rds create-db-instance \\*\
*\--region \"\$PRIMARY\" \\*\
*\--db-instance-identifier \"\${NEW_CLUSTER_ID}-writer\" \\*\
*\--db-cluster-identifier \"\$NEW_CLUSTER_ID\" \\*\
*\--db-instance-class db.serverless*\
*echo \"New cluster: \$NEW_CLUSTER_ID\"*\

***ops/dr/checks/data_consistency.sql***

*\-- Row counts & sums for sanity*\
*SELECT \'users\' AS t, COUNT(\*) AS c FROM public.users*\
*UNION ALL SELECT \'orders\', COUNT(\*) FROM public.orders*\
*UNION ALL SELECT \'payments\', COUNT(\*) FROM public.payments*\
*UNION ALL SELECT \'messages\', COUNT(\*) FROM public.messages;*\
\
*\-- Hash of critical business keys*\
*SELECT md5(string_agg(id::text \|\| \':\' \|\| updated_at::text, \',\'
ORDER BY id)) AS orders_hash FROM public.orders;*\

## **N.6 DR drills & evidence**

- **Quarterly drill plan:**\
  **Q1** --- Aurora PITR (RB‑N‑02).\
  **Q2** --- Region failover A→B (RB‑N‑01).\
  **Q3** --- Typesense total loss with reindex (RB‑N‑04).\
  **Q4** --- S3 mass undelete with CDN purge (RB‑N‑03).
- **Evidence stored in** *ops/dr/drill_reports/YYYY‑QX.md*: start→end
  timestamps, RTO achieved, variances, follow‑ups.

## **N.7 Cost posture & upgrade path**

- **MVP (pilot‑light):** Lowest steady cost. RPO tied to PITR window
  (**minutes**), RTO \~ **1--1.5 h**.

- Upgrade (warm standby / active‑active):

  - Promote **Aurora Multi‑Region** (if supported by chosen engine
    config) to reach **RPO \< 1 min, RTO \< 15--30 min**.
  - Keep **Typesense** hot‑hot with async replica (optional).
  - Increase Route53 automated failover (health checks + alarms).

## **N.8 Acceptance criteria (Appendix N = FINAL)**

5637. **DR matrix** reviewed; RTO/RPO targets documented and signed off.
5638. **Backups & replication** verified: Aurora PITR on, S3
      versioning+CRR, Dynamo Global Tables live.
5639. **Runbooks RB‑N‑01...RB‑N‑08** exist in repo and execute cleanly
      (dry‑runs where applicable).
5640. **Reindex** completes within stated window (hot slices \< 15 min,
      full \< 4 h); scripts work against Stage clone.
5641. **Quarterly drills** captured with measured RTO; deviations have
      