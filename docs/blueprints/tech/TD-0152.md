<!-- id: TD-0152 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 547200-551200 -->

O tool
      lock‑ins.

# **§1.28 --- Admin Console, Ops & Support (Back‑Office) --- Full Technical Spec**

*(RBAC & SSO · immutable audit/WORM · user/listing moderation · Trust &
Safety casework (reports, DMCA, disputes) · finance ops & reconciliation
· search curation tools · Smart Docs admin · CMS (help/announcements) ·
feature flags & risk knobs · observability & SLAs · tests · acceptance)*

**Purpose.** Provide safe, efficient operational tooling to run the
marketplace---moderate users/listings, handle reports/DMCA/disputes,
operate refunds/payouts, curate search, manage Smart Docs templates,
publish help/announcements, tune risk/rate‑limits, and observe
SLOs---while enforcing least‑privilege, case‑bound access, and immutable
audit.

## **1.28.1 Canon & invariants**

2510. **Least privilege + JIT access.** Roles narrowly scoped;
      message/media viewing requires **case‑bound** time‑boxed access.
2511. **Immutable audit.** Every admin action is recorded in Aurora
      **and** appended to S3 with **Object Lock (WORM)**.
2512. **Separation of duties.** Finance vs Trust & Safety (T&S) vs
      Support vs Content Ops vs Search Curation vs Docs Admin.
2513. **Privacy by design.** Sensitive artifacts only via short‑TTL,
      single‑use signed URLs; all access audited.
2514. **Cost posture.** One Next.js Admin app behind CloudFront + WAF +
      IP allowlist; serverless APIs (AppSync/Lambda/Data API).

## **1.28.2 Roles & permissions (RBAC)**

**Initial roles**

- *super_admin* (break‑glass, time‑boxed)
- *trust_safety* (reports, DMCA, disputes, suspensions)
- *finance_ops* (refunds, payout hold/release, reconciliation views)
- *support* (account lookup, resend emails, reset MFA, grant limited
  credits)
- *content_ops* (help/announcements/city SEO snippets)
- *search_curator* (pins, synonyms)
- *docs_admin* (template/versioning & envelope monitor)
- *engineering* (feature flags, config, observability read)

**Recommended path:** *admin/rbac/policy.json*

*{*\
*\"trust_safety\":
\[\"case:\*\",\"user:suspend\",\"listing:unpublish\",\"message:read_case_bound\",\"audit:read\"\],*\
*\"finance_ops\":
\[\"payment:refund\",\"payout:hold\|release\",\"order:view\",\"recon:view\",\"audit:read\"\],*\
*\"support\":
\[\"user:view\",\"user:resend_email\",\"mfa:reset\",\"credits:grant_limited\",\"audit:read_own\"\],*\
*\"content_ops\":
\[\"cms:\*\",\"announcement:\*\",\"seo:snippet_edit\"\],*\
*\"search_curator\": \[\"search:pin\",\"search:synonym\"\],*\
*\"docs_admin\": \[\"docs:template_crud\",\"docs:envelope_view\"\],*\
*\"engineering\": \[\"flag:\*\",\"config:\*\",\"observability:\*\"\]*\
*}*\

**SSO & step‑up:** OIDC (Google/Okta) group→role mapping; **WebAuthn**
step‑up for finance/disputes; short admin session TTL; re‑auth for
destructive actions.

## **1.28.3 App shell & perimeter security**

- **Network:** CloudFront → WAF (bot/rate) → Admin API Gateway (JWT from
  SSO) → AppSync/Lambda.
- **IP allowlist** for office/VPN subnets; break‑glass path requires
  ticket id + reason and auto‑revokes after TTL.
- **No SSR** for admin pages (client‑side only) to minimize accidental
  PII caching.

## **1.28.4 Data model (cases, actions, audit)**

**Recommended path:** *db/migrations/028_admin_core.sql*

*begin;*\
\
*create table admin_case (*\
*case_id text primary key, \-- cas\_\...*\
*kind text not null check (kind in
(\'report\',\'dmca\',\'dispute\',\'appeal\',\'fraud\')),*\
*status text not null check (status in
(\'new\',\'triage\',\'investigating\',\'awaiting_user\',\'resolved\',\'closed\')),*\
*priority int not null default 3, \-- 1..5*\
*opened_by text not null, \-- usr\_\... or system*\
*subject_user text,*\
*order_id text,*\
*thread_id text,*\
*listing_id text,*\
*summary text not null,*\
*sla_due_at timestamptz,*\
*created_at timestamptz default now(),*\
*updated_at timestamptz default now()*\
*);*\
\
*create table admin_action (*\
*action_id text primary key, \-- act\_\...*\
*case_id text references admin_case(case_id) on delete