<!-- id: TD-0274 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 986400-990400 -->

nt), redact counterpart PII where
      required, never include secrets.

4707. **Two artifacts** per export:

      p.  **Portability bundle**: **JSON + CSV** (UTF‑8), zipped with a
          **manifest** (SHA‑256 checksums).
      q.  **Human pack**: PDF "Your RastUp data" summary + individual
          **PDF receipts/invoices** for orders.

4708. **Strong verification**: re‑auth + MFA (if enabled) + email
      confirmation before generation; **single‑use, short‑TTL** download
      tokens.

4709. **Cost discipline**: export runs as **batched Lambdas**, streams
      directly to S3 (no large temp storage), and auto‑expires in **7
      days**.

4710. **SFW guarantee**: public media in exports are **SFW variants**
      unless the user is the **owner/uploader** of an asset; never
      include NSFW for third‑party content.

4711. **Completeness**: covers **identity, profile/studio, media
      metadata, calendar, orders/payments, messages, reviews,
      disputes/chargebacks, help/DMCA, analytics session metadata**, and
      **consent history**.

## **1.28.2 Export contents (canonical inventory)**

**Identity & account**

- *identity.json*: *user_id*, handles, names (if provided), locale,
  roles, verified flags, created/last_active.
- *consent_history.json*: marketing consent changes with timestamps &
  source.
- *devices.csv*: registered device tokens (token hashes only), push
  prefs, quiet hours.

**Profiles & studios**

- *profile.json*: public fields, private notes the user wrote, uploaded
  media references (IDs, captions).
- *studio.json*: studio metadata, amenities, verification status
  (decision timestamps), public address (exact address included **only**
  if it is *the user's own studio*).

**Calendar & availability**

- *calendar_rules.json*: buffers, minimums, blackouts. (No third‑party
  availability pulled in via ICS beyond free/busy summaries tied to the
  user's account.)

**Orders & payments**

- *orders.csv*: order_id, roles, counterpart masked ID, status,
  timestamps, subtotal/fees/taxes/total, refund summary.
- *payouts.csv*: payout_id, amounts, destination masked (last4 only),
  status.
- *receipts/receipt\_{order_id}.pdf*: generated from Stripe data + our
  ledger (see 1.28.8).

**Messaging & actions**

- *messages/\*.jsonl*: one file per thread the user participated in;
  includes messages **authored by the user** in full and **counterpart
  messages** with **PII‑redaction** (emails/phones removed), plus
  message timestamps and delivery/read markers.

**Reviews & ratings**

- *reviews_authored.csv* and *reviews_received.csv* with rating, text,
  timestamps, and any moderation flags.

**Support, refunds & disputes**

- *support_cases.csv*, *refunds.csv*, *chargebacks.csv* (IDs, types,
  outcomes, timestamps, reason codes); evidence the user uploaded
  appears as S3 URLs with **short‑TTL pre‑signed** links.

**Media**

- *media.csv*: the user's **own uploads** (IDs, titles, captions,
  SFW/NSFW band, sizes, checksums).
- *media/* includes **SFW variants** for public items; **originals**
  only for assets **uploaded by the user** (not for third‑party images
  in chats).

**Search & analytics (privacy‑safe)**

- *search_history.csv*: last 6 months of the user's searches (query
  terms and city/role filters); no full clickstream.
- *sessions.csv*: session start/end timestamps, device class, coarse geo
  (country/city). **No** IP addresses stored.
- Attribution records for orders attributed to the user's own clicks
  (*source, medium, campaign, has_click_proof*)---no partner secrets.

**Policy & DMCA**

- *dmca.csv*: takedown requests initiated by the user; outcomes &
  timestamps.

## **1.28.3 Data model (Aurora) --- paste‑ready DDL**

Create *db/migrations/035_exports.sql*:

*begin;*\
\
*create schema if not exists exports;*\
\
*create type exports.status as enum
(\'REQUESTED\',\'VERIFIED\',\'PROCESSING\',\'READY\',\'EXPIRED\',\'FAILED\',\'CANCELLED\');*\
\
*create table exports.request (*\
*export_i