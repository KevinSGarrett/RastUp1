<!-- id: TD-0128 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 460800-464800 -->

ded boosts, price/amenity fitness,
      distance penalty; diversity guardrails active.
2136. Synonyms/typos configured; city nicknames resolved; zero‑results
      rate below target.
2137. Admin pinning & synonym tools available; analytics dashboards show
      CTR@k, save rate@k, booking conversions, NDCG@10.
2138. Latency & throughput SLOs met; costs within launch budget; WAF &
      policy gates enforced.

# **§1.22 --- Payments, Payouts, Refunds & Financial Reconciliation --- Full Spec**

*(platform fees & pricing model · Stripe Connect architecture · payment
methods & flows · holds/capture/escrow posture · refunds, disputes &
evidence · credits/vouchers & taxes · payouts & compliance (KYC/1099‑K)
· ledgers & reconciliation (Bronze/Silver/Gold) · webhooks & idempotency
· fraud controls & risk flags · admin tooling · telemetry, tests, SLOs,
costs)*

**Purpose.** Define the money stack for bookings across People and
Studios: checkout, fees, credits, payouts, refunds/disputes, and
accounting. All artifacts below are **text‑only** for your master Word
plan, with **Recommended filename/path** markers for later repo
lift‑and‑shift.

## **1.22.1 Canon & invariants**

2139. **Processor:** **Stripe Connect (Express)** for providers/studios.
      Buyers pay through **PaymentIntents**; platform fees via
      application fee or separate charges+transfers.
2140. **Bank linking:** default to **Stripe Financial Connections** for
      ACH; consider **Plaid** only if we need features FinConn/Link
      don't cover (e.g., specific institutions, account switch UX
      constraints).
2141. **Escrow posture:** no true escrow at launch. We either **capture
      immediately** and **transfer post‑completion** or **authorize then
      capture** for short holds.
2142. **Idempotency everywhere:** client and server actions that move
      money must be idempotent.
2143. **Compliance:** Stripe handles KYC for connected accounts and
      1099‑K. We never store PAN; only tokens/ids.
2144. **Credits scope:** referral/promo credits reduce **platform fees
      only** unless a promo explicitly subsidizes subtotal.
2145. **Cost posture:** launch with **cards + Apple/Google Pay**; add
      ACH when volume justifies ops overhead and delayed funding.

## **1.22.2 Pricing & fee model (baseline)**

- **Buyer pays:** *subtotal* (package + add‑ons) + *buyer_fee*
  (platform) + taxes (if applicable).
- **Provider receives:** *subtotal* minus Stripe processing (from
  provider's share) minus optional **provider take** if we ever use it.
- **Platform receives:** *buyer_fee* (+ optional provider take).
- **Refund/chargeback policy** controls who eats which fees.

**Artifact --- fee policy matrix**\
**Recommended path:** *payments/policy/fee-matrix.md*

*- Buyer cancels before provider accepts: Full refund; all fees
returned.*\
*- Buyer cancels \>48h after accept: Refund subtotal minus cancellation
fee to provider; platform fee refunded.*\
*- No-show: Provider receives minimum guarantee; platform may refund
buyer fee at discretion.*\
*- Dispute lost: Full refund; provider payout clawback; platform fee
refunded unless provider fraud is proven.*\

## **1.22.3 Data model (Aurora) --- orders, intents, transfers, refunds**

**Recommended path:** *db/migrations/022_payments_core.sql*

*begin;*\
\
*create table \"order\" (*\
*order_id text primary key, \-- ord\_\...*\
*buyer_user_id text not null,*\
*provider_user_id text not null, \-- seller*\
*service_profile_id text not null, \-- sp\_\...*\
*studio_id text, \-- optional, st\_\...*\
*currency text not null default \'USD\',*\
*subtotal_cents int not null,*\
*buyer_fee_cents int not null, \-- platform fee charged to buyer*\
*tax_cents int not null default 0,*\
*credit_applied_cents int not null default 0, \-- credits applied to
buyer_fee*\
*status text not null check (status in
(\'draft\',\'authorized\',\'captured\',\'completed\',\'refunded\',\'voided\',\'disputed\')),*\
*booking_dt timestamptz,*\
*created_at timestam