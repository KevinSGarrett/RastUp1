<!-- id: TD-0255 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 918000-922000 -->

text,*\
*payload jsonb not null, \-- exact intent (e.g., refund cents)*\
*status admin.action_status not null default \'PENDING\',*\
*approver_user_id text, \-- dual-control approver (if needed)*\
*approved_at timestamptz,*\
*executed_at timestamptz*\
*);*\
\
*create index on admin.action_request (status, created_at);*\
\
*\-- Feature flags & city configs*\
*create schema if not exists config;*\
\
*create table config.feature_flag (*\
*flag_key text primary key,*\
*description text,*\
*enabled_global boolean not null default false,*\
*targeting_json jsonb not null default \'{}\' \-- e.g., allowlist users
or cities*\
*);*\
\
*create table config.city (*\
*city text primary key, \-- \'los-angeles\'*\
*spotlight_enabled boolean not null default true,*\
*holdout_pct int not null default 5, \-- experimentation holdout for
paid (see §1.20)*\
*nsfw_public_band int not null default 1 \-- Safe-Mode ceiling for
public*\
*);*\
\
*commit;*\

## **1.22.4 GraphQL (AppSync) --- paste‑ready schema**

Create *api/schema/admin.graphql*:

*scalar AWSJSON*\
*scalar AWSDateTime*\
\
*enum AdminAction { ACCOUNT_SUSPEND ACCOUNT_UNSUSPEND PROFILE_HIDE
PROFILE_UNHIDE*\
*STUDIO_VERIFY_APPROVE STUDIO_VERIFY_REJECT ORDER_REFUND_PARTIAL
ORDER_REFUND_FULL*\
*ORDER_CANCEL_PROVIDER ORDER_CANCEL_BUYER DMCA_TAKEDOWN DMCA_RESTORE*\
*PROMO_CITY_CONFIG_EDIT FEATURE_FLAG_EDIT CITY_SPOTLIGHT_TOGGLE*\
*SEC_BREAK_GLASS_START SEC_BREAK_GLASS_END }*\
\
*type AdminActionRequest {*\
*id: ID!, kind: AdminAction!, targetKind: String!, targetId: String!,*\
*reasonCode: String!, notesMd: String, payload: AWSJSON!,*\
*status: String!, createdAt: AWSDateTime!, approverUserId: String,
approvedAt: AWSDateTime, executedAt: AWSDateTime*\
*}*\
\
*type AuditLog {*\
*id: ID!, at: AWSDateTime!, actorUserId: String!, actorRole: String!,
kind: AdminAction!,*\
*targetKind: String!, targetId: String!, requestJson: AWSJSON!,
responseJson: AWSJSON*\
*}*\
\
*type FeatureFlag { key: ID!, description: String, enabledGlobal:
Boolean!, targetingJson: AWSJSON! }*\
*type CityConfig { city: ID!, spotlightEnabled: Boolean!, holdoutPct:
Int!, nsfwPublicBand: Int! }*\
\
*type Query {*\
*adminSearchUsers(q: String!): \[AWSJSON!\]! \@auth(role:
\"admin\|support\|trust_safety\")*\
*adminSearchOrders(q: String!): \[AWSJSON!\]! \@auth(role:
\"admin\|support\|finance\")*\
*getActionRequests(status: String, kind: AdminAction):
\[AdminActionRequest!\]! \@auth(role:
\"admin\|support\|trust_safety\|finance\")*\
*getAuditLogs(targetKind: String, targetId: String, cursor: String):
\[AuditLog!\]! \@auth(role: \"admin\|auditor\")*\
*getFeatureFlags: \[FeatureFlag!\]! \@auth(role: \"admin\")*\
*getCityConfigs: \[CityConfig!\]! \@auth(role: \"admin\|city_ops\")*\
*}*\
\
*input AdminActionInput {*\
*kind: AdminAction!, targetKind: String!, targetId: String!,*\
*reasonCode: String!, notesMd: String, payload: AWSJSON!*\
*}*\
\
*type Mutation {*\
*createAction(input: AdminActionInput!): ID! \@auth(role:
\"admin\|support\|trust_safety\|finance\")*\
*approveAction(requestId: ID!): Boolean! \@auth(role: \"admin\")*\
*executeAction(requestId: ID!): Boolean! \@auth(role:
\"admin\|support\|trust_safety\|finance\")*\
*setFeatureFlag(key: ID!, enabledGlobal: Boolean!, targetingJson:
AWSJSON): Boolean! \@auth(role: \"admin\")*\
*setCityConfig(city: ID!, spotlightEnabled: Boolean, holdoutPct: Int,
nsfwPublicBand: Int): Boolean! \@auth(role: \"admin\|city_ops\")*\
*}*\

**Notes:**

- **Dual‑control:** Certain actions (suspensions, \>\$X refunds,
  break‑glass) **require approval** before *executeAction*.
- All mutations emit **admin.audit_log** rows with chain hashes.

## **1.22.5 Privileged workflows (macros)**

**1) DMCA Takedown**

- Inputs: case ID, URL(s)/asset IDs, claimant details.
- Macro: hide assets, mark content *blocked_dmca*, notify creator &
  claimant, revalidate ISR pages within 10 min (§1.17), add *audit_log*.
- Restore macro reverses with evidence on file.

**2) Suspend / Unsuspend Account**

- Triggers: fraud, saf