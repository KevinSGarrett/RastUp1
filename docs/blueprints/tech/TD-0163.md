<!-- id: TD-0163 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 586800-590800 -->

(policy engine)**

**Policy matrix (configurable in Admin; defaults below):**

- **Flexible**:

  - Buyer cancels ≥72h: full refund minus platform fee.
  - 72--24h: 50% of subtotal (provider) + platform fee not refunded.
  - \<24h: no refund (provider keeps subtotal) unless provider rebooks
    slot.

- **Standard**: 7d/48h/24h thresholds with 100%/50%/0% similar to above.

- **Strict**: 14d/7d/48h thresholds with 75%/50%/0%.

**Reschedule**: buyer can request reschedule ≥48h without fees; provider
must accept; otherwise treat as cancellation.\
**Provider cancel**: automatic buyer refund; provider reputation hit;
optional monetary penalty after repeated cancels (Admin configurable).\
**No‑show**: treat per policy; talent no‑show → refund; buyer no‑show →
no refund.

Studio‑specific overtime/cleaning/deposit rules live in §1.24.

## **1.3.10 Disputes & chargebacks**

- **In‑app disputes**: buyer/provider can open a dispute within the
  review window. System creates *booking.dispute* and routes a **T&S
  case** to Admin (§1.26). Evidence collection (photos, deliverables,
  chat history) with timestamps. Outcomes: *resolved_buyer* (refund),
  *resolved_provider* (payout), or *split* (partial).
- **Stripe chargebacks**: listen to *charge.dispute.\** webhooks;
  auto‑attach internal evidence pack (contracts, deliverables, chat
  logs) and submit via Stripe's API; mark dispute status *chargeback*.
- **Deposit capture** (studios only): governed by §1.24 policy; not part
  of talent bookings.

## **1.3.11 Events, webhooks & idempotency**

**Event taxonomy (emits to Kinesis/SNS):**

- booking.request.sent\|accepted\|declined\|countered\|expired
- booking.confirmed\|calendar.blocked\|chat.opened
- booking.milestone.delivered\|approved
- booking.completed\|payout.scheduled\|payout.released
- booking.cancelled.buyer\|provider
- booking.dispute.opened\|resolved

**Webhooks (Stripe Connect):**

- *payment_intent.succeeded*, *payment_intent.payment_failed*,
  *charge.refunded*, *charge.dispute.created\|closed*,
  *transfer.created\|paid\|reversed*.

**Idempotency**: all webhook handlers accept *event.id* and store in
DynamoDB to prevent duplicate processing.

## **1.3.12 Messaging & calendar integration**

- **Chat thread** opens on confirm; pre‑loads contract summaries; safety
  tools (report/block) available.
- **Calendar blocks** for both parties; ICS export enabled; holds
  auto‑expire if request expires; reschedules update blocks.

## **1.3.13 Security, privacy, and Safe‑Mode**

- Contract PDFs and evidence stored in S3 with **pre‑signed short‑TTL**
  URLs; audit views via Admin.
- Public pages remain **SFW**; checkout surfaces never expose unsafe
  previews.
- PII (exact addresses/door codes) revealed only post‑confirm and
  time‑boxed around event.

## **1.3.14 Cost controls**

- One PSP (Stripe) at launch; **no Plaid** needed because **Stripe
  Financial Connections** covers ACH with lower integration surface and
  fewer vendors (cheaper to operate). If later needed for broader bank
  coverage, we can add Plaid behind a feature flag.
- Off‑peak Lambdas (webhooks, transforms) scale to zero; Aurora min ACUs
  tuned; CloudFront caches static and semi‑static pages.

## **1.3.15 Artifacts (text‑only, paste into your doc)**

- *db/migrations/013_booking_core.sql* --- schema above.
- *api/schema/booking.graphql* --- GraphQL schema above.
- *ops/runbooks/booking-dispute.md* --- step‑by‑step dispute flow and
  evidence checklist (ties to Admin).
- *ops/policies/cancellation-matrix.md* --- default thresholds &
  examples.
- *api/webhooks/stripe-handlers.md* --- event mapping, idempotency,
  retries.
- *product/acceptance/booking-scenarios.md* --- enumerated scenarios
  (below).

## **1.3.16 Test plan (representative, not exhaustive)**

2696. **IB happy path**: rule allows → confirm → charge → calendar block
      → chat opens → complete → payout after window.

NonTechBlueprint

2697. **RTB**: request → provider accepts → charge → confirm; requ