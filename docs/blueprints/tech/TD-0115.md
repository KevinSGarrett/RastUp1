<!-- id: TD-0115 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 414000-418000 -->

img-src \'self\'*
[*https://cdn.rastup.com*](https://cdn.rastup.com) *data:; media-src
\'self\'* [*https://cdn.rastup.com*](https://cdn.rastup.com)*;
script-src \'self\'; style-src \'self\' \'unsafe-inline\'; font-src
\'self\' data:; connect-src \'self\'*
[*https://api.rastup.com*](https://api.rastup.com)*; frame-ancestors
\'none\'; base-uri \'self\'; form-action \'self\'\",*\
*\"Referrer-Policy\": \"strict-origin-when-cross-origin\",*\
*\"Permissions-Policy\": \"camera=(), microphone=(), geolocation=()\",*\
*\"Strict-Transport-Security\": \"max-age=63072000; includeSubDomains;
preload\",*\
*\"X-Content-Type-Options\": \"nosniff\",*\
*\"X-Frame-Options\": \"DENY\",*\
*\"X-XSS-Protection\": \"0\"*\
*}*\

Apply via **CloudFront Response Headers Policy**; for checkout pages add
Stripe to *connect-src*/*frame-src*.

## **1.18.C GraphQL Complexity/Depth Limits + Rate Quotas**

**Recommended path:** *security/graphql/limits.md*

*GraphQL Limits*\
*- Max depth: 8*\
*- Max cost: 2,000 per query (field weights; nested lists penalized)*\
*- Max input payload: 256 KB*\
*- Introspection: enabled in dev/stage; disabled in prod except for
whitelisted admin IPs*\
\
*Rate Quotas (per 5 minutes)*\
*- Anonymous: 120 requests*\
*- Authenticated user: 900 requests*\
*- Admin OIDC: 1,200 requests*\
*- Burst: 20 requests/second/user*\
*Enforced by WAF + AppSync throttling + identity-aware API Gateway usage
plans (if used).*\

**Resolver guard (pseudocode)**\
**Path:** *security/graphql/cost-limiter.ts*

*export function enforceLimits(ctx) {*\
*if (ctx.depth \> 8 \|\| ctx.cost \> 2000) throw new
Error(\"QUERY_LIMIT_EXCEEDED\");*\
*if (ctx.inputSize \> 256\*1024) throw new Error(\"INPUT_TOO_LARGE\");*\
*}*\

## **1.18.D Cookie & Session Policy**

**Recommended path:** *security/cookies/policy.md*

*Cookies*\
*- \_\_Host-rastup: session JWT reference; SameSite=Lax; Secure;
HttpOnly; Path=/; Domain=\<none\>; Prefix=\_\_Host*\
*- consent: preference state; SameSite=Lax; Secure; HttpOnly=false*\
*- cfduid/edge: none (avoid third-party identifiers)*\
\
*Rules*\
*- No third-party trackers on public pages.*\
*- Analytics via first-party beacon only; respect consent.*\
*- JWTs not stored in localStorage; refresh via secure cookie.*\

## **1.18.E Webhook HMAC Verification (Stripe/Plaid)**

**Recommended path:** *security/webhooks/verify.ts*

*import crypto from \'crypto\';*\
\
*export function verifyStripe(rawBody: Buffer, sigHeader: string,
secret: string) {*\
*// Prefer Stripe SDK constructEvent; fallback HMAC check:*\
*const \[tPart, v1Part\] = sigHeader.split(\',\').map(s =\> s.trim());*\
*const t = tPart.split(\'=\')\[1\]; const v1 =
v1Part.split(\'=\')\[1\];*\
*const payload = \`\${t}.\${rawBody.toString()}\`;*\
*const hmac = crypto.createHmac(\'sha256\',
secret).update(payload).digest(\'hex\');*\
*if (!crypto.timingSafeEqual(Buffer.from(hmac), Buffer.from(v1))) throw
new Error(\'INVALID_SIGNATURE\');*\
*}*\

Store last **event_id** in an idempotency table; on duplicate, return
200 OK without reâ€‘execution.

## **1.18.F S3 & CloudFront: Private Origins, No Public ACLs**

**Recommended path:** *security/s3/policies.md*

*{*\
*\"Version\":\"2012-10-17\",*\
*\"Statement\":\[*\
*{\"Sid\":\"DenyPublicACL\",\"Effect\":\"Deny\",\"Principal\":\"\*\",\"Action\":\"s3:PutBucketAcl\",\"Resource\":\"arn:aws:s3:::cdn.rastup.com\"},*\
*{\"Sid\":\"DenyNotUsingTLS\",\"Effect\":\"Deny\",\"Principal\":\"\*\",\"Action\":\"s3:\*\",\"Resource\":\[\"arn:aws:s3:::cdn.rastup.com\",\"arn:aws:s3:::cdn.rastup.com/\*\"\],\"Condition\":{\"Bool\":{\"aws:SecureTransport\":\"false\"}}},*\
*{\"Sid\":\"AllowOACOnly\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"cloudfront.amazonaws.com\"},\"Action\":\"s3:GetObject\",\"Resource\":\"arn:aws:s3:::cdn.rastup.com/\*\",\"Condition\":{\"StringEquals\":{\"AWS:SourceArn\":\"arn:aws:cloudfront::\<acct\>:distribution/\<id\>\"}}}*\
*\]*\
*}*\

Use **CloudFront Origin Access Control (OAC)**; disable **Public
Access** and ACLs; use **Object Owners