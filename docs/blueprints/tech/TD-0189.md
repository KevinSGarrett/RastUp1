<!-- id: TD-0189 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 680400-684400 -->

t: UpsertUserProfileInput!): UserProfile!*\
*createRoleProfile(input: CreateRoleProfileInput!): ID!*\
*createServiceProfile(input: CreateServiceProfileInput!): ID!*\
*upsertPackage(input: UpsertPackageInput!): ID!*\
*upsertExtra(input: UpsertExtraInput!): ID!*\
*upsertAvailabilityRule(input: UpsertAvailabilityRuleInput!): ID!*\
*publishServiceProfile(input: PublishServiceProfileInput!): Boolean!*\
*uploadProfileAsset(kind: String!, fileName: String!): AWSJSON! \#
presigned URL*\
*}*\

**Guards & invariants**

- *publishServiceProfile* verifies **IDV PASSED** (from §1.5) to unlock
  **payouts & IB**.
- **Completeness** ≥ 80 before publish (avatar, cover, title, 1+
  package, availability, city set).
- **SFW checks** on all assets; NSFW → block or blur and prevent publish
  on public surfaces.

## **1.7.5 Onboarding wizard (step‑gated)**

**State:** Dynamo item *onboarding:{userId}* storing step, answers, and
checklist state; auto‑saves every section.

**Steps (web & mobile identical):**

3073. **Welcome & Role select** (can pick multiple; creates draft Role
      Profiles).
3074. **Basics** (display name, handle, city/region/country, languages;
      Safe‑Mode primer).
3075. **Photos** (avatar & cover; crop; SFW enforcement).
3076. **Genres & About** (role‑specific tags, bio).
3077. **Service Profile** (title/summary; **Package builder** with
      duration, price, deliverables; **Extras**; **License tiers** &
      multipliers; **Travel** pricing).
3078. **Availability & Booking rules** (weekday windows; **IB lead
      time**, **booking window**; min hours; cancellation policy).
3079. **Verification** (IDV prompt if not verified; explains unlocks for
      payouts/IB/NSFW).
3080. **Preview & SEO** (slug verification, JSON‑LD Person, meta/OG
      preview; noindex until published).
3081. **Publish checklist** (all green) → **Publish** (fires
      *sp.publish*).
3082. **Post‑publish** nudges (add portfolio case studies §1.29, connect
      studio §1.24, set Smart Docs §1.26).

**Completeness score**

- Avatar 10, Cover 5, Bio 10, City 5, Genres 5, 1+ Package 25,
  Availability 15, IDV 15, References 5, Social links 5. Hide profiles
  below 60 from search; below 80 cannot publish SP.

## **1.7.6 Pricing & license computation**

**At checkout** (see §1.3), total = *package price + Σ(extras) + license
adder or multiplier + travel fee*.

- **License policy** per SP can be either **multiplier** or **fixed
  adders** table.
- **Travel fee** captures "free_radius_mi"; beyond that per‑mile cents
  applies; server‑validated with provider city coords.
- **Ranges**: enforce *min_price* and guard against zero/very low prices
  (policy knob).

## **1.7.7 Asset pipeline & Safe‑Mode**

- Upload via **presigned S3**; client cropping; Lambda transforms (webp
  1920/1280/640).
- Auto‑moderation Tier‑0 + optional Rekognition Tier‑1; mark
  *asset.sfw_band*; Safe‑Mode defaults ON for public.
- Block publishing of SP if cover/avatar not SFW.

## **1.7.8 Search/SEO integration**

- On publish/update, emit *sp.publish\|update* event.
- **Typesense People index**: fields *handle, displayName, role, city,
  genres, completeness, ibEligible, priceHint, rating*.
- SEO: JSON‑LD **Person** on profile pages; ISR revalidate 300s;
  canonical */p/{handle}*; **noindex** until publish.

## **1.7.9 Privacy & safety**

- Public profile and SP show **approximate location** only; exact
  coordinates never exposed.
- Contact only through **Message Requests** (§1.4).
- Unverified users cannot enable **IB**; payouts disabled until IDV
  passes (§1.5).

## **1.7.10 Notifications & digests**

- Nudges during onboarding: "Add your first package", "Complete
  availability", "Verify ID to unlock payouts/IB".
- Weekly digest: "Your profile completeness is X%," "Add a case study,"
  "Enable IB to appear in Instant Book filter."

## **1.7.11 Observability, KPIs & cost**

- **Events**: *onboarding.step.view\|complete*, *sp.create\|publish*,
  *asset.upload\|blocked*, *complet