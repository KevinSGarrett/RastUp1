<!-- id: TD-0296 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1065600-1069600 -->

*WEBHOOK.SIGNATURE_INVALID* (400) --- "Signature invalid or timestamp
  skew too large."

**J.3 Idempotency**

- All *POST* accept *Idempotency‑Key*; duplicate returns prior
  **status+body** with *Idempotent‑Replay: true*.

**J.4 Pagination**

- Cursor‑based; response includes *next_cursor*; absence = end.
  Per‑endpoint *limit* caps documented.

**J.5 Deprecation**

- *Sunset* header + *Deprecation: true*; docs banner; **90‑day** notice.

**J.6 Acceptance**

- Contract tests pass; partner SDKs round‑trip codes; idempotency proven
  in CI.

## **Appendix K --- CDN / Cache Key Matrix (paste‑ready)**

**Purpose.** High hit‑rates without privacy leaks; deterministic
invalidation.

**K.1 Edge behaviors (CloudFront)**

- */* **(Home)** --- TTL **600s**; Key: *Host, Path, Accept‑Language(2),
  Safe‑Mode*; Invalidate on *home:content_publish*.
- */city/\** --- TTL **1800s**; Key: *Host, Path, Query(role,sort,page),
  Accept‑Language, Safe‑Mode*; warm top 100.
- */people\|/studios\|/work* (grids) --- **no edge cache** when
  personalized; server‑side **Dynamo cache** 60--300s keyed by
  normalized filters + personalization digest.
- */help/\** --- TTL **1--7d**; Key: *Host, Path, Accept‑Language*;
  invalidate on article publish.
- */assets/\** --- immutable; *Cache‑Control: public, max‑age=31536000,
  immutable*.
- */api/\** --- not cached at edge.

**K.2 ISR (Next.js)**

- Revalidate on publish events; fallback blocking for top 1k pages;
  record intervals per template.

**K.3 Vary & privacy**

- Keys **always** include Safe‑Mode; never vary by cookies (except
  non‑prod preview cookie).

**K.4 Invalidation triggers**

- Help publish → */help/\**
- Profile/Studio edit → profile/studio + affected landings
  (batched/minute)
- DMCA takedown → page + related grids

**K.5 Acceptance**

- Edge hit ratios hit targets; no leakage of personalization; p95 TTFB
  meets budgets post‑warm.

## **Appendix L --- Logging, Event Schema & PII Redaction (paste‑ready)**

**Purpose.** Privacy‑safe logs/analytics with full traceability.

**L.1 JSON log schema (required fields)**\
*ts, sev, svc, req_id, msg* (+ optional *user_id*, *route*, *lat_ms*,
*extra*).\
Correlation: *req_id* propagates across services; GraphQL resolvers
include it.

**L.2 Do‑not‑log list**\
Emails, phone numbers, card tokens, full addresses, EXIF raw, OAuth
tokens, IPs (outside restricted security logs).

**L.3 Sampling & retention**

- WARN/ERROR 100%; INFO 10--20% on hot paths (raise to 100% in
  incidents).
- Retention: 30--90 days hot → Glacier 12 months.

**L.4 Event analytics schema**\
Standard fields: *event_name, user_id(hash), session_id, page, surface,
ts, city, role, experiments*.\
Schema contracts in *analytics/contracts/\*.json*; CI validation.

**L.5 Acceptance**\
Secret scans find **0** PII; correlation works end‑to‑end; event
validator shows no drifts.

## **Appendix M --- SBOM & Dependency Policy (paste‑ready)**

**Purpose.** Guarantee supply‑chain integrity and timely vulnerability
remediation across **web**, **api/indexer**, and **infra containers**.

**M.1 SBOM generation (per build)**

- Format: **CycloneDX JSON v1.5**.
- Surfaces: web (Next.js), api/indexer (Node 20), search container
  (Typesense image), any custom Lambda layers.
- CI step: *sbom:generate* → output to
  *security/sbom/{service}-{gitsha}.json*; attach to release.

**M.2 Vulnerability management (SCA/SAST/container)**

- **SCA**: run on SBOM (e.g., Dependency‑Track or OWASP
  dependency‑check).
- **SAST**: run on api/web repos (critical rule set).
- **Container scan**: for any custom images (Trivy or Grype).
- **SLAs**: Critical ≤ **48h**; High ≤ **7d**; Medium ≤ **30d**; Low at
  discretion. Track exceptions in *security/vuln_exceptions.yaml*
  (time‑boxed with owner).

**M.3 Update strategy**

- Dependency bot (Renovate) weekly; security PRs immediately.
- Lockfiles committed; **pinned versions** for critical libs (auth,
  crypto, uploads).
- Node LTS policy (upgrade within 60 days of new L