<!-- id: TD-0197 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 709200-713200 -->

ever
      show studio reviews; Studio pages never show SP reviews.
3218. **Publication hold**: dispute active → reviews do not publish;
      after resolution/timeout → publish with "Resolved" note.
3219. **Thresholds**: JSON‑LD suppressed when *rcount \< 3* or page not
      SFW.
3220. **Fraud heuristics**: ring patterns lower weight → list order
      differs between "Most relevant" and "Most recent"; flag created.
3221. **Nudges**: post‑completion banners and digest entries appear with
      correct cooldowns.

**Add to Acceptance criteria**

- Studio reviews/aggregates fully implemented and **separate** from
  Service Profile reviews.
- Publication correctly **holds** during active disputes; "Resolved"
  note appears post‑resolution when outcome changed.
- SEO thresholds and SFW gates enforced for schema; no low‑sample or
  NSFW pages expose AggregateRating.
- Fraud/abuse heuristics active with progressive actions and audit logs.
- Nudges present; no monetary incentives; all templates
  localized/accessible.

# **§1.10 --- Notifications, Email, Push & Communication Preferences --- Full Technical Development Plan**

**Blueprint alignment.** Your non‑technical plan requires: (a)
**push/email** for new messages, requests, accepts/declines, payment &
payout events, file uploads, approvals, reschedules, disputes; (b)
**digest mode** that bundles messages unless it's a "Booking day" (then
real‑time); and (c) **DND/Quiet Hours** per user, where requests still
deliver silently with summaries. We implement exactly these behaviors
here, with testable guards and artifacts you can paste into your plan.

NonTechBlueprint

NonTechBlueprint

NonTechBlueprint

## **1.10.1 Scope & goals**

- One pipeline for **transactional** (e.g., booking confirmed),
  **behavioral** (pending approvals), **digests**, and **in‑app
  banners**, across **email, push, in‑app**.
- **User preferences** (per‑event, per‑channel), **Quiet Hours**, and
  **critical exceptions** for time‑sensitive items.

NonTechBlueprint

- **Deliverability** (SPF/DKIM/DMARC), bounce/complaint suppression,
  lawful consent/unsubscribe.
- **Cost‑conscious**: SES + Pinpoint (pay‑as‑you‑go), serverless
  orchestration, adapters for future ESPs.
- **ICS export** for calendar on booking-related mail.

NonTechBlueprint

## **1.10.2 Architecture (Amplify Gen‑2 posture)**

- **Frontend**: Next.js & React Native for **Preferences UI** and
  **in‑app notices**.
- **Backend**: AppSync GraphQL → Lambda resolvers.
- **Event bus**: SNS/Kinesis topics (*booking.confirmed*,
  *card.requested*, *payment.failed*, *payout.released*,
  *msg.request.received*, etc.) feed a **Notification Orchestrator**
  (Lambda/Step Functions) which maps events → audience → templates →
  deliveries. Event taxonomy mirrors blueprint coverage for messages,
  approvals, reschedules, disputes, payouts, and uploads.

NonTechBlueprint

- **Senders**: SES (email), Pinpoint (push via APNs/FCM), in‑app via
  Aurora rows + AppSync subscriptions.

- **Storage**:

  - **Aurora** (*notify\_\** tables): catalog, prefs, quiet hours,
    consent/suppression ledger, template registry, send log, in‑app
    inbox.
  - **DynamoDB**: token buckets (rate limiting), idempotency keys,
    quiet‑hour cache.
  - **S3**: compiled MJML templates, email assets, archived provider
    logs.

## **1.10.3 Data model (Aurora schema** ***notify*****) --- DDL artifact**

Paste this migration into your *db/migrations/018_notify.sql*:

*begin;*\
\
*create type notify_channel as enum (\'email\',\'push\',\'inapp\');*\
*create type notify_kind as enum
(\'transactional\',\'required\',\'optional\',\'marketing\');*\
\
*create table notify_event_catalog (*\
*event_key text primary key, \-- e.g., \'booking.confirmed\'*\
*kind notify_kind not null,*\
*default_enabled boolean not null default true,*\
*description text not null*\
*);*\
\
*create table notify_pref (*\
*user_id text not null,*\
*event_key text not null references notify_event_catalog(event_key) on
d