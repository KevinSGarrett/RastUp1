<!-- id: TD-0014 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 50400-54400 -->

equest/approved/paid/failed
- amendment.overtime.request/approved/paid/failed

## **1.3.L Cancellation & Refund Policy Engine**

### **L.1 Invariants**

- Policies are **per leg**, not per LBG. Group summary sums per‑leg
  outcomes.
- Time‑banded windows (e.g., ≥72h, 24--72h, \<24h) determine buyer
  refunds and seller retention.
- **Platform fees** refundability is configurable (default: refundable
  if cancellation initiated promptly or due to provider fault).

### **L.2 Policy schema**

*{ \"version\": 1, \"bands\": \[ { \"from_hours\": 72, \"to_hours\":
null, \"buyer_refund_pct\": 100, \"seller_payout_pct\": 0 }, {
\"from_hours\": 24, \"to_hours\": 72, \"buyer_refund_pct\": 50,
\"seller_payout_pct\": 50 }, { \"from_hours\": 0, \"to_hours\": 24,
\"buyer_refund_pct\": 0, \"seller_payout_pct\": 100 } \],
\"provider_cancel_full_refund\": true, \"admin_override_allowed\":
true}*

### **L.3 Engine behavior**

- Compute **hours_to_start = start_at - cancel_request_time (UTC)**.
- Select band; compute buyer refund and seller retained amount per **leg
  total**, **then** re‑compute taxes/refunds per provider rules.
- If **provider cancels**, buyer gets **full refund** by default.
- **Admin override** permitted with audit fields (*reason*, *actor*,
  *evidence_ref*).

### **L.4 API**

*input CancelLegInput { lbgId: ID!, legId: ID!, reason: String! }type
RefundOutcome { legId: ID!, refundCents: Int!, sellerRetainedCents:
Int!, taxRefundCents: Int! }extend type Mutation {
quoteCancellation(lbgId: ID!, legId: ID!): RefundOutcome!
cancelLeg(input: CancelLegInput!): RefundOutcome!}*

### **L.5 Refund execution**

- Create *refund* rows (per leg) and call Stripe
  *refunds.create(amount)*; track status via webhook.
- Update receipts and Gold facts; emit
  *refund.created\|succeeded\|failed*.

### **L.6 Edge cases**

- **Partial LBG cancel**: If one leg cancels, LBG remains but marks
  counterpart leg for buyer choice (continue or cancel); show **group
  summary** delta.
- **ACH pending**: If original ACH has not settled, we execute refunds
  only after settlement or via cancel API where available; display
  "pending" state to buyer.

## **1.3.M Acceptance Window (Buyer Confirmation After Session)**

### **M.1 Contract**

- After session end, buyer gets an **acceptance window** (e.g., 48h) to
  confirm satisfactory completion.
- If accepted → **queue payouts** immediately. If no response →
  **auto‑accept** at deadline.
- If buyer reports issue within the window → open a **dispute** or
  **resolution ticket**; payouts are **paused** for that leg pending
  outcome.

### **M.2 Data points**

- *lbg.acceptance_deadline* set at confirm time: *end_at + window*.
- *leg.status* remains *confirmed* until accepted → *completed*.

### **M.3 Implementation**

- **Scheduler**: SQS delayed messages or Step Functions **Wait** state;
  on deadline, transition.
- **Idempotency**: completing twice is safe; second call no‑ops.

### **M.4 Telemetry**

- *acceptance.window.start*, *acceptance.buyer.accept*,
  *acceptance.auto_accept*, *acceptance.issue_reported*.

## **1.3.N Studio Deposit Claims**

### **N.1 Purpose**

- Protect studio assets via a **separate authorization** (not GMV).
  Claims allowed for damage, overages not otherwise captured, or rule
  violations.

### **N.2 Flow**

279. Studio files claim with **amount** and **reason**, referencing
     evidence (doc packs, photos, timestamped messages).
280. Support triage → approve/deny/partial.
281. On approval → **capture** part or all of the deposit PaymentIntent.
282. Update receipts and notify buyer; disputes process available.

### **N.3 API & data**

*input DepositClaimInput { legId: ID!, amountCents: Int!, reason:
String!, evidenceRefs: \[String!\] }type DepositClaimResult { legId:
ID!, capturedCents: Int!, status: String! } extend type Mutation {
fileDepositClaim(input: DepositClaimInput!): DepositClaimResult!
approveDepositClaim(claimId: ID!, amountCents: Int!):
DepositClaimResult! denyDepos