<!-- id: TD-0254 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 914400-918400 -->

ermissions**; sensitive actions require reason codes and dual
      controls where mandated.
4221. **Full auditability.** Every privileged read/write emits a
      **WORM** audit record with cryptographic chaining.
4222. **Safety gates by default.** SFW previews only; non‑SFW assets
      never render in public contexts; staff views are watermarked.
4223. **Fast & decisive.** One‑click macros for common actions (pause
      Instant Book, refund with kernel band, suspend user, DMCA
      takedown).
4224. **Low cost.** Static console (Next.js) + AppSync; no heavy
      third‑party admin frameworks.
4225. **Ops‑ready.** Dashboards, alerts, runbooks, and break‑glass flow
      are defined and tested.

## **1.22.2 Roles & permissions (RBAC)**

**Roles (suggested baseline):**

- **Admin:** full system admin, can grant roles, edit city configs and
  feature flags.
- **TrustSafety:** moderation, DMCA, verification approvals,
  suspensions.
- **SupportAgent:** case handling, refunds (within policy bands),
  messaging escalations.
- **Finance:** payouts, adjustments, chargebacks, tax forms review.
- **ContentEditor:** Help Center authoring, public copy edits
  (SEO/Hreflang controls).
- **CityOps:** city‑level curation (Featured slots), spotlight toggles,
  local blackouts.
- **ReadOnlyAuditor:** read‑only access to investigate issues, no
  writes.

**Permission matrix examples (subset):**

- *orders.refund.apply* → SupportAgent (≤ policy cap), Finance (\> cap),
  Admin (override with 2‑man).
- *accounts.suspend* → TrustSafety, Admin (2‑man approval).
- *studios.verify.approve* → TrustSafety.
- *promotions.city_config.edit* → CityOps (within city), Admin (global).
- *features.flags.edit* → Admin only.
- *help.publish* → ContentEditor + policy approver.

## **1.22.3 Data model (Aurora, schema** ***admin*****) --- paste‑ready DDL**

Create *db/migrations/029_admin_console.sql*:

*begin;*\
\
*create schema if not exists admin;*\
\
*create type admin.action_kind as enum (*\
*\'ACCOUNT_SUSPEND\',\'ACCOUNT_UNSUSPEND\',\'PROFILE_HIDE\',\'PROFILE_UNHIDE\',*\
*\'STUDIO_VERIFY_APPROVE\',\'STUDIO_VERIFY_REJECT\',*\
*\'ORDER_REFUND_PARTIAL\',\'ORDER_REFUND_FULL\',\'ORDER_CANCEL_PROVIDER\',\'ORDER_CANCEL_BUYER\',*\
*\'DMCA_TAKEDOWN\',\'DMCA_RESTORE\',*\
*\'PROMO_CITY_CONFIG_EDIT\',\'FEATURE_FLAG_EDIT\',\'CITY_SPOTLIGHT_TOGGLE\',*\
*\'SEC_BREAK_GLASS_START\',\'SEC_BREAK_GLASS_END\'*\
*);*\
\
*create type admin.action_status as enum
(\'PENDING\',\'APPROVED\',\'REJECTED\',\'EXECUTED\',\'FAILED\',\'CANCELLED\');*\
\
*\-- Immutable audit log with chain-of-custody*\
*create table admin.audit_log (*\
*audit_id bigserial primary key,*\
*occurred_at timestamptz not null default now(),*\
*actor_user_id text not null, \-- staff user*\
*actor_role text not null,*\
*action_kind admin.action_kind not null,*\
*target_kind text not null, \--
user\|profile\|studio\|order\|asset\|city\|feature*\
*target_id text not null,*\
*request_json jsonb not null, \-- parameters snapshot*\
*response_json jsonb, \-- result snapshot*\
*ip_hash text,*\
*chain_prev_hash text, \-- previous record hash*\
*chain_hash text not null \-- hash of this row (computed in app)*\
*);*\
\
*\-- Privileged actions queue (supports dual-control approvals)*\
*create table admin.action_request (*\
*request_id text primary key, \-- arq\_\...*\
*created_at timestamptz default now(),*\
*actor_user_id text not null,*\
*action_kind admin.action_kind not null,*\
*target_kind text not null,*\
*target_id text not null,*\
*reason_code text not null, \-- e.g., FRAUD_SUSPECTED, DMCA_NOTICE,
POLICY_VIOLATION*\
*notes_md text,*\
*payload jsonb not null, \-- exact intent (e.g., refund cents)*\
*status admin.action_status not null default \'PENDING\',*\
*approver_user_id text, \-- dual-control approver (if needed)*\
*approved_at timestamptz,*\
*executed_at timestamptz*\
*);*\
\
*create index on admin.action_request (status, created_at);*\
\
*\-- Feature flags & city configs*\
*create schema if not exists config;*\
\