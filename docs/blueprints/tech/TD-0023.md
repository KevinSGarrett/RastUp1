<!-- id: TD-0023 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 82800-86800 -->

LOCKED* --- text violates anticircumvention policy.
- *MSG_NSFW_BLOCKED* --- preview blocked under Safe‑Mode.
- *THREAD_NOT_MEMBER* --- user not participant.
- *THREAD_LOCKED* --- admin lock.
- *ACTION_INVALID_STATE* --- e.g., approve deliverable already closed.
- *ACTION_CONFLICT* --- reschedule overlaps; check §1.3 validation.
- *PANEL_VERSION_CONFLICT* --- optimistic concurrency failed.
- *UPLOAD_QUARANTINED* --- file in safety review.

All error payloads include *code*, *message*, *hint*, *corrId*.

## **1.4.N Test plan (CI + sandbox)**

**Threads & inbox**

450. Create inquiry; promote to project on checkout success.
451. Inbox lists threads with unread counts; mute suppresses
     notifications.

**Messages & presence**\
3) Send text + preview; Safe‑Mode blur/blocked behavior verified; read
receipts correct.\
4) Presence/typing TTLs work; offline after TTL.

**Project Panel**\
5) Brief edit versioning and merge conflict.\
6) Moodboard pin/ordering & NSFW rules.\
7) Shot list CRUD + completion stats.\
8) Files: preview upload → scanned; finals via manifest; blocked file
path.

**Action cards**\
9) Reschedule propose/accept/decline; booking reflects new time.\
10) Request Extra → amendment created & paid (card/ACH flows).\
11) Overtime start/stop → billed and appended to receipts.\
12) Deliverable proofs/finals → approve/revise loop; receipts unaffected
unless change orders occur.\
13) Cancel/Refund → policy engine invoked; math aligns with §1.3.\
14) Deposit claim → approval path; partial capture; receipts reflect.\
15) Dispute open → evidence kit seeded; timeline shows deadlines.

**Moderation**\
16) Anticircumvention: first nudge, then soft block on repeat.\
17) Report/Block actions; muted user can't DM; audit written.

**Notifications**\
18) Dedup window coalesces bursts; quiet hours batching.

**Performance/cost**\
19) p95: open thread ≤ 300 ms (cached) / ≤ 600 ms (cold) at city scale;
subscriptions stable.\
20) S3/CF egress stable; DDB RCU/WCU within budget.

## **1.4.O Work packages (Cursor agents)**

- **Agent B --- API / Realtime**\
  WP‑MSG‑01: DDB table & GSIs; resolvers for inbox, thread, messages,
  project panel; subscriptions.\
  WP‑MSG‑02: Presence/typing TTL flows; read receipts.
- **Agent C --- Actions / Domain hooks**\
  WP‑ACT‑01: Implement action cards + state machines; integrate §1.3
  services (reschedule, amendments, deposit, dispute).\
  WP‑ACT‑02: Webhook handlers → normalized events → DDB/Aurora updates.
- **Agent A --- Web**\
  WP‑WEB‑MSG‑01: Inbox UI, thread UI (role chips, Safe‑Mode), Project
  Panel tabs with optimistic updates.\
  WP‑WEB‑MSG‑02: Upload UI → scanned previews; external manifest attach;
  action card components.
- **Agent D --- Moderation/QA**\
  WP‑MOD‑01: Anticircumvention filters + UI nudges; T&S console; audit
  trails.\
  WP‑QA‑MSG‑01: Full test matrix; fixtures; golden snapshots.

## **1.4.P Acceptance criteria (mark §1.4 FINAL only when ALL true)**

456. Inquiry → Project promotion path live; project thread bound to leg
     or LBG.
457. Messaging works with presence, read receipts, Safe‑Mode previews,
     and NSFW scanning.
458. Project Panel tabs (brief, moodboard, shot list, files, docs,
     expenses, actions) are fully functional; finals handled by external
     manifests.
459. Action cards trigger §1.3 domain flows correctly and idempotently;
     states visible and auditable in thread.
460. Moderation, report/block, and anticircumvention nudges operate with
     audits; policy cannot be bypassed by guests.
461. Notifications (email/push/SMS) are batched, deduped, and respect
     quiet hours.
462. Telemetry covers lifecycle, panel, actions, moderation, and
     notifications; dashboards show health & lag \< threshold.
463. p95 performance meets targets; DDB/AppSync/S3 costs within budget
     alarms for 48h of synthetic load.

# **§1.5 --- Smart Docs & E‑Sign CMS**

*(Clause library · variables · pack assembly · e‑signature · PDF hashing
· retention · rollbacks ·