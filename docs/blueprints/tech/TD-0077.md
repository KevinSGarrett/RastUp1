<!-- id: TD-0077 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 277200-281200 -->

ansub_order (*\
*order_id text primary key, \-- fso\_\...*\
*kind text not null check (kind in (\'tip\',\'ppv\',\'request\')),*\
*creator_id text not null,*\
*buyer_user_id text not null,*\
*amount_cents int not null,*\
*fee_cents int not null default 0, \-- platform fee (see §1.9)*\
*fee_tax_cents int not null default 0,*\
*currency text not null default \'USD\',*\
*status text not null check (status in
(\'pending\',\'succeeded\',\'refunded\',\'failed\',\'disputed\')),*\
*provider text not null, \-- \'stripe\'*\
*provider_charge text, \-- charge/payment intent id*\
*created_at timestamptz not null default now(),*\
*updated_at timestamptz not null default now()*\
*);*\
\
*\-- PPV posts (locked content)*\
*create table fansub_ppv_post (*\
*ppv_id text primary key, \-- fpp\_\...*\
*creator_id text not null references fansub_creator(creator_id),*\
*title text not null,*\
*caption text,*\
*price_cents int not null,*\
*preview_media jsonb not null default \'\[\]\'::jsonb, \-- S3 previews
(scanned)*\
*final_manifest_id text, \-- external manifest id (immutable)*\
*nsfw_band int not null default 0,*\
*is_published boolean not null default false,*\
*created_at timestamptz not null default now(),*\
*updated_at timestamptz not null default now()*\
*);*\
\
*\-- Entitlement when PPV is purchased*\
*create table fansub_ppv_access (*\
*access_id text primary key, \-- fpa\_\...*\
*ppv_id text not null references fansub_ppv_post(ppv_id),*\
*buyer_user_id text not null,*\
*order_id text not null references fansub_order(order_id),*\
*created_at timestamptz not null default now(),*\
*unique (ppv_id, buyer_user_id)*\
*);*\
\
*\-- Custom request lifecycle (threads carry action cards; this table is
the money/evidence)*\
*create table fansub_request (*\
*request_id text primary key, \-- fsr\_\...*\
*thread_id text not null, \-- link to §1.4 thread*\
*creator_id text not null,*\
*buyer_user_id text not null,*\
*title text not null,*\
*brief text not null,*\
*quoted_cents int not null,*\
*status text not null check (status in
(\'quoted\',\'accepted\',\'paid\',\'delivered\',\'approved\',\'revision_requested\',\'refunded\',\'disputed\',\'closed\')),*\
*order_id text, \-- fansub_order once paid*\
*proof_manifest_id text, \-- proofs (external)*\
*final_manifest_id text, \-- finals (external)*\
*created_at timestamptz not null default now(),*\
*updated_at timestamptz not null default now()*\
*);*\

### **C.2 DynamoDB (hot path caches)**

- *fansub_entitlement_cache*: *PK=USER#usr\_...*,
  *SK=CREATOR#fsc\_...\|PPV#fpp\_...* → boolean + expiry (for fast
  gating checks).
- *fansub_rate_limits*: tip/PPV write guardrails per IP/user (abuse
  mitigation).

### **C.3 S3 buckets (previews only)**

- *fansub-previews* (public via CF; all scanned; Safe‑Mode respected).
- *fansub-quarantine* (flagged previews awaiting T&S).
- Final media **not** stored internally---referenced via manifests, as
  in §1.4.

## **1.14.D Payment flows (Stripe) & taxes**

- **Subscriptions:** Stripe Billing **subscriptions** (monthly).

  - Create product per creator with *price_month_cents*; or use one
    product with **price per creator** (more scalable).
  - Webhooks: *invoice.payment_succeeded/failed*,
    *customer.subscription.updated\|deleted*.
  - We record *fansub_subscription* and entitlement (active period).

- **Tips:** one‑time **PaymentIntent** with **Connect destination** to
  the creator account (less platform float). Platform fee (if any)
  handled as application fee on Connect.

- **PPV:** one‑time **PaymentIntent**; after success, create
  *fansub_ppv_access* row to grant entitlement.

- Requests:

  - Creator issues **quote** (action card in thread).
  - Buyer pays **PaymentIntent**; on success, order → *succeeded*;
    request status *paid*.
  - Deliverable posted via action card; buyer **approves** or **requests
    revisions**.
  - Refunds follow §1.3 policy; disputes → §1.9 D.5.

- Taxes:

  - **Subscription/PPV/Requests** are **digital services**; compute
    *