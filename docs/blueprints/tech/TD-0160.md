<!-- id: TD-0160 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 576000-580000 -->

ueprint

## **1.3.2 Architecture & cost posture**

- **Frontend**: Next.js web (SSR for booking; ISR for directory), React
  Native apps.
- **API**: AppSync GraphQL → Lambda resolvers → Aurora Postgres (core
  booking) + DynamoDB (idempotent event log) + S3
  (contracts/attachments).
- **Payments**: **Stripe Connect** (Standard/Express) +
  **PaymentIntents** for cards and **Financial Connections** (ACH).
  Funds are captured immediately to platform balance and **transferred**
  to providers on completion (acts as "escrow" without relying on card
  auth holds that expire). *No extra PSP at launch to control cost and
  complexity.*
- **Compliance**: Stripe KYC/KYB for providers, 3DS when required, PCI
  burden offloaded to Stripe.
- **Cost**: Pure serverless, small Aurora Serverless v2 floor,
  aggressive CloudFront caching, no paid DAM or workflow SaaS.

## **1.3.3 Data model (Aurora, schema** ***booking*****)**

**Recommended path:** *db/migrations/013_booking_core.sql*

*begin;*\
\
*create type booking_mode as enum (\'IB\',\'RTB\',\'INVITE\');*\
*create type booking_status as enum (*\
*\'initiated\',\'pending_accept\',\'countered\',\'accepted\',\'declined\',*\
*\'confirmed\',\'in_progress\',\'delivered\',\'completed\',*\
*\'cancelled_buyer\',\'cancelled_provider\',\'disputed\',\'resolved\'*\
*);*\
\
*\-- Core order*\
*create table booking.order (*\
*order_id text primary key, \-- ord\_\...*\
*buyer_user_id text not null,*\
*provider_user_id text not null, \-- owner of Service Profile*\
*service_profile_id text not null,*\
*package_id text, \-- null when base rate*\
*mode booking_mode not null,*\
*status booking_status not null default \'initiated\',*\
*city text, \-- normalized city for search/seo*\
*start_ts timestamptz not null,*\
*end_ts timestamptz not null,*\
*location_kind text not null check (location_kind in
(\'buyer\',\'provider_studio\',\'rented_studio\',\'remote\')),*\
*location_address text, \-- revealed to parties post-confirm*\
*travel_miles numeric, \-- for travel fee calc*\
*license_tier text, \--
\'commercial\',\'ads\',\'exclusive\',\'buyout\'\...*\
*subtotal_cents int not null default 0,*\
*platform_fee_cents int not null default 0,*\
*tax_cents int not null default 0,*\
*tip_cents int not null default 0,*\
*total_cents int not null default 0, \-- money charged to buyer*\
*currency text not null default \'usd\',*\
*stripe_payment_intent_id text,*\
*connect_transfer_group text,*\
*chat_thread_id text, \-- opens on confirm*\
*created_at timestamptz default now(),*\
*updated_at timestamptz default now()*\
*);*\
\
*\-- Line items (packages, extras, travel, license)*\
*create table booking.line_item (*\
*id text primary key,*\
*order_id text references booking.order(order_id) on delete cascade,*\
*kind text not null check (kind in
(\'package\',\'extra\',\'travel\',\'license\',\'adjustment\',\'refund\')),*\
*title text not null,*\
*qty numeric not null default 1,*\
*unit_cents int not null,*\
*total_cents int not null*\
*);*\
\
*\-- Auto-accept rules (owned by provider)*\
*create table booking.autoaccept_rule (*\
*rule_id text primary key,*\
*service_profile_id text not null,*\
*min_price_cents int,*\
*weekday_mask int, \-- bitmask; e.g., Mon..Sun*\
*max_distance_mi numeric,*\
*allow_ib boolean not null default false*\
*);*\
\
*\-- Request → Accept / Decline / Counter (Custom Offer)*\
*create table booking.request (*\
*request_id text primary key, \-- req\_\...*\
*mode booking_mode not null,*\
*order_id text not null, \-- binds to a draft order*\
*buyer_user_id text not null,*\
*provider_user_id text not null,*\
*status text not null check (status in
(\'pending\',\'accepted\',\'declined\',\'countered\',\'expired\')),*\
*message text,*\
*expires_at timestamptz,*\
*created_at timestamptz default now()*\
*);*\
\
*\-- Smart Invite fan-out recipients*\
*create table booking.invite_recipient (*\
*invite_id text,*\
*recipient_user_id text,*\
*status text not null check (status in
(\'new\',\'responded\',\'awarded\',\'not