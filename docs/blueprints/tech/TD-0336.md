<!-- id: TD-0336 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1209600-1213600 -->

e** check passes per allowlist; violations block merges.
5694. **Remediation SLAs** are enforced (report shows zero overdue
      Critical/High).
5695. (If enabled) SBOMs are synced to **Dependency-Track**; findings
      create tickets automatically.
5696. Documentation (*security/policies/\*.md*) is present in the repo.

# **Appendix Q --- API Versioning & Change Management (GraphQL, REST & Webhooks) --- deep version**

**Purpose.** Define a predictable, low‑cost, **backward‑compatible**
evolution model for:

5697. **GraphQL (AppSync)** used by web/app,
5698. **Partner REST API** (and **webhooks**) used by external
      integrators.

This appendix ships with **policy**, **headers**, **examples**,
**templates**, **gateway config notes**, **contract‑test gates**, and
**acceptance criteria**.

## **Q.0 Scope & baseline**

- **GraphQL (primary)**: additive evolution with explicit
  **deprecations**; avoid breaking changes; use **V2 fields/types** when
  necessary.
- **REST (partner)**: **major version in the URL path** (*/v1*, */v2*);
  minors are additive.
- **Webhooks**: **event schema version** in the envelope + **header**;
  consumers opt‑in per destination.
- **Docs**: OpenAPI per REST version; GraphQL SDL per release; JSON
  Schemas for events.
- **CDN**: version in path simplifies caching; for GraphQL, use
  persisted operations & schema hash headers.

Cross‑refs: Appendix **J** (API Errors & Semantics), **R** (Rate
Limits), **N** (DR), **O** (Data Governance).

## **Q.1 Version identifiers & lifecycle**

### **Q.1.1 Semantic buckets**

- **MAJOR**: breaking changes (REST only) → new path (*/v2*).
- **MINOR**: additive/optional fields, new endpoints → same major.
- **PATCH**: bugfix/typo/docs; no schema change.

### **Q.1.2 Deprecation timeline (defaults)**

- **Announcement → EOL**: **180 days** for breaking (major), **90 days**
  for minor removals, **30 days** for non‑behavioral.
- **Comms**: release notes, RSS/JSON feed, email to API contacts,
  dashboard banner.

## **Q.2 GraphQL versioning policy (AppSync)**

**Principles**

- Never remove or rename fields/types **without a prior deprecation
  period**.
- Prefer **new fields/types** (e.g., *priceMinV2*) and **new inputs**
  (e.g., *CreateBookingInputV2*) over breakage.
- Mark deprecated fields with ***\@deprecated*** including a **sunset
  date** and **doc link**.

**Schema example (*****api/schema/booking.graphql*****)**

*type Booking {*\
*id: ID!*\
*status: BookingStatus!*\
*\# Old price; see priceCents*\
*price: Float \@deprecated(reason: \"Use priceCents. Sunset:
2026-03-31.*
[*https://docs.rastup.com/changelog#priceCents*](https://docs.rastup.com/changelog#priceCents)*\")*\
*priceCents: Int!*\
*}*\
\
*input CreateBookingInput {*\
*\# kept optional to avoid breaking callers*\
*price: Float \@deprecated(reason: \"Use priceCents. Sunset:
2026-03-31.\")*\
*priceCents: Int*\
*}*\
\
*input CreateBookingInputV2 {*\
*priceCents: Int!*\
*}*\
\
*type Mutation {*\
*createBooking(input: CreateBookingInput!): Booking! \# legacy*\
*createBookingV2(input: CreateBookingInputV2!): Booking! \# new*\
*}*\

**Operational headers**

- **Response**: *X-RastUp-Schema-Hash: \<sha256-of-SDL\>* (enables
  clients to cache introspection).
- **Error on deprecated usage (opt‑in)**: if client sends
  *X-RastUp-Strict-Deprecations: 1*, server returns *warning* array
  listing deprecated fields detected in the operation.

**Persisted operations**

- Store whitelisted queries/mutations by ***operationId*** to reduce
  risk and control rollout.
- Schema changes validated against the set (GraphQL Inspector) to catch
  accidental breakage.

## **Q.3 REST versioning policy (Partner API)**

**Primary strategy**: **Path versioning** for simplicity and robust CDN
caching.

- Base URL: [*https://api.rastup.com/v1/*](https://api.rastup.com/v1/)

- Examples:

  - GET /v1/people?city=la&role=photographer
  - POST /v1/orders

- Next major:
  [*https://api.rastup.com/v2/...*](https://api.rastup.com/v2/…)