<!-- id: TD-0061 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 219600-223600 -->

 (Cursor 4‑agent lanes)**

- **Agent B --- Domain/API**\
  WP‑STD‑01: SQL migrations (*studio*, *studio_rate*, *studio_policy*,
  *studio_blackout*, *studio_media*, *studio_verification_audit*).\
  WP‑STD‑02: GraphQL resolvers for Studio CRUD, rates, media, blackouts,
  verification.\
  WP‑STD‑03: Quote engine + buffer/conflict checks; ICS feed generator.
- **Agent C --- Integrations**\
  WP‑STD‑INT‑01: Media scan + transform Lambdas; NSFW + antivirus; S3
  lifecycle.\
  WP‑STD‑INT‑02: Tax quoting for studio services; deposit auth via
  SetupIntent (already in §1.3).
- **Agent A --- Web**\
  WP‑STD‑WEB‑01: Studio create/edit wizard (amenities, pricing, rules,
  deposit).\
  WP‑STD‑WEB‑02: Public Studio page; search facet UI; attach‑in‑flow
  picker in checkout.
- **Agent D --- Admin & QA**\
  WP‑STD‑ADM‑01: Verification queue; policy editor; taxonomy manager;
  pricing inspector.\
  WP‑STD‑QA‑01: Full test matrix automation + synthetic data fixtures.

## **1.11.R Acceptance criteria (mark §1.11 FINAL only when ALL true)**

1135. Studio onboarding, publish, and verification operate end‑to‑end
      with audits.
1136. Quote engine computes hourly/slot/day correctly; buffers/blackouts
      enforced; taxes and deposit surfaced correctly.
1137. Attach‑in‑flow Studio works with **atomic** LBG confirm; deposit
      auth is separate and captured only on approved claim.
1138. Search facets (amenities, verified, deposit, capacity, price)
      function; Safe‑Mode rules hold.
1139. Media pipeline scans/blocks unsafe previews; ordering and
      thumbnails correct; S3 lifecycle active.
1140. Admin tools (verification, policy editor, taxonomy) function with
      immutable audits.
1141. Telemetry complete; p95 perf within targets; costs within budget
      alarms through 48h synthetic run.

# **§1.12 --- Platform & Infrastructure (Amplify Gen 2 Foundation, Environments, Security, Cost)**

*(code‑first Amplify, infra topology, CI/CD, auth, data stores,
observability, budgets, DR, and developer workflow)*

**Purpose.** Establish a cost‑conscious, elastic, and auditable
foundation that can carry us from **build → launch → growth** without
re‑platforming. This section guarantees we're on **Amplify Gen 2
(code‑first/CDK)**---**not** Classic---while wiring AppSync, Cognito,
S3/CloudFront, Aurora, DynamoDB, Step Functions, SQS, EventBridge, WAF,
and our optional engines (Typesense/OpenSearch). It includes IaC,
environments, secrets, runtime limits, budgets, SLOs, admin access
controls, and a full test plan.

We will not advance to the next subsection until §1.12 meets your 99.9%
bar.

## **1.12.A Canon & invariants**

1142. **Amplify Gen 2 only (code‑first)**: infrastructure expressed in
      CDK within the repo; no Amplify Classic "console‑first" projects.
      We add guardrails to prevent accidental Classic usage (see
      §1.12.D).
1143. **Serverless by default** for elasticity and cost: Aurora
      Serverless v2 for relational, DynamoDB for hot‑path messaging,
      Lambda/AppSync for compute, S3/CloudFront for media, Step
      Functions for sagas.
1144. **One source of truth (IaC)**: every resource is created via
      CDK/Amplify Gen 2 stacks in Git; no click‑ops in prod.
1145. **Multi‑environment** (dev, stage, prod) with separate AWS
      accounts, least privilege, and per‑env DNS.
1146. **Security & privacy by design**: KMS, WAF, VPC boundaries,
      least‑priv IAM, PII minimization, age‑gate/safe‑mode enforcement
      server‑side.
1147. **Cost controls baked in**: budgets/alerts, right‑sized defaults,
      lifecycle policies, OCU/RCU caps, and CI step gates when a change
      increases spend.

## **1.12.B Tech stack & version pins (initial)**

- **Frontend:** Next.js (App Router), React 18, TypeScript 5, Node LTS.
- **Hosting & Edge:** Amplify Hosting + CloudFront; ISR/SSR enabled
  where needed.
- **BFF/API:** AWS AppSync (GraphQL) + Lambda resolvers (Node 20), with
  pipeline resolvers for auth, validation, and rate‑limits