<!-- id: TD-0013 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 46800-50800 -->

oking Group, Docs‑before‑Pay, Taxes, Deposits, Refunds,
Disputes)**

We will complete §1.3 in multiple parts. **Part 1** (previous reply)
delivered: entities, state machines, core Aurora schema, checkout API
contracts, "Docs before Pay," charge/deposit strategy, Stripe/Tax
adapters, error taxonomy, and Part‑1 test plan.\
Below is **Part 2/3**, which covers **change orders & overtime,
cancellation/refund policy engine, acceptance windows, deposit claims,
receipts, and webhook mapping** in full build detail. After Part 2, I'll
continue with **Part 3/3** (payouts, reserves/instant payouts, disputes
evidence kits, daily close, admin consoles, full E2E test matrix).

## **1.3.K Change Orders, Extras & Overtime (full specification)**

### **K.1 Purpose & invariants**

- **Change Orders** modify scope before the session starts (e.g.,
  additional deliverables, time shift).
- **Overtime** is an in‑session or post‑session extension beyond the
  booked end time.
- All changes are tracked as immutable **amendment lines**; the original
  booking price snapshot remains unchanged.
- Taxes are **re‑quoted per leg** for each amendment that affects
  taxable amount.
- Payments for positive deltas are collected immediately (card
  incremental capture if available; otherwise a new PaymentIntent). For
  ACH, create a **second** PaymentIntent.

### **K.2 Data model (amendments, already introduced; here are line details)**

*create table amendment ( amendment_id text primary key, \-- amd\_\...
leg_id text not null references booking_leg(leg_id) on delete cascade,
kind text not null check (kind in
(\'change_order\',\'overtime\',\'admin_adjustment\')), line_json jsonb
not null, \-- {name, qty, unit_price_cents, notes} delta_subtotal_cents
int not null, delta_tax_cents int not null, delta_fees_cents int not
null, delta_total_cents int not null, created_by text not null, \--
usr\_\... (buyer, seller, admin) created_at timestamptz not null default
now());*

- ***line_json*** examples:

  - Change order: *{ \"name\":\"Additional
    look\",\"qty\":1,\"unit_price_cents\":5000,\"notes\":\"adds 5
    edits\" }*
  - Overtime: *{ \"name\":\"Overtime
    (30m)\",\"qty\":1,\"unit_price_cents\":7500 }*

### **K.3 API**

*input ChangeOrderInput { legId: ID! name: String! qty: Int! = 1
unitPriceCents: Int! notes: String} input OvertimeInput { legId: ID!
minutes: Int!} type Amendment { amendmentId: ID! legId: ID! kind:
String! line: JSON! deltaSubtotalCents: Int! deltaTaxCents: Int!
deltaFeesCents: Int! deltaTotalCents: Int! createdBy: ID! createdAt:
AWSDateTime!} extend type Mutation { addChangeOrder(input:
ChangeOrderInput!): Amendment! addOvertime(input: OvertimeInput!):
Amendment!}*

### **K.4 Flow**

248. Client requests a change order or overtime.

249. Server validates policy (allowed windows, caps, seller/buyer
     approvals required).

250. Quote **tax** for the delta (per leg, per jurisdiction).

251. **Collect payment** for positive deltas:

     - **Card**: try **incremental capture** if the original PI allows;
       else create a **new PI** for the delta.
     - **ACH**: always create a **new PI** for the delta.

252. On success: write *amendment* row, update **receipts**, emit
     telemetry.

253. On failure: respond with error (*AMENDMENT_PAYMENT_FAILED*) and
     leave original booking untouched.

### **K.5 Validation & caps**

- Overtime limit per policy (e.g., ≤120 minutes).
- Rate source: leg policy or global catalog.
- Seller approval required if buyer initiates post‑session changes
  (configurable).

### **K.6 Telemetry**

- amendment.change_order.request/approved/paid/failed
- amendment.overtime.request/approved/paid/failed

## **1.3.L Cancellation & Refund Policy Engine**

### **L.1 Invariants**

- Policies are **per leg**, not per LBG. Group summary sums per‑leg
  outcomes.
- Time‑banded windows (e.g., ≥72h, 24--72h, \<24h) determine buyer
  refunds and seller retention.
- **Platform fees** refundability is configurable (default: refundab