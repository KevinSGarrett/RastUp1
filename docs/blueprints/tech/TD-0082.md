<!-- id: TD-0082 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 295200-299200 -->

or control, reduce our media costs/risks,
keep **immutable evidence** via hashes.

### **1.14.3.1 Manifest JSON (v1)**

*{*\
*\"manifest_version\": 1,*\
*\"creator_id\": \"fsc_123\",*\
*\"kind\": \"ppv\" \| \"request\",*\
*\"entity_id\": \"fpp_456\" \| \"fsr_789\",*\
*\"created_at\": \"2025-11-06T15:22:10Z\",*\
*\"files\": \[*\
*{*\
*\"file_id\": \"F001\",*\
*\"name\": \"set1_001.jpg\",*\
*\"sha256\": \"b8f9\...e1\",*\
*\"bytes\": 2435612,*\
*\"mime\": \"image/jpeg\",*\
*\"url\":
\"*[*https://creator-bucket.s3.amazonaws.com/\.../set1_001.jpg*](https://creator-bucket.s3.amazonaws.com/.../set1_001.jpg)*\"*\
*},*\
*{*\
*\"file_id\": \"V001\",*\
*\"name\": \"teaser.mp4\",*\
*\"sha256\": \"a3c1\...9f\",*\
*\"bytes\": 43293434,*\
*\"mime\": \"video/mp4\",*\
*\"url\":
\"*[*https://dropbox.com/s/...?dl=1*](https://dropbox.com/s/…?dl=1)*\"*\
*}*\
*\],*\
*\"signature\": {*\
*\"algo\": \"ed25519\",*\
*\"public_key\": \"pk\_\...\",*\
*\"sig\": \"MEYCIQ...\"*\
*}*\
*}*\

- **Validation**: we only cache the manifest (and not the files). On
  access, we **HEAD** each URL to verify availability; for
  disputes/DMCA, we may pull copies into **evidence vault** with a legal
  hold (separate S3 WORM bucket).

### **1.14.3.2 Tokenized access (short‑lived)**

- Generate an **entitlement token** per viewer:

*token = base64url(HMAC(k, user_id \| entity_id \| exp_ts \| nonce))*\

- Present token in redirect query: *?e={exp_ts}&t={token}*. Token TTL \~
  5 minutes.
- For creators using their own CDNs, document how to **validate** this
  token at their edge (optional).

## **1.14.4 Watermarking & previews**

### **1.14.4.1 Image previews**

- **Pipeline**: S3 upload → Lambda trigger:

  - Validate MIME/size → Rekognition NSFW → ClamAV → **Resize** max
    dimension = *preview_policy.image_max_px* → **Watermark**.

- **Watermark spec**:

  - Content: *\@{handle} · {order_or_ppv_id} · {date YYYY‑MM‑DD}*
  - Position: diagonal; **tile** every \~400--600px; 40--55% opacity;
    font *Inter*/fallback; 14--18px \@1x.
  - Color: auto black/white depending on local luminance.

### **1.14.4.2 Video previews**

- **Transcode** to **HLS** with 1 or 2 bitrates (e.g., 540p, 720p);
  preview length *preview_policy.video_preview_sec* (default 15s).
- **Burned watermark** (same content); or overlay at player with WebVTT
  if creator demands reversible watermarking (less secure).
- **Segment key rotation** not required for previews (public), but CF
  signed URLs prevent hotlinking.

## **1.14.5 Stripe object mappings & flows**

### **1.14.5.1 Subscriptions (Stripe Billing + Connect)**

- Create **one Product** "Fan‑Sub Subscription" with **one Price per
  creator** (*price\_{creator_id}* monthly).

- **Connect mode**:

  - Use **Application Fees** (*application_fee_amount*) to collect
    platform fees on each invoice (if we charge one), and route the
    **net** to the creator's **Connect account** via
    **transfer_data\[destination\]**.
  - Alternatively, use **Direct charges** on the creator's account if we
    want creator seen as MoR for subs. MVP: **Platform is MoR** to
    centralize tax handling (safer for compliance).

- **Key webhook events**:

  - *invoice.payment_succeeded* → create *fansub_subscription_invoice*
    row; (entitlement period) = *current_period_end*.
  - *invoice.payment_failed* / *customer.subscription.updated* (status
    *past_due*) → dunning schedule (below).
  - *customer.subscription.deleted* → mark *status=\'canceled\'* and
    entitlement ends at period end (no retro refunds unless policy
    configured).

**Dunning schedule (MVP)**

- Stripe handles retries at 3‑day cadence up to 4 retries; we mirror
  state changes; optional in‑product reminder at 24h before
  cancellation.

### **1.14.5.2 PPV, Tips, Requests (PaymentIntents)**

- Create **PaymentIntent** with:

  - *amount = price + tax + (optional platform fee tax) +
    application_fee_amount* (if platform collects fee).
  - *transfer_data\[destination\]=creator_connect_account