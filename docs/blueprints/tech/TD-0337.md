<!-- id: TD-0337 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1213200-1217200 -->

ector) to catch
  accidental breakage.

## **Q.3 REST versioning policy (Partner API)**

**Primary strategy**: **Path versioning** for simplicity and robust CDN
caching.

- Base URL: [*https://api.rastup.com/v1/*](https://api.rastup.com/v1/)

- Examples:

  - GET /v1/people?city=la&role=photographer
  - POST /v1/orders

- Next major:
  [*https://api.rastup.com/v2/...*](https://api.rastup.com/v2/…)

**Deprecation & sunset headers (RFC 8594)**

- ***Deprecation: true*** (or date)
- Sunset: Wed, 31 Mar 2026 23:59:59 GMT
- Link: \<https://docs.rastup.com/migrate/v2\>; rel=\"deprecation\";
  type=\"text/html\"

**Sample deprecation response**

*HTTP/1.1 200 OK*\
*Deprecation: true*\
*Sunset: Wed, 31 Mar 2026 23:59:59 GMT*\
*Link: \<https://docs.rastup.com/migrate/v2\>; rel=\"deprecation\";
type=\"text/html\"*\
*X-RastUp-Change: priceCents-required-in-v2*\
*Content-Type: application/json*\
*\...*\

**Content negotiation (optional)**\
Support *Accept: application/vnd.rastup.v1+json* as an **alternate**
signal; CDN caches stay path‑based.

## **Q.4 Webhook versioning & negotiation**

**Envelope (CloudEvents‑style)**\
Headers:

*ce-specversion: 1.0*\
*ce-type: com.rastup.order.confirmed*\
*ce-source:* [*https://api.rastup.com*](https://api.rastup.com)*ce-id:
01HEYZM\...*\
*ce-time: 2025-11-06T13:22:31Z*\
*X-RastUp-Webhook-Version: 1*\

Body (example):

*{*\
*\"version\": 1,*\
*\"data\": {*\
*\"orderId\": \"ord_123\",*\
*\"status\": \"CONFIRMED\",*\
*\"priceCents\": 25000*\
*},*\
*\"signature\": \"base64(hmac_sha256(payload, secret))\"*\
*}*\

**Destination preferences**

- Each webhook endpoint stores a **desired version** (default **1**) and
  content type; test deliveries respect those.
- Breaking change → introduce **version 2** events, **never mutate**
  version 1.

## **Q.5 Change categories & rules**

**Non‑breaking (okay within same major)**

- Add fields with **default/null**; add optional request params; add new
  endpoints; add enum values **with fallback**.
- Tighten validation without changing successful requests **from
  documented clients**.

**Breaking (requires major bump)**

- Remove/rename fields; change types or requiredness; change default
  behavior; alter error shapes; change pagination scheme; alter
  authentication scheme.

**GraphQL specifics**

- New enum values are generally **safe**, but clients must tolerate
  unknowns; we test official SDKs.

## **Q.6 Changelog & migration templates**

***docs/CHANGELOG.md*** **(template)**

*\# RastUp API Changelog*\
\
*\## \[2025-11-06\] Added \`priceCents\` (GraphQL + REST)*\
*- GraphQL: \`Booking.price\` deprecated, use \`priceCents\`.*\
*- REST: \`/v1/orders\` accepts \`priceCents\` (optional); will be
required in \*\*v2\*\*.*\
*- Webhooks: \`order.confirmed\` payload includes \`priceCents\` (v1);
\`price\` remains for compatibility.*\
\
*Impact: Non-breaking (minor). Deprecation sunset \*\*2026-03-31\*\*.*\

***docs/migrations/UPGRADE_to_v2.md*** **(template)**

*\# Upgrade to API v2*\
\
*\*\*Sunset of v1:\*\* 2026-03-31*\
\
*\## REST changes*\
*- \`price\` removed → send \`priceCents\` (integer).*\
*- Pagination → \`cursor\` only (offset removed).*\
*- Error structure gains \`traceId\`.*\
\
*\## GraphQL changes*\
*- Use \`createBookingV2\`.*\
*- \`Booking.price\` removed; \`priceCents\` required.*\
\
*\## Webhooks*\
*- Switch destination to version=2 in dashboard or via API:*\
*PATCH /v1/webhooks/{id} { \"version\": 2 }*\
\
*\## Testing*\
*- Sandbox base URL:*
[*https://sandbox.api.rastup.com/v2/*](https://sandbox.api.rastup.com/v2/)

**Machine‑readable feed** ***docs/versions.json***

*{*\
*\"rest\": { \"stable\": \"v1\", \"supported\": \[\"v1\",\"v2-beta\"\],
\"sunsets\": { \"v1\": \"2026-03-31\" } },*\
*\"graphql\": { \"schemaHash\": \"a9f3...\", \"deprecated\":
\[{\"field\":\"Booking.price\",\"sunset\":\"2026-03-31\"}\] },*\
*\"webhooks\": { \"versions\": \[1,2\], \"default\": 1 }*\
*}*\

## **Q.7 Contract tests & CI gates**

**GraphQL**

- Use **GraphQL Inspect