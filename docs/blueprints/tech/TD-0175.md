<!-- id: TD-0175 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 630000-634000 -->

t*, *has:file\|image\|card*,
  *card:reschedule\|extras\|proofs\|expense\|complete\|dispute\|safety*,
  *date:2025-11*, *city:\"Los Angeles\"*.

NonTechBlueprint

**Typesense collection** ***inbox_index*** **(flattened per message)**:

*{*\
*\"name\": \"inbox_index\",*\
*\"fields\": \[*\
*{\"name\":\"userId\",\"type\":\"string\"},*\
*{\"name\":\"threadId\",\"type\":\"string\"},*\
*{\"name\":\"kind\",\"type\":\"string\"}, //
inquiry\|booking\|invite\|support*\
*{\"name\":\"participants\",\"type\":\"string\[\]\"},*\
*{\"name\":\"role\",\"type\":\"string\"}, // Model/Photographer/\...*\
*{\"name\":\"city\",\"type\":\"string\"},*\
*{\"name\":\"has\",\"type\":\"string\[\]\"}, // file\|image\|card*\
*{\"name\":\"card\",\"type\":\"string\[\]\"}, //
reschedule\|extras\|\...*\
*{\"name\":\"text\",\"type\":\"string\"},*\
*{\"name\":\"ts\",\"type\":\"int64\", \"optional\": false}*\
*\],*\
*\"default_sorting_field\": \"ts\"*\
*}*\

**Indexing rules**

- Every new message produces one doc per **recipient** (for personal
  inbox views).
- *text* contains message body **or** card summary (e.g., "Reschedule
  from 2--5pm → 3--6pm").
- *has* is derived from attachments/card presence.
- **Data minimization:** do **not** index PII (addresses, phone) or full
  proofs; index only file names and user‑provided titles.

NonTechBlueprint

**Examples**

- *card:extras role:photographer* → threads with extras proposals to you
  from photographers.
- *has:file date:2025-11* → threads with docs shared this month.

## **1.4.C Presence, typing, delivery & read receipts**

**Presence / typing**

- **DynamoDB** items: *msg_typing* (*pk=threadId*, *sk=userId*,
  TTL=10s).
- AppSync real‑time subscriptions broadcast **aggregate** typing states
  (user ID list + TTL).
- Display "Active 2h ago" using last message or last read.

NonTechBlueprint

**Delivery/Read**

- Delivery = server accepted & fanned out (✓✓ hollow).
- Read = recipient updated *thread_participant.last_read_ts* beyond
  message ts (✓✓ filled).
- Push open events can opportunistically update read state.

## **1.4.D Email + Push templates (transactional & digest)**

**Providers:** SES (email), Pinpoint/APNs/FCM (push).\
**Transactional events:** Message Request, Request Accepted/Declined,
New Message, Card Proposals (reschedule/extras/approvals), Booking
Confirmed/Rescheduled, Milestone Delivered, Dispute Opened.

**Email template structure** (HTML + text):

- **Subject patterns**:

  - \[RastUp\] {Name} sent a message
  - \[Action Required\] {Name} proposed {cardType}
  - \[Confirm\] Your booking with {Provider} is {status}

- **Header**: brand bar + thread subject + role chip

- **Body**: last message snippet or card summary + CTA buttons (**Open
  Thread**, **Approve**, **Decline**)

- **Footer**: notification preferences + legal

- **ICS attachment**: on **confirmed** bookings or **rescheduled**
  timeslots.

NonTechBlueprint

**Push payloads** mirror subjects with compact actions.

## **1.4.E Digest generation & batching**

- **Daily** digest for active users; **weekly** for low‑activity (opt‑in
  per preferences).
- Sections: **New requests**, **Pending approvals (cards)**, **Upcoming
  bookings** (with ICS), **Files received**, **Unanswered messages**.

NonTechBlueprint

- **Timezone‑aware** send windows; quiet‑hours honor (see below).
- **De‑dup logic**: if a transactional email already sent \< N hours
  ago, show only a summary line.

## **1.4.F Quiet Hours & exceptions**

- User can set **Quiet Hours** (e.g., 10pm--7am local). Messages still
  arrive but **no push**.
- **Escalation exceptions** (always notify): booking starting \< 12h;
  reschedule requests expiring \< 6h; dispute activity; payment/escrow
  failures. User may override these exceptions in preferences.

NonTechBlueprint

## **1.4.G Anti‑circumvention patterns & thresholds**

**Goal:** keep value on‑platform (escrow, protection, reviews) while
being fair and transparent.

NonTechBlueprint

**Risk signals (scored):**

- **Key