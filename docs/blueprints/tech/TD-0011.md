<!-- id: TD-0011 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 39600-43600 -->

y: String!): CheckoutDraft!
attachStudioInFlow(draftId: ID!, studioId: ID!): CheckoutDraft! \#
validates time/conflicts createDocPack(draftId: ID!): DocPack! \#
returns envelope links markDocSigned(draftId: ID!, packId: ID!,
envelopeId: ID!): DocPack! \# Payment createPaymentIntent(draftId: ID!,
method: PaymentMethodInput!): PaymentIntentClientSecret!
confirmPayment(draftId: ID!): CheckoutConfirmation! \# triggers atomic
confirm \# Amendments addChangeOrder(lbgId: ID!, legId: ID!, change:
ChangeOrderInput!): Amendment! addOvertime(lbgId: ID!, legId: ID!,
minutes: Int!): Amendment! \# Post-session markCompleted(lbgId: ID!):
CompletionReceipt! \# or auto after acceptance window
fileDepositClaim(legId: ID!, amountCents: Int!, reason: String!):
DepositClaimResult!} type Subscription { checkoutStatus(lbgId: ID!):
CheckoutEvent!}*

**Guards**

- *attachStudioInFlow* checks studio availability, deposit policy, and
  buyer acceptance of additional terms.
- *createDocPack* enforces pack content per leg type and role; blocks
  payment steps until **both** legs have signed docs recorded.
- *confirmPayment* fails atomically if **any** leg fails validation or
  funding.

## **1.3.J Receipts & statements**

- **Per‑leg receipts** (line items, taxes, policy, refunds) + **Group
  summary** receipt for the LBG.
- Each receipt includes doc pack hashes (immutable), jurisdiction codes,
  PaymentIntent id, and split allocations.

## **1.3.K Payout scheduler & reserves**

- Default payout policy: queue **on completion** (or acceptance window
  end).
- **Reserves** (first‑payout or risk‑flagged sellers): hold for *N* days
  configurable per seller; Admin can override.
- Stripe transfers created with idempotency and reconciled via webhooks.

## **1.3.L Admin surfaces (Finance, Support, Trust)**

- **Finance**: payment/refund ledger, payout scheduler, reserve
  settings, tax commits, deposit claim approvals, reconciliation status,
  daily close.
- **Support**: cancel/partial refund tools with policy simulator; resend
  receipts; check‑in/out timeline; evidence export.
- **Trust**: dispute management, evidence pack builder, doc pack audit,
  chargeback trend analytics.

All actions are audited (actor, reason, before/after) and gated by
RBAC + two‑person approvals where money moves.

## **1.3.M Telemetry (immutable events)**

- *lbg.create*, *leg.create*, *checkout.start*, *docs.pack.create*,
  *docs.envelope.signed*,
- *payment.intent.created*, *payment.intent.requires_action*,
  *payment.capture.succeeded\|failed*,
- *deposit.auth.authorized\|captured\|voided\|expired*,
- *amendment.added*, *tax.quote*, *tax.commit*,
- *payout.queued\|paid\|failed*, *refund.created\|succeeded\|failed*,
- *dispute.opened\|evidence_submitted\|won\|lost*.

These feed Bronze→Silver→Gold with money checks (Σsplits = charge,
Σpayouts + fees + refunds = charge over time).

## **1.3.N SLOs & cost**

- **SLOs:** Checkout p95 \< **2s** (incl. tax/3DS); charge error rate \<
  **1%** (excluding user cancellations); payout queue drain \<
  **15 min** after completion; document pack creation \< **3s** p95.
- **Cost:** Stripe pay‑as‑you‑go; deposits are rare operations; tax
  provider billed per transaction; Step Functions + Lambdas are
  event‑driven; no always‑on compute.

## **1.3.O Error taxonomy (client‑safe)**

- *CHK_DOCS_REQUIRED* --- pack not complete.
- *CHK_STUDIO_CONFLICT* --- studio unavailable at requested time.
- *CHK_CARD_ACTION_REQUIRED* --- 3DS step required.
- *CHK_ACH_NOT_VERIFIED* --- bank link incomplete.
- *CHK_ATOMIC_FAIL* --- one leg failed validation; nothing charged.
- *REFUND_POLICY_BLOCK* --- requested refund outside policy window.
- *DEPOSIT_CLAIM_DENIED* --- claim exceeds policy/evidence.

Error payloads include *code*, *message*, *hint*, *corrId*, and
suggested next steps.

## **1.3.P Test plan (must‑pass, CI + sandbox)**

**Happy paths**

227. **Single‑leg Talent booking** (card): docs → pay → confirm →
     complete → payout queued.
228. **LBG Talen