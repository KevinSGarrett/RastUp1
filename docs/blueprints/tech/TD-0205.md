<!-- id: TD-0205 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 738000-742000 -->

e.published*, *download.performed*.
- **KPIs**: p95 ingest→ready latency, transcode failure rate, AV
  false‑positive/negative rates (spot QA), storage by class, CDN egress,
  proof→approval rate, deliverables download rate.
- **Alarms**: high failure spikes, queue backlog, elevated CDN 4xx/5xx.

## **1.11.12 Work packages (Cursor --- 4 agents)**

- **Agent A --- API & Models**: migrations, GraphQL (*media.graphql*),
  presign & completion, access rules; evidence hooks.
- **Agent B --- Processing**: AV scan, image transforms, MediaConvert
  templates, watermark overlay, metadata extraction.
- **Agent C --- Delivery & Security**: CloudFront, signed URLs, OAC,
  CORS, anti‑hotlinking, lifecycle policies.
- **Agent D --- Product Integrations**: Proofs Action Card, Deliverables
  link‑out in Orders, Profile/SP galleries & cropper.

Each agent ships with unit tests, integration tests (S3 events), seed
fixtures, dashboards, and rollback plan.

## **1.11.13 Tests**

3344. **Happy paths**: image & video upload → AV pass →
      transforms/transcode → publish; public vs protected URLs behave.
3345. **Quarantine**: AV fail blocks asset; no variants created; user
      sees clear error.
3346. **Safe‑Mode**: NSFW detected → *safeModeRequired=true*; public
      surfaces blur/hide; in‑app still available per gating.
3347. **Proofs**: watermarks present; expiry enforced; approve vs
      request‑changes flows mutate the order timeline (§1.4/§1.3).
3348. **Deliverables**: license metadata recorded; signed URLs expire;
      downloads logged.
3349. **Lifecycle**: proofs past expiry auto‑deleted; raw → IA after 30
      days.
3350. **Security**: no public S3 access; OAC enforced; hotlink
      prevention works; EXIF GPS stripped.
3351. **Cost**: adaptive ladder skips unnecessary renditions; quotas
      enforced; duplicate upload reuses existing variants.

## **1.11.14 Artifacts (paste‑ready)**

- *db/migrations/019_media.sql* --- schema above.
- *api/schema/media.graphql* --- API above.
- *processors/images/index.ts* --- sharp transforms + watermark overlay.
- *processors/video/job.json* --- MediaConvert job template (renditions,
  overlays).
- *processors/safe-mode/index.ts* --- Tier‑0 classifier + Rekognition
  escalations.
- *services/cdn/signing.ts* --- CloudFront URL signing helper.
- *ops/runbooks/media-lifecycle.md* --- lifecycle, costs, knobs &
  alarms.
- *observability/dashboards/media.md* --- KPI queries/specs.

## **1.11.15 Acceptance criteria --- mark §1.11 FINAL only when ALL true**

3360. Users can upload images/video/audio/PDFs; large files resume;
      types/sizes validated; AV scan gates publication.
3361. Processed variants exist (images: 1920/1280/640 + cover; video:
      HLS ladder + poster) with correct metadata.
3362. **Safe‑Mode** is enforced: public surfaces show only SFW; NSFW
      assets are blurred/hidden externally; no NSFW previews in
      email/push.
3363. **Proof galleries**: watermarked, expiring, selectable;
      approvals/change‑requests feed Action Card flows.
3364. **Deliverables**: non‑watermarked, licensed; signed URLs; download
      logs.
3365. Buckets encrypted (KMS), CloudFront signed URLs with OAC;
      anti‑hotlinking; EXIF GPS stripped.
3366. Lifecycle rules, adaptive transcode, quotas & dedupe active to
      control cost.
3367. Dashboards & alarms in place; ingest→ready p95 within target;
      failure spikes trigger alerts.

# **§1.12 --- Calendar, Availability & External Sync --- Full Technical Development Plan**

**Purpose.** Provide reliable, time‑zone--correct **availability** for
Providers (and later Studios), power **Instant Book** (IB) and
**Request‑to‑Book** (RTB), support **rescheduling**, generate/consume
**calendar events (ICS)**, and (MVP) perform **read‑only external
imports** with an upgrade path to **two‑way sync**. Enforce
lead‑time/booking‑window rules, resolve conflicts deterministically, and
keep costs elastic.

## **1.12.1 Scope → Technical**

- **Availability**: weekl