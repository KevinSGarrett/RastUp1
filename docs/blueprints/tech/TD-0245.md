<!-- id: TD-0245 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 882000-886000 -->

ady.** Content stored with *locale*, falls back
      to English when missing; *hreflang* in SEO pages.

## **1.20.2 Information architecture**

- **Top categories** (examples): Account, Messaging, Bookings, Payments
  & Payouts, Studios & Spaces, Disputes & Refunds, Safety & Policy,
  Technical Issues.

- **Article types**:

  - How‑to (step‑by‑step)
  - Policy (rules, penalties, allowed/prohibited)
  - Troubleshooter (guided flow)
  - FAQ (Q/A)
  - Release note (changelogs; optional public)

- **Visibility**: *public* vs *internal* (internal for agents only;
  never indexed).

## **1.20.3 Data model (Aurora, schema** ***kb*****) --- paste‑ready DDL**

Create *db/migrations/027_helpcenter.sql*:

*begin;*\
\
*create schema if not exists kb;*\
\
*create type kb.article_kind as enum
(\'howto\',\'policy\',\'troubleshooter\',\'faq\',\'release\');*\
*create type kb.visibility as enum (\'public\',\'internal\');*\
*create type kb.review_status as enum (\'fresh\',\'due\',\'overdue\');*\
*create type kb.locale_code as enum (\'en\',\'es\'); \-- extend as
needed*\
\
*create table kb.article (*\
*article_id text primary key, \-- kba\_\...*\
*slug text not null unique, \-- canonical, kebab-case*\
*kind kb.article_kind not null,*\
*visibility kb.visibility not null default \'public\',*\
*locale kb.locale_code not null default \'en\',*\
*title text not null,*\
*summary text not null,*\
*body_md text not null, \-- markdown/MDX*\
*faq_json jsonb not null default \'\[\]\', \-- \[{q,a}\] when
kind=\'faq\' or embedded FAQ*\
*owner_user_id text not null, \-- accountable editor*\
*review_interval_days int not null default 90,*\
*last_reviewed_at timestamptz,*\
*review_status kb.review_status not null default \'fresh\',*\
*related_slugs text\[\] not null default \'{}\',*\
*category text not null,*\
*tags text\[\] not null default \'{}\',*\
*seo_noindex boolean not null default false, \-- derived from visibility
unless overridden*\
*published_at timestamptz,*\
*updated_at timestamptz default now()*\
*);*\
\
*\-- Article versions (immutable history)*\
*create table kb.article_version (*\
*version_id text primary key, \-- kbv\_\...*\
*article_id text not null references kb.article(article_id) on delete
cascade,*\
*version_num int not null,*\
*diff_summary text,*\
*body_md text not null,*\
*faq_json jsonb not null,*\
*updated_by text not null,*\
*created_at timestamptz default now(),*\
*unique (article_id, version_num)*\
*);*\
\
*\-- Troubleshooter graph (decision tree) for kind=\'troubleshooter\'*\
*create table kb.troubleshooter (*\
*article_id text primary key references kb.article(article_id) on delete
cascade,*\
*graph_json jsonb not null \--
{nodes:\[{id,type,text,choices:\[\...\],action:{open_case_type:\'payment\'}}\]}*\
*);*\
\
*\-- Feedback & signals*\
*create table kb.article_feedback (*\
*fb_id bigserial primary key,*\
*article_id text not null references kb.article(article_id) on delete
cascade,*\
*user_id text, \-- nullable for anonymous*\
*helpful boolean not null,*\
*comment_text text,*\
*created_at timestamptz default now(),*\
*ip_hash text*\
*);*\
\
*\-- Redirects (301) for slug changes*\
*create table kb.redirect (*\
*from_slug text primary key,*\
*to_slug text not null references kb.article(slug)*\
*);*\
\
*commit;*\

## **1.20.4 GraphQL API (AppSync) --- paste‑ready schema**

Create *api/schema/helpcenter.graphql*:

*scalar AWSJSON*\
*scalar AWSDateTime*\
*scalar AWSURL*\
\
*enum KBKind { HOWTO POLICY TROUBLESHOOTER FAQ RELEASE }*\
\
*type KBArticle {*\
*id: ID!, slug: String!, kind: KBKind!, locale: String!, title: String!,
summary: String!,*\
*bodyMd: String!, faqJson: AWSJSON!, category: String!, tags:
\[String!\]!,*\
*visibility: String!, publishedAt: AWSDateTime, lastReviewedAt:
AWSDateTime, reviewStatus: String!,*\
*relatedSlugs: \[String!\]!*\
*}*\
*type KBList { items: \[KBArticle!\]!, nextCursor: String }*\
\
*type Query {*\
*kbArticle(slug: String!, locale: String = \"en\"): KBArticle*\
*kbList(category: String, q: String, 