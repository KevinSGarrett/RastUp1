<!-- id: TD-0041 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 147600-151600 -->

 S3 storage minimal (preview photos); lifecycle to Intelligent-Tiering
  after 30 days.

## **1.8.M Test plan (CI + sandbox)**

**Eligibility & write path**

788. Completed leg → buyer can post one review; seller cannot; duplicate
     blocked.
789. Edit within 24 h succeeds; rating edit blocked; after window, edit
     blocked.

**Fraud controls**\
3) Self-review attempt blocked.\
4) Ring/burst simulated → auto-hide & queue for T&S; restoration path
verified.\
5) Toxic content flagged → hidden; appeal → restore.

**Aggregation**\
6) Weighted average & decay verified vs golden file; low-sample
indicator shown correctly.\
7) Facet averages computed; distribution histograms accurate.

**Surfacing**\
8) Search cards show correct stars/counts; "New" chip for low sample.\
9) Profile page shows highlights and facet bars; recent window updates.

**Admin**\
10) Hide/remove/restore writes audits; bulk ring takedown works; reply
moderation enforced.

**Performance**\
11) p95 entity reputation fetch ≤ 120 ms (cached); recompute job under 1
min per 10k entities.

## **1.8.N Work packages (Cursor agents)**

- **Agent B --- Domain/API**\
  WP-REV-01: SQL tables + GraphQL resolvers (create, edit, list,
  reputation).\
  WP-REV-02: Aggregation jobs (real-time & nightly full), cache
  invalidation.
- **Agent C --- Integrity**\
  WP-REV-FRD-01: Fraud heuristics, classifiers integration, auto-hide
  queue.\
  WP-REV-FRD-02: Rate limiter; ring detection; report intake.
- **Agent A --- Web**\
  WP-WEB-REV-01: UI components for stars, distributions, facets,
  highlights, replies; review composer.\
  WP-WEB-REV-02: Nudges & inbox cards; moderation states in UI.
- **Agent D --- Admin & QA**\
  WP-ADM-REV-01: Moderation console, audits, appeals.\
  WP-QA-REV-01: Full test matrix automation; golden datasets for
  aggregation math.

## **1.8.O Acceptance criteria (mark §1.8 FINAL only when ALL true)**

794. Only eligible buyers can review; one per leg; edit window enforced;
     content scanned.
795. Aggregates computed with decay and sample guards; fraud-flagged
     reviews excluded pending review.
796. Surfacing correct on SP/Studio pages, search cards, booking/thread
     headers; "New" chip behavior correct.
797. Moderation & appeals operate with immutable audits; bulk actions
     for rings.
798. Notifications for reminders/public replies sent; rate limits
     enforced; policy respected.
799. Telemetry complete; dashboards reflect health and abuse trends.
800. Performance & cost within targets; caches invalidate correctly on
     updates.

# **§1.9 --- Payments & Wallet**

*(Platform fees · Taxes on fees · Separate "ads" credits vs. buyer
wallet · Statements · Accounting & revenue recognition · GL & recon ·
APIs · Admin · Telemetry · Tests · Cost)*

**Purpose.** Define the *financial core* that separates marketplace
**GMV** from **platform fee revenue**, treats **taxes correctly**, keeps
"ads credits" separate from "buyer wallet," and drives statements,
accounting, and reconciliation. This section makes our booking money
flows audit‑grade and implementation‑ready across **data model, fee
math, GL entries, APIs, admin tools, telemetry, SLOs, and tests**. It
aligns with §§1.3 (Checkout), 1.4 (Messaging/Project Panel), and 1.7
(Promotions).

We will not advance to §1.10 until §1.9 satisfies your 99.9% bar.

## **1.9.A Canon & invariants**

801. Money in integer cents (UTC timestamps).

802. **One buyer charge per LBG** (already in §1.3), with **per‑leg
     allocations** and **escrow‑like holds** (payouts only on
     completion/acceptance window).

803. **Platform fee ≠ GMV.** Fees are **not** the seller's price; fees
     are separate lines and recognized as **revenue** for the platform
     only when *earned*.

804. **Taxes split correctly**: (a) **service taxes** on the seller's
     service (pass‑through liability to seller or to tax authority
     depending on "merchant‑of‑record" (MoR) configuration), and (b)
     **platform fee taxes** (plat