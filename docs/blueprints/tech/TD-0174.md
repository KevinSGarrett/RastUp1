<!-- id: TD-0174 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 626400-630400 -->

 Action Card payload schemas (authoritative)**

Cards are first‑class messages (*message.kind=\'card\'*) with *cardType*
and validated *cardPayload* (server‑side). Cards mutate orders (see
§1.3) only on **accept**. Card audit entries are immutable.

**Common envelope (JSON):**

*{*\
*\"cardId\": \"crd_xxx\",*\
*\"threadId\": \"thr_xxx\",*\
*\"type\":
\"reschedule\|extras\|proofs\|expense\|complete\|dispute\|safety\",*\
*\"version\": 1,*\
*\"proposedBy\": \"usr_xxx\",*\
*\"createdAt\": \"2025-11-06T00:00:00Z\",*\
*\"expiresAt\": \"2025-11-08T00:00:00Z\"*\
*}*\

### **1) Reschedule (*****type=\"reschedule\"*****)**

*{*\
*\"oldStart\": \"2025-11-20T14:00:00Z\",*\
*\"oldEnd\": \"2025-11-20T17:00:00Z\",*\
*\"newStart\": \"2025-11-22T14:00:00Z\",*\
*\"newEnd\": \"2025-11-22T17:00:00Z\",*\
*\"reason\": \"Weather\"*\
*}*\

**Rules:** new slot must respect provider availability & rule windows;
conflicts produce a **server‑generated error card**; acceptance updates
the booking schedule and calendar blocks.

NonTechBlueprint

### **2) Extras / Overtime (*****type=\"extras\"*****)**

*{*\
*\"items\":\[*\
*{\"title\":\"Extra edits\",\"qty\":10,\"unitCents\":500},*\
*{\"title\":\"Rush delivery (48h)\",\"qty\":1,\"unitCents\":15000}*\
*\],*\
*\"note\":\"Client asked for 10 more edits\"*\
*}*\

**Rules:** caps per extra kind; totals are **server‑computed**;
acceptance adds **adjustment** line items and either charges now or
settles at payout (see §1.3).

### **3) Proofs / Approvals (*****type=\"proofs\"*****)**

*{*\
*\"gallery\":\[*\
*{\"thumb\":\"s3://\.../t1.webp\",\"web\":\"s3://\.../p1.webp\",\"count\":12}*\
*\],*\
*\"watermarked\": true,*\
*\"expiresAt\": \"2025-11-30T00:00:00Z\",*\
*\"allowSelections\": true*\
*}*\

**Rules:** buyer can **Approve** (optionally per‑selection) or
**RequestChanges** w/ notes; approval completes a milestone when bound
to deliverables.

NonTechBlueprint

### **4) Expense / Receipt (*****type=\"expense\"*****)**

*{*\
*\"amountCents\": 8900,*\
*\"currency\":\"usd\",*\
*\"merchant\":\"Prop House\",*\
*\"date\":\"2025-11-04\",*\
*\"receiptImage\":\"s3://\.../receipt.jpg\",*\
*\"buyerPayable\": true*\
*}*\

**Rules:** acceptance adds to payable ledger (payout or new charge);
fraud checks apply (image present, amount thresholds).

NonTechBlueprint

### **5) Mark Complete / Deliver (*****type=\"complete\"*****)**

*{*\
*\"kind\": \"time_based\|milestone\",*\
*\"milestoneId\": \"ms_xxx\",*\
*\"notes\":\"Session completed; uploading previews\",*\
*\"attachments\":\[{\"s3Key\":\"s3://\.../call-sheet.pdf\"}\]*\
*}*\

**Rules:** triggers the buyer **review window**; on lapse, auto‑releases
payout (see §1.3).

NonTechBlueprint

### **6) Dispute (*****type=\"dispute\"*****)**

*{*\
*\"reason\":\"Quality\",*\
*\"details\":\"Missed critical shots\",*\
*\"evidence\":\[{\"s3Key\":\"s3://\.../evidence1.jpg\"}\]*\
*}*\

**Rules:** opens **dispute case**; pauses payout; threads show dispute
banner until resolution (Admin).

NonTechBlueprint

### **7) Safety Flag (*****type=\"safety\"*****)**

*{*\
*\"reason\":\"Off-platform payment request\",*\
*\"notes\":\"They asked for Zelle\",*\
*\"severity\":\"low\|medium\|high\"*\
*}*\

**Rules:** soft‑blocks messaging between parties pending T&S review;
Admin receives **case‑bound** access.

NonTechBlueprint

## **1.4.B Inbox search syntax & Typesense mapping**

**Query syntax (user‑facing):**

- Free‑text across sender names, message body, and **card titles**.
- Filters: *from:@handle*, *to:@handle*,
  *role:model\|photographer\|videographer\|creator*,
  *type:booking\|inquiry\|invite\|support*, *has:file\|image\|card*,
  *card:reschedule\|extras\|proofs\|expense\|complete\|dispute\|safety*,
  *date:2025-11*, *city:\"Los Angeles\"*.

NonTechBlueprint

**Typesense collection** ***inbox_index*** **(flattened per message)**:

*{*\
*\"name\": \"inbox_index\",*\
*\"fields\": \[*\
*{\"name\":\"userId\",\"type\":\"string\"},*\
*{\"name\":\"threadId\",\"type\":\"string\"},*\
*{\"name\":\"kind