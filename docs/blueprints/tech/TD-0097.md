<!-- id: TD-0097 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 349200-353200 -->

nviteId: ID!, programId: ID!, inviterUserId:
ID!, acceptedAt: AWSDateTime }*\
*type CreditLedger { entryId: ID!, userId: ID!, kind: String!,
amountCents: Int!, reason: String!, createdAt: AWSDateTime! }*\
\
*input SavedSearchInput { scope: String!, city: String!, queryJson:
AWSJSON! }*\
\
*type Query {*\
*mySavedSearches: \[SavedSearch!\]!*\
*myFeed(cursor: String, limit: Int = 25, tab: String): FeedPage!*\
*myCredits: \[CreditLedger!\]!*\
*}*\
\
*type Mutation {*\
*createSavedSearch(input: SavedSearchInput!): SavedSearch!*\
*pauseSavedSearch(searchId: ID!, days: Int!): SavedSearch!*\
*deleteSavedSearch(searchId: ID!): Boolean!*\
\
*follow(targetId: ID!, targetKind: String!): Boolean!*\
*unfollow(targetId: ID!, targetKind: String!): Boolean!*\
\
*sendReferral(programId: ID!, inviteeEmail: String!): Boolean!*\
*redeemCredit(entryId: ID!, amountCents: Int!): Boolean!*\
*}*\

## **1.16‑D. EventBridge schedules (cron) --- Alerts/Digests/Book‑Again**

**Recommended filename/path:** *infra/schedules/growth-schedules.yml*

*\# growth-schedules.yml (declarative intent; implemented via
CDK/Amplify Gen 2)*\
*schedules:*\
* - name: saved-search-alerts-daily*\
*cron: \"cron(5 13 \* \* ? \*)\" \# 13:05 UTC daily*\
*targetLambda: growthSavedSearchAlerts*\
* - name: weekly-city-digest*\
*cron: \"cron(15 14 ? \* MON \*)\" \# Mondays 14:15 UTC*\
*targetLambda: growthWeeklyDigest*\
* - name: book-again-7d*\
*cron: \"cron(0 12 \* \* ? \*)\"*\
*targetLambda: growthBookAgain7*\
* - name: book-again-30d*\
*cron: \"cron(5 12 \* \* ? \*)\"*\
*targetLambda: growthBookAgain30*\
* - name: book-again-90d*\
*cron: \"cron(10 12 \* \* ? \*)\"*\
*targetLambda: growthBookAgain90*\

## **1.16‑E. Lambda handler skeleton --- Saved Search Alerts**

**Recommended filename/path:**
*apps/functions/growthSavedSearchAlerts.ts*

*// growthSavedSearchAlerts.ts*\
*// Pseudocode: load eligible searches, query index, dedupe (Dynamo),
send in-app + email via SES.*\
\
*import { queryPeople, queryStudios } from \'../lib/search\';*\
*import { getEligibleSavedSearches, markAlertSent } from
\'../lib/savedSearchRepo\';*\
*import { dynamoDedupeHit } from \'../lib/dedupe\';*\
*import { sendEmail } from \'../lib/ses\';*\
*import { createInAppDigest } from \'../lib/inapp\';*\
\
*export const handler = async () =\> {*\
*const searches = await getEligibleSavedSearches();*\
*for (const s of searches) {*\
*const alreadySent = await dynamoDedupeHit(s.searchId);*\
*if (alreadySent) continue;*\
\
*const matches = s.scope === \'people\'*\
*? await queryPeople(s.query_json, s.city)*\
*: await queryStudios(s.query_json, s.city);*\
\
*if (matches.length === 0) continue;*\
\
*await createInAppDigest(s.user_id, s.search_id, matches.slice(0,
20));*\
*await sendEmail({*\
*toUserId: s.user_id,*\
*template: \'saved_search_alert\',*\
*vars: { city: s.city, count: matches.length, cards: matches.slice(0,
20) }*\
*});*\
\
*await markAlertSent(s.search_id, matches.length);*\
*}*\
*};*\

## **1.16‑F. MJML template --- Saved Search Alert (SFW‑only)**

**Recommended filename/path:** *comms/templates/saved_search_alert.mjml*

*\<mjml\>*\
*\<mj-head\>*\
*\<mj-title\>New matches in {{city}}\</mj-title\>*\
*\<mj-attributes\>*\
*\<mj-text font-size=\"14px\" line-height=\"20px\" /\>*\
*\</mj-attributes\>*\
*\</mj-head\>*\
*\<mj-body\>*\
*\<mj-section\>*\
*\<mj-column\>*\
*\<mj-text font-size=\"18px\"\>\<strong\>{{count}}\</strong\> new
match{{#plural count}}es{{/plural}} in {{city}}\</mj-text\>*\
*\<mj-text\>We've found new profiles that match your saved search.
Previews are SFW.\</mj-text\>*\
*\</mj-column\>*\
*\</mj-section\>*\
\
*{{#each cards}}*\
*\<mj-section\>*\
*\<mj-column\>*\
*\<mj-image src=\"{{this.previewUrl}}\" alt=\"{{this.title}} --- SFW
preview\" /\>*\
*\<mj-text\>\<strong\>{{this.title}}\</strong\>\<br/\>{{this.subtitle}}\</mj-text\>*\
*\<mj-button href=\"{{this.deepLink}}\"\>View profile\</mj-button\>*\
*\</mj-column\>*\
*\</mj-section\>*\
*{{/each}}*\
\
*\<mj-section\>*\
*\<mj-column\>*\
*\<mj-t