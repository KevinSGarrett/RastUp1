<!-- id: TD-0221 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 795600-799600 -->

d \< start,
  fire Quiet‑Hour exception.

### **C) Proofs (approvals)**

- **Create (provider):** submit *galleryId* (watermarked) from **Media
  §1.11**; optional note.
- **Respond (buyer):** approve list of asset IDs or request changes with
  per‑asset notes; multiple rounds allowed until *expires_at*.
- **Close:** when all assets approved or provider marks "final"
  (configurable).
- **Deliverables:** once approved → **Deliverables** bundle created
  (§1.11) with non‑watermarked assets and license metadata.

### **D) Expense (at cost)**

- **Create (provider):** submit items *{label, amountCents}*,
  *receipts\[\]* (media asset IDs).
- **Respond (buyer):** approve (charge or add to settlement) or decline
  with reason.
- **Money:** approved expenses → charge immediately or add to final
  capture; receipts retained for disputes.

### **E) Complete**

- **Create (either side):** request completion confirmation; can attach
  check‑in/out notes/time.
- **Respond:** counterpart approves → *in_progress→completed*, trigger
  review window; if decline, card returns to open with reason.

### **F) Dispute**

- **Create (either side):** opens the dispute track; structured
  **reason**, attachments; timeline marked; payments/dispute pipeline
  (§1.13) invoked.
- **Close:** when Stripe dispute closes; mirrors status on order;
  publication hold on reviews is lifted (§1.9).

**Mutual‑exclusion rules**

- Only **one** open Reschedule at a time.
- Extras/Expense/Proofs can run **concurrently**; Complete cannot close
  while Reschedule open.
- Dispute can open in parallel but **freezes** Complete and new Extras.

## **1.14.7 Concurrency, locking & idempotency**

- **Order‑level version** row: increment on every state change or
  accepted card; optimistic concurrency checks in resolvers.
- **Idempotency keys** per card creation/respond:
  *order:{orderId}:card:{type}:nonce* in Dynamo with TTL.
- **Cal/Pay** side effects are **transactional**: if any downstream call
  fails, revert card state and timeline append with error.

## **1.14.8 Timeline rendering & notifications**

- **TimelineEvent** entries for: card created/responded/closed, order
  state transitions, payment captures/refunds, calendar changes.
- **In‑App**: dedicated "Open Actions" strip; badges for due/expiring.
- **Email/Push**: *card.requested.\**, *card.expiring.6h*,
  *card.closed.\**.
- **Quiet Hours**: optional cards are delayed; **critical** cards
  (reschedule near start, payment failure) bypass Quiet Hours per §1.10.

## **1.14.9 Security, privacy & policy**

- **Role‑based**: only buyer/provider (and admin) can see order timeline
  and cards.
- **NSFW**: proof thumbnails follow **Safe‑Mode**; emails/push never
  include NSFW previews.
- **Redaction**: admin can hide PII/abuse in notes; redaction leaves an
  immutable stub in timeline.
- **DMCA**: proofs/deliverables flagged under takedown hold are hidden
  until adjudication.

## **1.14.10 Observability, KPIs & SLOs**

- **Events**: *card.created\|responded\|expired\|closed*,
  *order.transition*, *reschedule.accepted*, *extras.accepted*,
  *expense.approved*, *complete.approved*.
- **KPIs**: median **time‑to‑accept** reschedules, extras acceptance
  rate, expense approval rate, % orders completed on first pass,
  stuck‑card rate (\>48h), cancellations within lead time.
- **SLOs**: 99% of card create/respond operations complete \< 1.5s p95;
  stuck‑card alarm triggers at 24h inactivity when due.

## **1.14.11 Work packages (Cursor --- 4 agents)**

- **Agent A --- Order Core**: DDL, order state machine, timeline
  appenders, versioned locking, GraphQL resolvers.
- **Agent B --- Cards Engine**: per‑type validators, lifecycle
  orchestrations, concurrency/exclusion rules, idempotency.
- **Agent C --- Integrations**: Calendar holds/confirm; Payments
  captures/refunds; Media proofs/deliverables; Notifications.
- **Agent D --- UI/UX**: Order page & timeline, Cards modals/forms,
  "Open Actions" strip, admin viewer.

Each wi