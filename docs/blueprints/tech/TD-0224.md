<!-- id: TD-0224 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 806400-810400 -->

 text not null, \-- normalized code*\
*status sup.refund_status not null default \'proposed\',*\
*processor_ref text, \-- stripe re\_\...*\
*created_by text not null, \-- admin id*\
*created_at timestamptz default now(),*\
*updated_at timestamptz default now()*\
*);*\
\
*\-- Payout holds*\
*create type sup.hold_status as enum
(\'applied\',\'released\',\'expired\');*\
*create table sup.payout_hold (*\
*hold_id text primary key, \-- sph\_\...*\
*case_id text not null references sup.case(case_id) on delete cascade,*\
*order_id text not null,*\
*provider_id text not null,*\
*amount_cents int not null,*\
*reason text not null,*\
*status sup.hold_status not null default \'applied\',*\
*created_at timestamptz default now(),*\
*released_at timestamptz*\
*);*\
\
*\-- Admin audit (immutable source of truth alongside S3 WORM stream)*\
*create table sup.admin_audit (*\
*audit_id text primary key, \-- aud\_\...*\
*actor_admin text not null,*\
*action text not null, \--
\'refund.issue\',\'hold.apply\',\'case.assign\',\'dmca.hide\',\'chargeback.submit\',
etc.*\
*resource text not null, \-- \'case:sca\_\...\',\'order:ord\_\...\'*\
*details jsonb not null default \'{}\',*\
*ip inet,*\
*user_agent text,*\
*created_at timestamptz default now()*\
*);*\
\
*commit;*\

## **1.15.4 GraphQL API (AppSync) --- paste-ready schema**

Create *api/schema/support_center.graphql*:

*enum CaseKind { BOOKING PAYMENT PRODUCT DMCA POLICY CHARGEBACK }*\
*enum CaseStatus { NEW TRIAGE INVESTIGATING AWAITING_USER
DECISION_PENDING RESOLVED CLOSED }*\
\
*type CaseEvent { id: ID!, actorKind: String!, actorId: ID, type:
String!, payload: AWSJSON!, createdAt: AWSDateTime! }*\
*type Case {*\
*id: ID!, kind: CaseKind!, status: CaseStatus!, priority: Int!,*\
*openedBy: ID!, ownerAdmin: ID, subjectUser: ID, orderId: ID, threadId:
ID, studioId: ID,*\
*summary: String!, slaFirstAt: AWSDateTime, slaDueAt: AWSDateTime,*\
*timeline(page: Int = 1): \[CaseEvent!\]!*\
*}*\
\
*input OpenCaseInput {*\
*kind: CaseKind!, priority: Int, subjectUser: ID, orderId: ID, threadId:
ID, studioId: ID, summary: String!*\
*}*\
*input AddNoteInput { caseId: ID!, note: String! }*\
*input RefundInput { caseId: ID!, orderId: ID!, amountCents: Int!,
reason: String! }*\
*input HoldInput { caseId: ID!, orderId: ID!, providerId: ID!,
amountCents: Int!, reason: String! }*\
*input AssignInput { caseId: ID!, ownerAdmin: ID! }*\
*input SetStatusInput { caseId: ID!, status: CaseStatus!, reason: String
}*\
\
*type Query {*\
*adminCase(caseId: ID!): Case! \@auth(role: \"trust_safety\")*\
*adminCases(kind: CaseKind, status: CaseStatus, page: Int = 1):
\[Case!\]! \@auth(role: \"trust_safety\")*\
*}*\
\
*type Mutation {*\
*openCase(input: OpenCaseInput!): ID! \@auth(role: \"trust_safety\")*\
*addCaseNote(input: AddNoteInput!): Boolean! \@auth(role:
\"trust_safety\")*\
*assignCase(input: AssignInput!): Boolean! \@auth(role:
\"trust_safety\")*\
*setCaseStatus(input: SetStatusInput!): Boolean! \@auth(role:
\"trust_safety\")*\
*issueRefund(input: RefundInput!): ID! \@auth(role: \"finance_ops\")*\
*applyPayoutHold(input: HoldInput!): ID! \@auth(role: \"finance_ops\")*\
*releasePayoutHold(holdId: ID!): Boolean! \@auth(role:
\"finance_ops\")*\
*}*\

**Auth & privacy**: Admin access only via SSO + role claims; views are
**case-bound**. All actions write to *sup.admin_audit* and S3 WORM
stream.

## **1.15.5 Policy kernels (deterministic refunds)**

- **Time-band kernel** (talent):

  - ≥72h → full refund minus platform fee (configurable)
  - 24--72h → 50% refund of subtotal; platform fee refundable by default
  - \<24h → 0% refund unless rebooked

- **Studio kernel** (space): depends on **min hours**, **buffers**, and
  whether **deposit** exists; see §1.24 rules.

- **Deliverable kernel** (milestone jobs): if delivered and approved,
  refund only by goodwill or dispute resolution.

**Implementation**: pricing service computes *eligible_refund_cents*
from **policy snapshot** on the order; Support UI shows both
**automatic** 