<!-- id: TD-0007 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 25200-29200 -->

 write
  unit tests.

**Agent A --- API/BFF**

- WP‑API‑SRCH‑01: Implement GraphQL *search*, *searchSuggest*,
  *saveSearch* with auth & rate limits; error model and correlation ids.
- WP‑API‑SRCH‑02: Result caching (SWR) + per‑user cursor cache.

**Agent B --- Web**

- WP‑WEB‑SRCH‑01: Search UI (role tabs, chips, facets, sort); result
  cards; disclosure for paid slots.
- WP‑WEB‑SRCH‑02: Saved searches & alerts (optional flag).

**Agent D --- Admin & QA**

- WP‑ADM‑SRCH‑01: Console pages (reindex, synonyms, density caps,
  invalid‑clicks).
- WP‑QA‑SRCH‑01: E2E tests for correctness, fairness, promotions, and
  SLOs; synthetic dataset & golden files.

## **1.2.S Acceptance criteria (mark §1.2 FINAL only when ALL are true)**

152. **Correctness**: Role‑true discovery and studio separation
     verified; safe‑mode & age‑gate enforced; city gate honored.
153. **Filters**: All global and role‑specific filters work; social
     metrics shown only when verified.
154. **Ranking**: Diversity caps & new‑seller floor active; verify
     boosts and price fit working.
155. **Promotions** (if flag on): featured/boost slots respect density
     caps; no filter bypass; invalid clicks removed from billing.
156. **Performance**: p95 within SLO; cache hit rate ≥60% under
     synthetic load.
157. **Resilience**: Indexer DLQ empty after backfill; backfill parity
     within ±1% of DB records.
158. **Telemetry**: Events emitted; dashboards show CTR, filter usage,
     fairness metrics, index lag.
159. **Cost**: Engine within budget; cache prevents \>40% of engine
     calls; alarms quiet for 48h.

# 

# 

# **§1.3 --- Booking & Checkout (Linked Booking Group, Escrow, Deposits, Docs‑Before‑Pay, Tax, Refunds, Disputes)**

**Purpose.** Specify the end‑to‑end technical design and guarantees for
creating, validating, paying for, amending, and settling bookings---both
single‑leg and **Linked Booking Groups (LBG)** where a *Talent leg* and
a *Studio leg* are confirmed together but keep independent policies,
receipts, and payouts. This section includes domain models, state
machines, APIs, ledgers, taxes, deposits, refunds, disputes,
attach‑in‑flow studios, admin tools, telemetry, SLOs, and a full test
plan. We will stay in §1.3 until it is complete to your 99.9% bar.

## **1.3.A Canon & invariants**

- **Two distinct ledgers:** Talent leg and Studio leg are independent
  commercial contracts (prices, taxes, refunds, payouts, disputes).
  **LBG** is a *container* that synchronizes timing and UX but **never**
  merges their policies or reviews.
- **Docs‑before‑pay:** Required packs (SOW, Model Releases, Studio House
  Rules) must be assembled and signed **before** any charge is
  authorized or captured.
- **Escrow‑like handling:** Buyer is charged at confirmation; payouts
  are **withheld** until completion or acceptance window close (escrow
  mimic), with deposits handled separately for Studios.
- **Atomicity:** LBG confirmation succeeds **only if both legs validate
  and fund**; otherwise nothing commits.
- **Money correctness:** Sum of lines = totals; taxes computed per leg;
  cents (integer); idempotency on all external I/O.
- **Attach‑in‑flow Studio:** During Talent checkout, the buyer can add a
  Studio leg that matches time/location rules; both legs confirm
  together if valid.

## **1.3.B Domain model (Aurora PostgreSQL, source of record)**

Money in cents; timestamps UTC.

*\-- Linked Booking Group (container)create table lbg ( lbg_id text
primary key, \-- lbg\_\... buyer_user_id text not null, \-- usr\_\...
status text not null check (status in
(\'draft\',\'awaiting_docs\',\'awaiting_payment\',\'confirmed\',\'in_progress\',\'completed\',\'cancelled\',\'failed\')),
city text not null, start_at timestamptz not null, \-- group reference
window end_at timestamptz not null, acceptance_until timestamptz, \--
buyer acceptance window end currency text not null default \'USD\',
created_at timestamptz not null default now(), updated_at timestamptz
not null