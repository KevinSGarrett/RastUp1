<!-- id: TD-0022 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 79200-83200 -->

ne**: presence entries updated on ping; absences \> TTL means
  offline.

## **1.4.G Moderation, safety, anticircumvention**

- **Text filters**: regex + ML models for PII/banlist (emails, phone,
  Venmo/CashApp handles).

  - First hit → **nudge** (educational banner).
  - Repeat → **soft block** sending with "Use on‑platform checkout."
  - Abuse → escalation to T&S; rate‑limits or temp mutes per thread.

- **NSFW**: all previews scanned; respect Safe‑Mode (blur/blocked).

- **Report/Block**: per thread; blocks hide typing & DMs, and notify
  Support.

- **Audit**: every moderation action writes immutable admin audit with
  reason.

## **1.4.H Notifications (email, push, SMS)**

- **Triggers**: new message (not self), action card state change,
  deliverable posted, doc sign needed, acceptance window nearing end.
- **Quiet hours**: user‑settable; we queue non‑urgent notifications and
  send digest.
- **Templates**: centralized in Comms adapter; no sensitive content in
  SMS; deeplinks to thread/role context.
- **Backpressure**: dedupe within a 2--5 minute window; collapse
  multiple messages into a single notification.

## **1.4.I File pipeline & limits**

- **Uploads**: signed S3 URLs; client streams **previews** only; large
  files rejected; user pointed to "attach external link."
- **Scanning**: Lambda antivirus + vision safety; quarantine bucket for
  suspects; admin override with audit.
- **Preview transforms**: Lambda@Edge resizes images on demand; video
  previews transcoded to HLS snippets with caps.
- **Limits (launch)**: preview ≤ 20 MB; images ≤ 12k px max dimension;
  videos ≤ 60s preview.

## **1.4.J Admin consoles (Support, T&S, Finance)**

- **Support**: view thread & panel, impersonate read‑only, run policy
  simulator, send system notices, approve/deny reschedules (if needed),
  manage refunds (hooks §1.3).
- **T&S**: moderation queue, content decisions, anticircumvention
  violations, mutes/blocks, audit exports.
- **Finance**: expenses rollups vs receipts; deposit claims queue; links
  to payouts/reserves pages.

All admin acts require reason and generate immutable audits; sensitive
actions require **two‑person approval**.

## **1.4.K Observability, telemetry, and lineage**

**Events (immutable):**\
*thread.create*, *thread.promoted_to_project*,\
*message.send*, *message.asset.attach*, *message.blocked*,\
*presence.typing_on/off*, *presence.online/offline*,\
*panel.brief.update*, *panel.moodboard.pin*, *panel.shotlist.update*,
*panel.files.add*,\
*action.create*, *action.state_change*,\
*deliverable.proof.posted*, *deliverable.final.posted*,
*deliverable.approved*,\
*cancel.requested*, *refund.requested*,\
*deposit.claim.opened\|approved\|denied*,\
*dispute.opened*,\
*notification.sent*,\
*admin.moderation.\**.

**Lineage:** for every action that touches money/docs/booking, emit
correlating IDs (*leg_id*, *lbg_id*, *doc_id*, *amendment_id*) so
evidence kits can be assembled reliably (§1.3.U).

## **1.4.L Performance & cost**

- **DynamoDB**: write patterns append‑only; 1KB--8KB avg items;
  *MSG#ts#id* packs a capped body length (server truncates oversize with
  link to file). TTL on ephemeral presence rows.
- **AppSync**: subscriptions filtered by *threadId*; pagination uses
  forward cursors; cache last N cursors per user for back/forward UX.
- **S3/CF**: thumbnails & short previews only; lifecycle to
  Intelligent‑Tiering after 30 days; egress minimized.
- **Compute**: Lambdas on demand; webhook processors for action
  side‑effects; no always‑on servers.

## **1.4.M Error taxonomy (client‑safe)**

- *MSG_POLICY_BLOCKED* --- text violates anticircumvention policy.
- *MSG_NSFW_BLOCKED* --- preview blocked under Safe‑Mode.
- *THREAD_NOT_MEMBER* --- user not participant.
- *THREAD_LOCKED* --- admin lock.
- *ACTION_INVALID_STATE* --- e.g., approve deliverable already closed.
- *ACTION_CONFLICT* --- reschedule overlaps; check §1.3 validation.
- *PANEL_VERSION_CONFLICT* --- optimistic concurrency failed.
- *UPLO