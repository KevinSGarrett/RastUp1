<!-- id: TD-0116 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 417600-421600 -->

id\":\"AllowOACOnly\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"cloudfront.amazonaws.com\"},\"Action\":\"s3:GetObject\",\"Resource\":\"arn:aws:s3:::cdn.rastup.com/\*\",\"Condition\":{\"StringEquals\":{\"AWS:SourceArn\":\"arn:aws:cloudfront::\<acct\>:distribution/\<id\>\"}}}*\
*\]*\
*}*\

Use **CloudFront Origin Access Control (OAC)**; disable **Public
Access** and ACLs; use **Object Ownership = Bucket owner enforced**.

## **1.18.G Pre‑Signed Uploads (size/type guard)**

**Recommended path:** *security/s3/presign.ts*

*export function presignPreviewUpload({ userId, mime, bytes }) {*\
*if (!/\^image\\/(jpe?g\|png\|webp)\$/.test(mime)) throw new
Error(\'UNSUPPORTED_TYPE\');*\
*if (bytes \> 10 \* 1024 \* 1024) throw new Error(\'FILE_TOO_LARGE\');*\
*// key scoped to user prefix, random suffix*\
*const key =
\`previews/\${userId}/\${Date.now()}\_\${Math.random().toString(36).slice(2)}.webp\`;*\
*return s3.getSignedUrl(\'putObject\', { Bucket: \'fansub-previews\',
Key: key, ContentType: mime, Expires: 300 });*\
*}*\

## **1.18.H Break‑Glass & JIT Admin Access**

**Recommended path:** *security/admin/break-glass.md*

*- No standing Admin in prod. Use Identity Center JIT with 1-hour
session TTL.*\
*- Break-glass triggers:*\
*\* Widespread outage, data corruption, compromised credentials.*\
*- Procedure:*\
* 1) PagerDuty page; open IR ticket.*\
*2) Two-person approval; one requests JIT role; one approves.*\
*3) All actions in console shell are screen-recorded; correlation ID
must be attached to commands.*\
*4) Revoke access at TTL; post-mortem includes access diff from
CloudTrail.*\

## **1.18.I Secrets Rotation Runbook (Stripe, SES, KMS)**

**Recommended path:** *security/secrets/rotation-runbook.md*

*Cadence*\
*- Stripe API/Webhook: 90 days*\
*- SES SMTP creds: 180 days*\
*- KMS key rotation: yearly (auto)*\
\
*Steps (Stripe)*\
*1) Create new restricted key (write: charges, read: events).*\
*2) Deploy to stage via Secrets Manager (/stage/stripe/secret_key).*\
*3) Run stage smoke tests (webhooks).*\
*4) In prod, add new key alongside old; rotate webhooks secret.*\
*5) Flip AppSync/Lambdas to new secret; verify live.*\
*6) Disable old key; update runbook timestamps.*\
\
*Verification*\
*- CloudWatch alarm if Stripe auth errors \> 0.1% after rotation.*\

## **1.18.J Vendor Risk Management**

**Recommended path:** *security/vendors/register.md*

*- Stripe (Processor): DPA, SOC1/2 bridge, data location (US), breach
SLA in vendor contract.*\
*- IDV provider: ID docs storage duration & encryption; data deletion
API tested quarterly.*\
*- E-sign: signature evidence retention; tamper-evident hashes.*\
*- Email (SES): region & sending limits; bounce/complaint handling
verified.*\
*- CDN/DNS: CloudFront/Route53; no third-party DNS at launch.*\
*- Annually review DPAs and security reports; track in vendor register
with risk scores.*\

## **1.18.K Pen‑Test Scope & Safe Harbor**

**Recommended path:** *security/testing/pentest-scope.md*

*- In-scope: public web, AppSync API, mobile clients, preview upload
endpoints.*\
*- Out-of-scope: providers (Stripe, IDV), employee-only VPN resources.*\
*- Constraints: no volumetric DoS, no social engineering.*\
*- Data: use synthetic accounts in stage; limited prod tests under
supervision.*\
*- Safe harbor: good-faith testing protected; report via security@ with
proof-of-concept only.*\

## **1.18.L OWASP ASVS Mapping (excerpt)**

**Recommended path:** *security/standards/asvs-mapping.md*

*- V1 Architecture: Zero-trust, least privilege (covered §1.18.B/C)*\
*- V2 Auth: Cognito/OIDC with MFA for admin; session cookie flags
(§1.18.D)*\
*- V4 Access Control: AppSync \@auth + resolver checks (tests in
§1.18.N)*\
*- V5 Validation: JSON Schemas, event validation (see §1.13)*\
*- V9 Data Protection: TLS/HSTS/KMS; PII minimization (this section)*\
*- V14 Config: CSP, headers, secrets management (this section)*\

## **1.18.M DR Drill & Severity Matrix**

**Recommended path:** *security/ir/severity-matrix.md*