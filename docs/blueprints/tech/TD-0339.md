<!-- id: TD-0339 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1220400-1224400 -->

 uses: actions/checkout@v4*\
* - run: pip install schemathesis*\
* - run: schemathesis run openapi/v1.yaml \--checks all*\

## **Q.12 Communication plan (per change)**

5740. Update **CHANGELOG.md** + **versions.json**.
5741. Create **migration guide** if required.
5742. Email **API contacts**; in‑product banner for integrators.
5743. Add **Deprecation/Sunset** headers for affected endpoints for the
      duration.
5744. Track adoption via request sampling and webhook destination
      versions.

## **Q.13 Acceptance (Appendix Q = FINAL)**

- REST **v1** path versioning live; OpenAPI published; CDN caching
  configured.
- GraphQL deprecation policy implemented; **no PR can merge with
  breaking changes** without *major* label and plan.
- Webhook envelope includes **version**; per‑destination version
  preferences persisted; replay/test delivery available.
- CI **contract tests** pass (GraphQL Inspector + Schemathesis);
  persisted operations validated.
- **Changelog/migration** templates exist and are used;
  **Deprecation/Sunset** headers emitted during windows.
- **versions.json** served publicly for automation.

# **Appendix R --- Rate Limits & Quotas (deep version: headers + gateway config + code)**

**Purpose.** Prevent abuse, protect availability, and keep costs
predictable without harming legitimate traffic. This appendix defines
**limits by surface**, **algorithms**, **headers**, **gateway/WAF
config**, **AppSync/REST enforcement**, **observability**, and
**tests**. It aligns with Appendix **U** (abuse automation), **Q** (API
versioning), **J** (API errors), **AC** (FinOps), and §1.24 (Security &
Privacy).

## **R.0 Design principles**

5751. **Layered limits**: **Edge → Gateway → App** (the closer to the
      user, the cheaper).
5752. **Keying**: choose the **fairest key** for each surface (IP / user
      / dyad / OAuth client).
5753. **Burst then steady**: allow short spikes with a token bucket;
      enforce sustained ceilings.
5754. **Transparent**: always return **rate‑limit headers** so clients
      can back off gracefully.
5755. **Deterministic**: same rule in code and in docs, tracked in repo
      and RTM.

## **R.1 Limits matrix (MVP defaults)**

Numbers below are conservative for launch and can be tuned via config.
"Burst / Rate / Window".

  -------------------------------------------------------------------- ------------------------------ --------------------------------------------------------------------
  **Surface**                                                          **Key**                        **Limit**
  **Public Search (unauth)** *GET /v1/people, /v1/studios, /v1/work*   IP (/24 for NATs)              **120 / 60 rpm / 60s** (WAF, then app)
  **Suggestions / Autocomplete** *GET /v1/suggest*                     IP                             **60 / 30 rpm / 60s** (stricter)
  **GraphQL search** *searchPeople/Studios/Work*                       userId                         **80 / 40 rpm / 60s**
  **Signup**                                                           IP + email                     **10 / 5 rpm / 60s** AND **12 per hour/IP**
  **Login**                                                            IP and identity                **20 / 10 rpm / 60s** AND **5/min per identity**
  **Password reset**                                                   email                          **3 per hour**
  **Messaging -- send**                                                **dyadId** (userA↔userB)       **40 / 20 rpm / 60s** AND **120/day per user**
  **Upload init/complete**                                             userId                         **20 / 10 rpm / 60s**
  **Checkout create/confirm**                                          userId                         **20 / 10 rpm / 60s** AND **100/day**
  **Partner REST** */v1/\**                                            **clientId (API key/OAuth)**   **1200 / 600 rpm / 60s** (tiered plans)
  **Webhooks (inbound)** Stripe, etc.        