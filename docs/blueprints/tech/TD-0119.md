<!-- id: TD-0119 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 428400-432400 -->

Mode.disclaimer\": \"Public previews are SFW. Some content
requires Safe-Mode OFF and age verification.\"*\
*}*\

**Other locales** (create *es-ES.json*, *fr-FR.json*, *ar.json*, etc.)
with identical keys; avoid string concatenation---always parametrize.

**Loader (server & client)**\
**Recommended path:** *i18n/loader.ts*

*export async function loadLocaleCatalog(lang: string) {*\
*const url = \`https://cdn.rastup.com/i18n/\${lang}.json\`;*\
*const res = await fetch(url, { cache: \"force-cache\" });*\
*if (!res.ok) throw new Error(\"CATALOG_MISSING\");*\
*return res.json();*\
*}*\

**Extraction config**\
**Recommended path:** *i18n/extract.config.json*

*{*\
*\"src\": \[\"web/\*\*/\*.{ts,tsx}\",\"apps/\*\*/\*.{ts,tsx}\"\],*\
*\"funcs\": \[\"t\",\"fmt.t\",\"i18n.t\"\],*\
*\"output\": \"i18n/messages.pot\"*\
*}*\

## **1.19.4 Locale detection & routing (no auto‑redirect loop)**

**Middleware (concept)**\
**Recommended path:** *web/middleware.locale.ts*

*import { NextRequest, NextResponse } from \"next/server\";*\
*import Negotiator from \"negotiator\";*\
*const SUPPORTED = \[\"en-US\",\"es-ES\",\"fr-FR\",\"ar\",\"de-DE\"\];*\
\
*export function middleware(req: NextRequest) {*\
*const res = NextResponse.next();*\
*// Honor explicit choice in cookie first*\
*const chosen = req.cookies.get(\"locale\")?.value;*\
*const lang = chosen \|\| new Negotiator({ headers: {
\"accept-language\": req.headers.get(\"accept-language\") \|\| \"\" }
}).language(SUPPORTED) \|\| \"en-US\";*\
*res.headers.set(\"x-lang\", lang);*\
*res.headers.set(\"x-dir\", lang.startsWith(\"ar\") ? \"rtl\" :
\"ltr\");*\
*return res;*\
*}*\

**UX:** always offer a visible language switcher; **do not** force
redirects based on IP.

## **1.19.5 Numbers, currency, dates & time zones**

**Utility**\
**Recommended path:** *i18n/format.ts*

*export function money(amountCents: number, currency: string, locale:
string) {*\
*return new Intl.NumberFormat(locale, { style: \"currency\", currency
}).format(amountCents / 100);*\
*}*\
*export function dateFmt(dtISO: string, locale: string, tz: string) {*\
*return new Intl.DateTimeFormat(locale, { dateStyle: \"medium\",
timeStyle: \"short\", timeZone: tz }).format(new Date(dtISO));*\
*}*\

**Rules:**

- Always format **server‑side** for SEO pages.
- Respect *prefers_24h* and *timezone*.
- For booking availability, display both **provider local time** and
  **viewer time** when they differ.

## **1.19.6 RTL support & logical CSS**

**Base CSS logical props**\
**Recommended path:** *web/styles/rtl.css*

*html\[dir=\"rtl\"\] { direction: rtl; }*\
*.card { padding-inline: 16px; margin-inline: 8px; }*\
*.icon-chevron { transform: scaleX(var(\--dir-mult, 1)); }*\
*html\[dir=\"rtl\"\] .icon-chevron { \--dir-mult: -1; }*\

**Mirroring images/icons:** use bidirectional icons or auto‑mirrored
SVG; avoid text baked into images.

## **1.19.7 Accessible components (WCAG 2.2 AA)**

**Skip link & landmarks**\
**Recommended path:** *web/components/SkipLink.tsx*

*export const SkipLink = () =\> (*\
*\<a href=\"#main\" className=\"sr-only focus:not-sr-only focus:fixed
focus:top-2 focus:left-2 bg-yellow-300 p-2 rounded\"\>*\
*{t(\"a11y.skip\")}*\
*\</a\>*\
*);*\

**Accessible modal (focus trap, aria)**\
**Recommended path:** *web/components/Modal.tsx*

*export function Modal({ open, titleId, children, onClose }) {*\
*// trap focus, ESC to close, role=\"dialog\" aria-modal=\"true\"
aria-labelledby={titleId}*\
*/\* \...focus management code\... \*/*\
*}*\

**Combobox (search) ARIA**\
**Recommended path:** *web/components/Combobox.tsx*

*/\* role=\"combobox\" aria-expanded aria-controls listbox; options
role=\"option\"; keyboard arrows, Enter, Esc; announces via aria-live
\*/*\

**Color/contrast:** enforce ≥ 4.5:1; expose *high_contrast* toggle that
upgrades token set.

**Reduced motion:** respect *prefers-reduced-motion* and user pref;
disable parallax/animated transitions.

## **1.19.8 Form localization & validation**

- **Names:** do not force first/