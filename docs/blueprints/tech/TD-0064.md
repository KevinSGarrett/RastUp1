<!-- id: TD-0064 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 230400-234400 -->

 JSON; correlation ids from edge → backend; PII
  scrubbers.
- **Tracing**: X‑Ray/OpenTelemetry from AppSync → Lambda → DB.
- **Dashboards/Alerts**: SLO burn alerts, 5xx spikes, RDS ACU thrash,
  Dynamo throttles, WAF blocks, SES bounce/complaint spikes.

## **1.12.K Security posture**

- **Least‑privilege IAM** for each Lambda.
- **Secrets** in Secrets Manager; rotation policies; no secrets in env
  vars.
- **WAF** with bot control & rate limits (different thresholds for
  search, auth, checkout).
- **Abuse** mitigations: captcha challenges for signup bursts; email
  domain denylist; phone verification for payouts.
- **Backups & keys**: scheduled audits for restore drills and KMS key
  rotations.

## **1.12.L Data privacy & retention**

- **PII catalog** with owners & TTLs; DSAR export tooling (user can
  request data).
- **Retention**: messages 365 days, in‑app 90 days, proofs 180 days,
  signed docs 7 years (legal).
- **Redaction**: purge on account deletion (except finance/legal holds).

## **1.12.M Cost guardrails**

- **Budgets & alarms** per account; Slack/email alert on 20%/50%/80% of
  monthly cap.

- Right‑sizing defaults:

  - Aurora Serverless v2 min ACU 0.5--1.0; autoscale up to 4--8 ACU at
    launch.
  - Typesense: 1 small node; OpenSearch OCU cap = 2--4 (off by default).
  - Lambda memory set to the cheapest point that meets p95; provisioned
    concurrency **off** unless needed.
  - S3 lifecycle rules on by default.
  - NAT usage minimized (prefer VPC endpoints; egress audit).

- **CI "cost bump" gate**: if IaC diff raises projected monthly spend
  over threshold, require finance approval.

## **1.12.N Disaster recovery**

- **RPO**: ≤ 15 minutes for Aurora (PITR).
- **RTO**: ≤ 4 hours (restore + DNS flip) for critical path.
- **Runbook**: documented steps; quarterly drills (stage env); alarms
  that trigger the runbook.

## **1.12.O Local dev, previews, and seed data**

- **Local mocks:** AppSync local, Dynamo local; Stripe/Tax/e‑sign
  sandboxes.
- **Seed fixtures** for cities, roles, studios, users, and sample
  bookings to enable rapid UI work.
- **Ephemeral envs** per PR with auto teardown at 48h.

## **1.12.P Developer experience & governance**

- **Monorepo** with pnpm, turbo, strict TS, ESLint, Prettier.
- **Conventional commits**; PR templates with checklists (security,
  cost, migrations).
- **CODEOWNERS** for critical paths (finance, trust, infra).
- **Schema/codegen** for GraphQL; shared types for events; golden files
  for ranking & fee math.
- **ADR** (Architecture Decision Records) in repo for choices like
  Typesense vs OpenSearch.

## **1.12.Q Work packages (for your 4 Cursor agents)**

**Agent B --- Infra/IaC**

- WP‑INF‑01: Amplify Gen 2 CDK stacks (Auth, API, Data, Media, Workflow,
  Observability).
- WP‑INF‑02: Multi‑account bootstrap, DNS, ACM certs, WAF.
- WP‑INF‑03: Budgets/alerts; cost gate in CI; cdk‑nag rules.

**Agent C --- Data/Runtime**

- WP‑DATA‑01: Aurora cluster + migrations framework; Dynamo tables with
  TTL/RCU/WCU.
- WP‑DATA‑02: Search stack (Typesense baseline + adapter to OpenSearch
  Serverless).
- WP‑DATA‑03: Step Functions templates & EventBridge buses.

**Agent A --- Web/Hosting**

- WP‑WEB‑INF‑01: Amplify Hosting setup w/ branch mapping, ISR/SSR
  config, edge rewrites.
- WP‑WEB‑INF‑02: Signed S3 uploads with scoped IAM; image proxy/resizer
  at edge.

**Agent D --- SecOps/Observability**

- WP‑SEC‑01: WAF managed rules + custom IP rate limits; Secrets
  Manager + rotation.
- WP‑OBS‑01: CloudWatch dashboards/alarms; X‑Ray traces; log scrubbing;
  audit sinks.
- WP‑DR‑01: DR runbook & drill scripts; snapshot retention; restore
  tests.

## **1.12.R Acceptance criteria (mark §1.12 FINAL only when ALL true)**

1246. **Amplify Gen 2** stacks synth and deploy cleanly; CI fails any PR
      that introduces Classic artifacts.
1247. **Three environments** live with separate accounts, DNS, certs,
      and secrets; branch mapping works; previews auto‑expire.
1248. **Security