<!-- id: TD-0272 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 979200-983200 -->

ooks/\*.json* --- JSON Schemas (pinned by version).

## **1.27.6 Versioning & compatibility**

- **REST**: URI‑level versioning (*/v1/\...*); additive changes only
  in‑place; breaking changes via */v2*.
- **Webhooks**: *X-RastUp-Event-Version* header; partners register
  accepted versions; we provide **compat** payloads for one version
  behind.
- **Deprecation**: 90‑day notice; email + dashboard banner + deprecation
  headers.

## **1.27.7 Data model (Aurora) --- partner registry & webhook endpoints**

*db/migrations/034_partner_api.sql*

*begin;*\
\
*create schema if not exists partner;*\
\
*create table partner.client (*\
*client_id text primary key, \-- prt\_\...*\
*name text not null,*\
*contact_email text not null,*\
*status text not null check (status in (\'active\',\'suspended\')),*\
*scopes text\[\] not null,*\
*created_at timestamptz default now()*\
*);*\
\
*create table partner.webhook_endpoint (*\
*endpoint_id text primary key, \-- whk\_\...*\
*client_id text not null references partner.client(client_id),*\
*url text not null,*\
*secret text not null, \-- HMAC secret*\
*version text not null default \'1\',*\
*created_at timestamptz default now(),*\
*unique (client_id, url)*\
*);*\
\
*create table partner.delivery (*\
*delivery_id bigserial primary key,*\
*endpoint_id text not null references
partner.webhook_endpoint(endpoint_id),*\
*event_id text not null, \-- evt\_\...*\
*attempt int not null default 1,*\
*status text not null, \-- \'delivered\'\|\'failed\'\|\'pending\'*\
*response_code int,*\
*response_ms int,*\
*created_at timestamptz default now()*\
*);*\
*create index on partner.delivery (endpoint_id, created_at);*\
\
*commit;*\

## **1.27.8 API Gateway, caching & search adapter**

- **Gateway**: REST API Gateway → Lambda (Node 20).
- **Auth**: OAuth introspection on bearer tokens; cache token verdicts
  in Redis/Dynamo (TTL 5--10m).
- **Public GET caching**: CloudFront edge cache; *ETag* +
  *Last-Modified*; **Typesense adapter** for text queries (SFW filter
  applied server‑side).
- **Pagination**: opaque *cursor* (base64 of index offset + filter
  hash); never expose internal IDs.

## **1.27.9 Privacy & Safe‑Mode**

- **Default PII policy**: public inventory responses contain **no
  emails/phones**; city‑level only; exact addresses for studios only
  when partner has a contractual link (scope elevation).
- **Safe‑Mode**: all API responses include only SFW media URLs; NSFW
  never leaves the platform; webhooks never include raw media.
- **Data Processing**: partner registry tracks processor status and
  contact for DPA.

## **1.27.10 Developer experience (DX) & docs**

- **Docs site**: *developers.rastup.com* (static, versioned) with
  guides, auth flows, scopes matrix, and **Try It** consoles (read‑only
  keys).
- **SDK stubs**: TypeScript and Python minimal clients (generated from
  OpenAPI).
- **Sandbox**: Stage environment credentials; webhook **event replayer**
  with filters (date, event type, aggregate_id).
- **Status page**: incident history & uptime for API/Webhooks.

Artifacts: *api/openapi.yaml*, *sdk/ts/\**, *sdk/python/\**,
*docs/developers/\**.

## **1.27.11 Observability, quotas & billing (if applicable later)**

- **Metrics**: requests by route/partner, p95 latency, 4xx/5xx, quota
  usage, webhook success %, average retries.
- **Alerts**: spike in 5xx, partner over quota, delivery failure rate \>
  X% in 10m.
- **(Optional) Billing later**: metered tiers tied to quotas; not in
  MVP.

## **1.27.12 Work packages (Cursor --- 4 agents)**

- **Agent A --- OAuth & Registry**: Cognito OAuth config, partner
  tables, scopes enforcement, token cache.
- **Agent B --- REST Endpoints**: */profiles*, */studios*, */work*,
  */briefs*, */invites*, */orders/{id}*, */payouts*.
- **Agent C --- Webhooks**: endpoint CRUD, HMAC signing, retry & DLQ,
  replayer UI.
- **Agent D --- DX**: OpenAPI, docs site, SDK stubs, examples, status
  page, Stage sandbox.

## **1.27.13 Tests (representative)**

4684. **AuthZ**: