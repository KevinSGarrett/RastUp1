<!-- id: TD-0276 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 993600-997600 -->



- Each phase Lambda paginates (e.g., 5k rows/chunk) to keep memory
  small.
- Messages phase streams JSONL per thread to avoid huge single files.
- Very large exports split into *bundle.part1.zip*,
  *bundle.part2.zip*... with **parity manifest** in each part.

**Integrity**

- UI displays manifest checksums; optional user‑side verifier CLI
  snippet provided.

## **1.28.6 Redaction & content rules (legal alignment)**

- **Counterparty PII**: emails/phones/usernames **removed** from
  messages the user did not author; display name kept.
- **Studio addresses**: included only if **owned by the exporter** or
  already public to them via an order they participated in.
- **NSFW content**: never included for third‑party assets; for the
  user's **own uploads**, originals can be included; otherwise SFW
  variants only.
- **Third‑party secrets**: Stripe tokens, Plaid tokens, OAuth refresh
  tokens **never** exported.
- **Analytics**: provide aggregated session metadata; **no IPs** or raw
  event payloads.
- **Search**: queries the user typed are included; **no** internal
  ranking signals.

## **1.28.7 Notifications & status tracking**

- Email & in‑app: *REQUESTED* (confirming), *READY* (download link),
  *EXPIRED* (nudge to re‑request).
- Progress bar uses *est_size_bytes* and completed job phases to show
  rough completion.
- Admin Console shows DSAR/export queue with SLA timers (§1.22, §1.24).

## **1.28.8 Receipts & invoices (PDF)**

- Render from **HTML templates** with our ledger + Stripe charges/fees.
- Fields: legal business name, order_id, date, line items (subtotal,
  fees, taxes), discounts, total, last4 of card or payout descriptor,
  billing country.
- **Tax** fields present if configured; VAT/GST numbers supported.
- **Tooling**: Headless Chromium (Puppeteer) Lambda or **WeasyPrint**
  container (pick one; Puppeteer is simpler in Node stack).
- Store PDFs at
  *s3://exports/{export_id}/receipts/receipt\_{order_id}.pdf* and also
  link to each order timeline (§1.14).

## **1.28.9 Security & abuse controls**

- Re‑auth+MFA (if enabled) and CAPTCHA before *verifyExport*.
- **Frequency cap**: one export **per 7 days**; Admin can override for
  DSAR.
- **Single‑use tokens** for downloads; token invalidated on first use or
  after 24h.
- **Watermarking** (optional) adds user_id + timestamp footer in PDFs
  and images included in export.
- **Audit events**:
  *export.requested\|verified\|ready\|downloaded\|expired\|failed* →
  immutable audit log (§1.22) + analytics (§1.21).

## **1.28.10 Observability & KPIs**

- **Pipeline health**: p95 time to READY, failure rate per phase,
  average bundle size.
- **Privacy SLA**: DSAR export within **≤ 30 days** (target ≤ 7 days).
- **Usage**: percent of users completing download, re‑request rate, top
  failure reasons.
- **Alerts**: job backlog \> N, failure spikes, bundle build errors,
  unusually large bundles.

## **1.28.11 Cost posture**

- Serverless Lambdas stream to S3; **no EFS** unless needed.
- PDF rendering batched; scale headless Chromium with small memory
  profiles; keep assets local (no external calls).
- S3 lifecycle deletes bundles at 7 days; Glacier not required (these
  are re‑generable).

## **1.28.12 Work packages (Cursor --- 4 agents)**

- **Agent A --- DDL & GraphQL**: *035_exports.sql*, exports schema,
  authz, server‑gated download endpoint.
- **Agent B --- Extractors & Redaction**: phase Lambdas for identities,
  orders, messages, media; PII redaction helpers; manifest builder.
- **Agent C --- PDFs & Bundler**: receipts generator, summary PDF, ZIP
  bundler (multi‑part), integrity checks.
- **Agent D --- UX & Ops**: request/verify/cancel UI, progress &
  notifications, Admin DSAR queue, dashboards & alerts.

## **1.28.13 Tests (representative)**

4773. **Auth & verification**: re‑auth + MFA required; unauthenticated
      download blocked; single‑use tokens enforced.
4774. **Redaction**: counterpart PII scrubbed; studio address policy
      enforced; third‑par