<!-- id: TD-0112 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 403200-407200 -->

 SES), third‑party API tokens.
- **SSM Parameter Store**: non‑secret config (feature flags, limits).
- **KMS**: dedicated CMKs per data domain (*pii*, *finance*, *legal*)
  with **key policies** bound to minimal roles; automatic rotation
  enabled.

**Inline artifact --- Secrets naming convention**\
**Path:** *security/secrets/naming.md*

*/prod/stripe/secret_key*\
*/prod/stripe/webhook_secret*\
*/prod/plaid/client_id*\
*/prod/plaid/secret*\
*/prod/esign/api_key*\
*/stage/\...*\

## **1.18.E Encryption (in transit & at rest)**

- **TLS 1.2+** everywhere (CloudFront, ALB, AppSync). HSTS on apex.
- **At rest**: S3 SSE‑KMS; DynamoDB SSE‑KMS; Aurora **encrypted**;
  CloudWatch Logs encrypted; Athena workgroup encryption enforced.
- **Field‑level**: hash emails (*sha256(email.lower().trim())*), store
  last‑4 only for phone if needed; avoid plaintext PII in events.
- **Tokenization**: use surrogate keys (*usr\_*, *sp\_*, *fsc\_*) across
  domains.

## **1.18.F Network & edge protections**

- **CloudFront + WAF**:

  - Managed rule sets (AWS Core, Bot Control), plus custom: block
    obvious scanners, rate‑limit */graphql* and POSTs.
  - Allowlist Stripe & provider IPs for webhook ingress (alternate: use
    API Gateway with a shared secret HMAC).

- **AWS Shield Standard** (at least) enabled on CF/ALB.

- **Lambdas**: in VPC only if they need RDS; otherwise public (reduces
  cold‑start & cost). Use **VPC endpoints** for S3/Secrets if inside
  VPC.

**Inline artifact --- WAF rate rule example**\
**Path:** *security/waf/rate-limit-graphql.json*

*{
\"Name\":\"GraphQLRateLimit\",\"RateLimit\":2000,\"ScopeDownStatement\":*\
*{\"ByteMatchStatement\":{\"SearchString\":\"/graphql\",\"FieldToMatch\":{\"UriPath\":{}},\"TextTransformations\":\[{\"Priority\":0,\"Type\":\"NONE\"}\],\"PositionalConstraint\":\"CONTAINS\"}}*\
*}*\

## **1.18.G Data classification & handling**

**Recommended path:** *security/policies/data-classification.md*

- **Public**: marketing copy, SFW previews.
- **Internal**: ops dashboards, aggregate metrics.
- **Confidential PII**: names, emails, phone (minimize; never in logs).
- **Highly Sensitive**: government IDs, IDV artifacts, payment tokens
  (never store raw PAN).\
  **Rules**
- PII only in **Aurora/Dynamo "private"** schemas; analytics **events
  are PII‑free** (link via surrogate keys).
- **DSAR** tombstone events (see §1.13) applied to Silver/Gold; Bronze
  excluded on read.
- **Retention**: per §1.13 --- Bronze 18 mo, Silver 24--36 mo, Gold 24
  mo; finance facts 7 years.

## **1.18.H Logging, audit, and tamper‑evidence**

- **CloudTrail** to dedicated **log‑archive account** (S3 with **Object
  Lock** + Glacier).
- **App logs**: JSON, structured, **no PII**. Correlation IDs propagate
  (*x‑corr‑id*).
- **Admin actions** (refunds, holds, DMCA, representment) write to an
  **immutable audit table** (Aurora) and **append‑only** S3 log (WORM).
- **Webhook idempotency**: record *event_id* + response; on duplicate →
  200 OK no‑op.

**Inline artifact --- audit event shape**\
**Path:** *security/audit/event-envelope.json*

*{*\
*\"ts\":\"2025-11-06T12:34:56Z\",*\
*\"actor\":\"usr_abc \| sys_lambda \| admin@rastup\",*\
*\"action\":\"refund.issued \| payout.hold.apply \| dmca.hide\",*\
*\"target\":\"leg\_\... \| order\_\... \| content\_\...\",*\
*\"details\":{ \"reason\":\"\...\", \"amount_cents\":1234 },*\
*\"corrId\":\"abc123\"*\
*}*\

## **1.18.I Vulnerability management & CI/CD hardening**

- **Dependency hygiene**: lockfiles checked‑in; Renovate/Dependabot
  weekly PRs; third‑party package allowlist.
- **SAST**: GitHub CodeQL (or equivalent) on PR; custom regex rules for
  secrets.
- **Secrets scanning**: pre‑receive hooks + CI step; block merges on
  positive.
- **Container/Lambda layers**: ECR image scan or *npm audit* gates;
  Lambda base runtime kept current.
- **IaC**: CDK/Terraform scanned with **Checkov**/cfn‑nag.
- **CI**: OIDC‑based deploy roles (no long‑lived keys); branch
  protections; required revi