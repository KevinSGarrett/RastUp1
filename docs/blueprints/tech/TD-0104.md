<!-- id: TD-0104 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 374400-378400 -->

mended path:** *web/public/robots.txt*

*User-agent: \**\
*Disallow: /admin/*\
*Disallow: /messages/*\
*Disallow: /checkout/*\
*Disallow: /\_next/*\
*Disallow: /\*?\**\
*Allow: /\$* \
*Allow: /city/*\
*Allow: /p/*\
*Allow: /s/*\
*Sitemap:*
[*https://rastup.com/sitemap.xml*](https://rastup.com/sitemap.xml)

**X‑Robots‑Tag headers**

- Add *x-robots-tag: noindex, nofollow* to: drafts, preview routes,
  filtered result pages with query params, any page with *nsfw_band \>=
  2* assets, and takedowns (DMCA).
- When Safe‑Mode is ON for a user, we still index the public SFW page;
  no 18+ assets are exposed in HTML/JSON‑LD.

## **1.17.F Sitemaps (segmented, auto‑rotating)**

**Recommended path:** *web/pages/sitemap.xml.ts* *(ISR function)*

- **Sitemap Index** */sitemap.xml* lists child maps:

  - */sitemaps/people-0.xml*, */sitemaps/people-1.xml*, ... (sharded by
    hash)
  - */sitemaps/studios-0.xml*, ...
  - */sitemaps/cities.xml*, */sitemaps/stories.xml*

- **lastmod** from *updated_at*; **changefreq** = *weekly* for
  people/studios, *daily* for cities during launch, *monthly* later.

- Exclude de‑published, unverified, or NSFW‑blocked pages.

**Example child sitemap XML**

*\<?xml version=\"1.0\" encoding=\"UTF-8\"?\>*\
*\<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"\>*\
*\<url\>*\
*\<loc\>https://rastup.com/p/{{handle}}\</loc\>*\
*\<lastmod\>{{updatedISO}}\</lastmod\>*\
*\<changefreq\>weekly\</changefreq\>*\
*\<priority\>0.8\</priority\>*\
*\</url\>*\
*\</urlset\>*\

## **1.17.G Hreflang & locale routing**

- Default locale *en-US*. Add hreflang alternates when we add
  translations:

  - *\<link rel=\"alternate\" hreflang=\"en\" href=\"...\"\>*, *\<link
    rel=\"alternate\" hreflang=\"es\" href=\"...\"\>*, plus *x-default*.

- URL policy: keep canonical paths without locale prefix; inject
  *hreflang* only (simplifies link sharing).

- Next.js middleware detects *Accept‑Language*, sets *lang* and *dir* on
  *\<html\>*, and formats dates/currency per locale.

**Snippet (Next.js, concept)**\
**Recommended path:** *web/middleware.ts* *(doc block)*

*export function middleware(req: NextRequest) {*\
*const locale = negotiateLocale(req.headers.get(\'accept-language\'));*\
*const res = NextResponse.next();*\
*res.headers.set(\'x-lang\', locale.lang);*\
*res.headers.set(\'x-dir\', locale.dir); // ltr/rtl*\
*return res;*\
*}*\

## **1.17.H Rendering strategy & caching (ISR/SSR + CDN)**

- **People/Studios pages**: ISR with *revalidate: 86400* (24h) on
  low‑change fields; **on‑demand revalidation** when profile edits
  publish.
- **City pages**: ISR, *revalidate: 21600* (6h) at launch → 24h later.
- **Stories**: static at publish; republish on edit.
- **Edge cache**: CloudFront cache policy keyed by *Accept‑Language* and
  *Cookie* *only for Safe‑Mode* flag (avoid leaking modes).
- **Stale‑while‑revalidate** for instant TTFB.
- **ETag** for JSON APIs used by static props.

## **1.17.I Core Web Vitals & performance budgets**

**Targets (P75 on mobile):**

- **LCP ≤ 2.5s**, **CLS ≤ 0.10**, **INP ≤ 200ms**, **TTFB ≤ 800ms**.

**Levers:**

- Use Next/Image for responsive SFW previews; WebP/AVIF; lazy + priority
  on hero.
- Inline **critical CSS** for above‑the‑fold; remove unused CSS via
  CSS‑in‑JS extraction.
- Code‑split heavy modules (editor, charts) behind dynamic import.
- Preconnect to our CDN and Stripe (checkout pages only).
- Ship system fonts or 1 local WOFF2 with *font-display: swap*.
- Avoid blocking analytics; send beacons via *navigator.sendBeacon* to
  our */collect* endpoint.
- Only 1 external script allowed on public pages: the consented
  analytics shim (first‑party). No ad trackers.

**Lighthouse CI budget (inline)**\
**Recommended path:** *observability/budgets/lighthouse-budget.json*

*{*\
*\"resourceSizes\": \[*\
*{\"resourceType\": \"script\", \"budget\": 160},*\
*{\"resourceType\": \"total\", \"budget\": 900}*\
*\],*\
*\"resourceCounts\": \[*\
*{\"resourceType\": \"third-party\", \"budget\": 2},