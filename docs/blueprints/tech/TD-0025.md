<!-- id: TD-0025 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 90000-94000 -->

erences booking_leg(leg_id) on delete
cascade,*\
*status text not null check (status in
(\'draft\',\'issued\',\'signed\',\'voided\',\'superseded\')),*\
*generator_ver text not null, \-- codegen version hash*\
*city text not null,*\
*created_at timestamptz not null default now(),*\
*updated_at timestamptz not null default now(),*\
*unique (leg_id, status) deferrable initially deferred*\
*);*\
\
*\-- Documents within a pack*\
*create table doc_instance (*\
*doc_id text primary key, \-- doc\_\...*\
*pack_id text not null references doc_pack(pack_id) on delete cascade,*\
*template_id text not null references doc_template(template_id),*\
*template_version int not null,*\
*variables_filled jsonb not null, \-- resolved values at generate time*\
*render_pdf_s3 text, \-- s3://bucket/key.pdf*\
*render_pdf_sha256 text, \-- SHA-256 of PDF bytes*\
*envelope_id text, \-- e-sign envelope id*\
*envelope_status text check (envelope_status in
(\'none\',\'sent\',\'completed\',\'voided\',\'expired\')) default
\'none\',*\
*signer_map_json jsonb not null, \-- mapping of signer roles -\>
users/emails*\
*created_at timestamptz not null default now(),*\
*updated_at timestamptz not null default now()*\
*);*\
\
*\-- Signer evidence log*\
*create table doc_sign_event (*\
*sign_event_id text primary key, \-- dse\_\...*\
*doc_id text not null references doc_instance(doc_id) on delete
cascade,*\
*actor_role text not null, \--
\'buyer\',\'talent\',\'studio_owner\',\'witness\'*\
*actor_user_id text,*\
*actor_email text,*\
*event text not null check (event in
(\'envelope_sent\',\'viewed\',\'signed\',\'declined\',\'voided\',\'expired\')),*\
*provider_payload jsonb not null,*\
*created_at timestamptz not null default now()*\
*);*\

**S3 layout**

*s3://docs/prod/packs/{pack_id}/*\
*doc\_{doc_id}\_v1.pdf \# immutable versioned PDF*\
*envelope\_{doc_id}.json \# e-sign provider metadata*\
*hash\_{doc_id}.txt \# SHA-256 digest*\

**Retention & legal hold**

- Bucket policy applies **7‑year retention**; legal hold flag per doc if
  Support/Legal initiates a hold.

## **1.5.C Clause library & variables**

**Clause authoring**

- Authored in **Markdown** with limited components: headings, lists,
  clause refs, and **variable placeholders** in *{{snake_case}}*.
- Variables must be declared in *variables_json* with type, description,
  and example. Supported types: *string*, *int*, *money_cents*,
  *datetime*, *date*, *duration*, *enum{...}*, *address*.

**Examples**

- SOW "Base Terms" requires: *{{service_date}}*, *{{start_time}}*,
  *{{end_time}}*, *{{location_address}}*, *{{deliverables_summary}}*,
  *{{total_price}}*, *{{taxes}}*, *{{cancellation_policy_summary}}*.
- Model Release (Adult) requires: *{{model_legal_name}}*,
  *{{model_dob}}* (age verification gate), *{{usage_scope}}*,
  *{{territory}}*, *{{duration}}*, *{{compensation_summary}}*.
- Studio Rules requires: *{{studio_name}}*, *{{safety_rules}}*,
  *{{deposit_amount}}*, *{{damage_policy}}*.

**City & role gates**

- Clauses and templates can be constrained by **city** (local rules) and
  **role** (e.g., Model Releases apply only to Talent legs). City gates
  align to your feature‑flag model.

**Versioning**

- Clauses are immutable once published; edits create a **new version**.
  Templates reference clause **name + version** explicitly to guarantee
  reproducible renders.

## **1.5.D Template composition**

**Templates at launch**

- **Talent SOW (v1)** → ordered clauses: Base Terms, Responsibilities,
  IP & Licensing, Payment & Escrow, Cancellation, Safety & Conduct,
  Limitation of Liability, Governing Law.
- **Model Release (Adult, v1)** → fields enforce 18+ check; explicitly
  **disallows explicit content** on public surfaces; usage scope limited
  per blueprint positioning.
- **Studio House Rules (v1)** → capacity, amenity rules, deposit,
  damages, cleaning fees, overtime procedure.

**Signer roles**

- **Talent SOW:** Buyer & Seller (talent).
- **Model Release:** Model (may be same as talent or se