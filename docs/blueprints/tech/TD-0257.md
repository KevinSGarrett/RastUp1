<!-- id: TD-0257 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 925200-929200 -->

  fits.

## **1.22.10 Work packages (Cursor --- 4 agents)**

- **Agent A --- RBAC & Audit**: DDL, GraphQL auth directives, chain‑hash
  audit writer, S3 WORM mirror.
- **Agent B --- Moderation & Verification**: DMCA queue, studio doc
  review, asset takedown/restore, SFW gate.
- **Agent C --- Orders & Refunds**: kernel UI, Stripe refund executor,
  ledger postings, notifications.
- **Agent D --- Configs & Flags**: feature flags panel, city configs,
  promotions density caps, holdout, runbooks & alerts.

## **1.22.11 Tests (representative)**

4274. **AuthZ**: each role can only see/do permitted actions; PII
      masking verified.
4275. **Dual‑control**: suspend/refund‑over‑cap require approval;
      execution blocked without it.
4276. **DMCA**: takedown hides assets, revalidates pages, logs audit;
      restore reverses.
4277. **Refund kernel**: applying time‑band policy computes correct
      refund ceiling; Stripe settlement succeeds/fails gracefully.
4278. **Verification**: doc approval sets badges & IB eligibility;
      rejection includes reason.
4279. **Audit immutability**: chain hash breaks if row altered; S3
      object lock prevents delete.
4280. **SFW safety**: public contexts never show non‑SFW assets; console
      requires explicit privilege to view originals.
4281. **Break‑glass**: requires 2 approvals; session auto‑expires;
      start/end audit present.

## **1.22.12 Artifacts (paste‑ready)**

- *db/migrations/029_admin_console.sql* --- RBAC actions, audit, flags,
  city configs.
- *api/schema/admin.graphql* --- queries & mutations above.
- *services/admin/audit.ts* --- chain hash writer & S3 WORM mirror.
- *services/admin/macros/\** --- DMCA, suspend, refund, verify,
  spotlight, break‑glass.
- *web/admin/\** --- Next.js console (queues, dashboards, entity pages).
- *observability/dashboards/admin.md* --- KPIs & alerts.
- *ops/runbooks/\** --- DMCA, Refunds, Suspensions, Break‑glass,
  Verification.

## **1.22.13 Acceptance criteria --- mark §1.22 FINAL only when ALL true**

4289. RBAC enforced with least privilege; PII masking works; staff SSO +
      MFA enabled.
4290. All privileged actions require reason codes; dual‑control enforced
      where configured.
4291. Audit trail is complete, chained, and mirrored to S3 WORM; tamper
      attempts detectable.
4292. DMCA takedown/restore, account suspension, refund with kernel, and
      studio verification **all** operate via one‑click macros with
      notifications and logs.
4293. Safe‑Mode invariants hold: public surfaces never leak NSFW;
      console watermarks sensitive media.
4294. Console meets SLOs; dashboards/alerts live; cost profile remains
      serverless‑friendly.

# **§1.23 --- Platform Infrastructure, Environments, CI/CD & SRE**

**Full Technical Development Plan (single, copy‑paste block for your
master doc)**

**Purpose.** Deliver a **secure, cost‑efficient, and observable**
platform for web/app APIs and data services. Define **environments**,
**infrastructure‑as‑code**, **build/release pipelines**, **secrets &
keys**, **logging/metrics/tracing**, **backups/DR**, **SLOs/error
budgets**, **cost controls**, and **runbooks**---all aligned with
Amplify Gen‑2, AppSync, Lambda, Aurora Serverless v2, S3/CloudFront,
Typesense (ECS Fargate), and EventBridge.

## **1.23.1 Objectives & invariants**

4295. **One‑click, reproducible** environments (Dev/Stage/Prod) via IaC;
      no snowflakes.
4296. **Zero‑downtime deploys** with canaries/blue‑green; DB migrations
      safe & reversible.
4297. **Observability by default** (logs + metrics + traces + alerts)
      with runbooks.
4298. **Security & privacy first** (least‑privilege IAM, KMS encryption,
      secret hygiene, WAF).
4299. **Elastic & cost‑disciplined** (serverless everywhere practical;
      clear scale/cutover plan).
4300. **DR posture defined** (RPO/RTO targets, snapshot/restore,
      cross‑region backups).

## **1.23.2 Environments & accounts**

- **AWS accounts**: *dev*, *stage*, *prod* 