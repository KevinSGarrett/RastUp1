<!-- id: TD-0024 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 86400-90400 -->

pect
     quiet hours.
462. Telemetry covers lifecycle, panel, actions, moderation, and
     notifications; dashboards show health & lag \< threshold.
463. p95 performance meets targets; DDB/AppSync/S3 costs within budget
     alarms for 48h of synthetic load.

# **§1.5 --- Smart Docs & E‑Sign CMS**

*(Clause library · variables · pack assembly · e‑signature · PDF hashing
· retention · rollbacks · comms templates · admin & audits)*

**Purpose.** Create a versioned, auditable **Smart Docs CMS** that
generates legal‑quality documents for bookings and linked booking groups
(LBG): SOW (Statement of Work), Model Release(s), and Studio House
Rules. These are assembled into **Doc Packs** that must be **fully
signed before payment** (Docs‑Before‑Pay), with immutable storage
(hashing), retention, re‑issue rules, and end‑to‑end lineage for
disputes and finance.

We won't move to §1.6 until §1.5 meets your 99.9% bar.

## **1.5.A Canon & invariants**

464. **Docs‑Before‑Pay:** Checkout cannot capture funds unless **every
     required doc** for each leg has been generated and fully signed
     (all signers complete).
465. **Per‑leg packs:** LBG has **one Doc Pack per leg** (Talent leg
     pack; Studio leg pack). Packs can contain multiple documents.
466. **Immutable evidence:** Rendered PDFs are hashed (SHA‑256) and
     written to S3 with WORM‑like retention; every receipt references
     doc hashes.
467. **Versioned clauses:** All doc content is composed from a **clause
     library** with semantic versioning and city gates.
468. **Re‑issue on change:** Any scope/time/location change that affects
     the contract content **invalidates** prior signatures and requires
     re‑issue (with clear UX).
469. **Privacy & redaction:** PII and signatures are stored securely;
     evidence exports support **minimal disclosure** redactions for
     disputes.
470. **Seven‑year retention** (configurable) for all signed docs and
     envelope metadata.

## **1.5.B Data model (Aurora Postgres + S3)**

*\-- Clause library (atomic building blocks)*\
*create table doc_clause (*\
*clause_id text primary key, \-- cls\_\...*\
*name text not null, \-- \"SOW: Base Terms\", \"Model Release: Adult\",
\"House Rules: Standard\"*\
*version int not null, \-- semantic versions across edits*\
*city_gate text\[\], \-- list of allowed city codes (null = global)*\
*role_gate text\[\], \-- \[\'model\',\'photographer\',\'studio\'\]
filter*\
*is_active boolean default true,*\
*body_markdown text not null, \-- authoring format*\
*variables_json jsonb not null, \-- schema of variables required*\
*created_by text not null,*\
*created_at timestamptz not null default now(),*\
*published_at timestamptz,*\
*unique (name, version)*\
*);*\
\
*\-- Document templates (ordered lists of clauses + layout & signers)*\
*create table doc_template (*\
*template_id text primary key, \-- tpl\_\...*\
*name text not null, \-- \"Talent SOW v3\", \"Studio House Rules v2\"*\
*version int not null,*\
*city_gate text\[\],*\
*role_gate text\[\],*\
*clauses_ordered jsonb not null, \-- e.g., \[{clause_id, version,
order}\]*\
*layout_json jsonb not null, \-- header/footer/logo, page breaks*\
*signer_roles jsonb not null, \-- e.g.,
\[{role:\'buyer\'},{role:\'talent\'},{role:\'witness\'?}\]*\
*is_active boolean default true,*\
*created_by text not null,*\
*created_at timestamptz not null default now(),*\
*published_at timestamptz,*\
*unique (name, version)*\
*);*\
\
*\-- Doc pack (generated for each leg at checkout)*\
*create table doc_pack (*\
*pack_id text primary key, \-- dpk\_\...*\
*leg_id text not null references booking_leg(leg_id) on delete
cascade,*\
*status text not null check (status in
(\'draft\',\'issued\',\'signed\',\'voided\',\'superseded\')),*\
*generator_ver text not null, \-- codegen version hash*\
*city text not null,*\
*created_at timestamptz not null default now(),*\
*updated_at timestamptz not null default now(),*\
*unique (leg_id, status) deferrable initially deferred*\
*);*\
\
*\-