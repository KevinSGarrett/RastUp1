<!-- id: TD-0294 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 1058400-1062400 -->



**K.6 Acceptance**

- Contract tests pass across all surfaces; partner SDK examples
  round‑trip the codes above; idempotent replays proven in CI.

## **Appendix L --- CDN / Cache Key Matrix (paste‑ready)**

**Purpose.** Eliminate guesswork in caching; protect privacy while
hitting performance budgets.

**L.1 Behaviors (CloudFront)**

- **/ (Home)** --- TTL **600s**; Key: *Host, Path, Accept‑Language
  (2‑letter), Safe‑Mode*; Invalidate on *home:content_publish*.
- **/city/** --- TTL **1800s**; Key: *Host, Path, Query(role,sort,page),
  Accept‑Language, Safe‑Mode*; Warm top 100.
- **/people\|/studios\|/work** (search grids) --- **no edge cache** for
  personalized; server‑side **Dynamo cache** 60--300s keyed by
  normalized filters + personalization digest.
- **/help/** --- TTL **1--7d**; Key: *Host, Path, Accept‑Language*;
  invalidate on article publish.
- **/assets/** --- immutable; *Cache‑Control: public, max‑age=31536000,
  immutable*.
- **/api/** --- not cached at edge; AppSync GETs may be cached 60s only
  for truly public read endpoints (none for personalized).

**L.2 ISR (Next.js)**

- Regenerate on publish events; fallback blocking for top 1k pages;
  *revalidate* intervals recorded per template.

**L.3 Vary & privacy**

- Keys always include **Safe‑Mode**; never vary by cookies except the
  minimal Next/Amplify preview cookie in non‑prod.

**L.4 Invalidation triggers**

- Help/article publish → */help/\** path.
- Profile/studio edit (public fields) → that page + city landing;
  batched per minute.
- DMCA takedown → page + related grids.

**L.5 Acceptance**

- Edge hit ratio ≥ target for public pages; no leakage of personalized
  state; p95 TTFB meets budgets post‑warm.

## **Appendix M --- Logging, Event Schema & PII Redaction (paste‑ready)**

**Purpose.** Consistent, privacy‑safe logs and analytics with
traceability.

**M.1 Log schema (JSON)**

*{*\
*\"ts\": \"2025-11-06T12:34:56.789Z\",*\
*\"sev\": \"INFO\",*\
*\"svc\": \"search-api\",*\
*\"req_id\": \"r-abc123\",*\
*\"user_id\": \"u_123\" ,*\
*\"route\": \"/search/people\",*\
*\"lat_ms\": 132,*\
*\"remote_ip\": \"REDACTED\",*\
*\"msg\": \"search ok\",*\
*\"extra\": { \"city\": \"LA\", \"role\": \"photographer\", \"cache\":
\"hit\" }*\
*}*\

- **Required fields:** *ts, sev, svc, req_id, msg*.
- **Correlation:** *req_id* propagates across services; GraphQL
  resolvers include it.
- **Do‑not‑log PII:** emails, phone numbers, card tokens, addresses,
  EXIF raw, OAuth tokens.
- **Sampling:** 100% WARN/ERROR; INFO sample 10--20% on hot paths; raise
  to 100% during incidents.
- **Retention:** 30--90 days hot; archive to Glacier 12 months.

**M.2 Redaction & tokenization**

- Mask last‑4 for pan/phone; hash email usernames; scrub IPs before
  storage except in security logs (separate, restricted).

**M.3 Event analytics schema**

- Standard event fields: *event_name, user_id (hash), session_id, page,
  surface, ts, city, role, experiment_assignments*.
- Contracts live in *analytics/contracts/\*.json*; validation runs in
  CI.

**M.4 Acceptance**

- Secret scans find **0** PII; correlation works across services; event
  validator passes with 0 schema drifts.

# **Technical Appendices (canonical index for your master doc)**

- **H.** UI/UX Reference --- page layouts, fields, validations, states
  *(already delivered; re‑use as your Appendix H)*
- **I.** Configuration & Flags Registry *(reprinted below)*
- **J.** API Error & Semantics Registry *(reprinted below)*
- **K.** CDN / Cache Key Matrix *(reprinted below)*
- **L.** Logging, Event Schema & PII Redaction *(reprinted below)*
- **M.** SBOM & Dependency Policy *(new, as you requested)*
- **N.** Disaster Recovery Matrix (RTO/RPO) & DR Runbooks *(new)*
- **O.** Data Governance (Retention, Classification, Masking, Lineage)
  *(new)*
- **P.** Requirements Traceability Matrix (RTM) --- framework & seed
  entries *(new)*

## **Appendix I --- Configuration & Flags Registry (paste‑ready)**

**Purpose.** Single source of truth