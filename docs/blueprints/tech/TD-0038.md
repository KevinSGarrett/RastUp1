<!-- id: TD-0038 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 136800-140800 -->

nthetic load.

# **§1.8 --- Reviews & Reputation**

*(per-entity scopes · write rules · fraud controls · weighting & decay ·
surfacing · moderation & appeals · admin · telemetry · tests · cost)*

**Purpose.** Implement a trustworthy reputation system that reflects
real, recent performance, scoped correctly to *people* (Service
Profiles) and *places* (Studios). Prevent abuse (self-reviews, review
rings), handle disputes and takedowns, and surface aggregate reputation
into search, booking, messaging, and promotions eligibility---without
leaking ratings across scopes.

We will not advance to §1.9 until §1.8 satisfies your 99.9% bar.

## **1.8.A Canon & invariants**

730. **Scope is sacred.** Reviews for **Service Profiles (SPs)** and
     **Studios** are separate. No cross-pollination.
731. **Eligibility to review:** Only the **buyer** on a **completed
     leg** (or auto-accepted group) can review that **leg's
     counterparty**.
732. **One review per leg per author**, editable once within a short
     window (e.g., 24 h), then locked.
733. **Star + text + structured facets** (e.g., communication,
     timeliness, quality, cleanliness for studios).
734. **Abuse controls**: block self-reviews, ring patterns, retaliatory
     bursts, hate speech, doxxing.
735. **Display rules**: recent-weighted average with minimum sample
     guard; show distributions and recent highlights.
736. **Appeals & moderation**: content policy applies; T&S can
     remove/restore with immutable audits.

## **1.8.B Data model (Aurora Postgres)**

*\-- Reviews are scoped to either a Service Profile (person) or a Studio
(place)*\
*create table review (*\
*review_id text primary key, \-- rev\_\...*\
*target_type text not null check (target_type in
(\'service_profile\',\'studio\')),*\
*target_id text not null, \-- srv\_\* or std\_\**\
*author_user_id text not null, \-- usr\_\* (buyer on the leg)*\
*leg_id text not null, \-- leg\_\* (used to enforce 1:1 and
eligibility)*\
*rating smallint not null check (rating between 1 and 5),*\
*title text,*\
*body text,*\
*facets_json jsonb not null default \'{}\'::jsonb, \--
{communication:1-5, quality:1-5, \...}*\
*photos_json jsonb not null default \'\[\]\'::jsonb, \-- review photos
(previews only)*\
*status text not null check (status in
(\'published\',\'hidden\',\'removed\',\'pending\')),*\
*policy_flags jsonb not null default \'{}\'::jsonb, \-- {toxicity:0-1,
nsfw:0-1, fraud_score:0-1}*\
*source text not null default \'first_party\', \-- reserved for future
imports*\
*created_at timestamptz not null default now(),*\
*updated_at timestamptz not null default now(),*\
*unique (leg_id, author_user_id)*\
*);*\
\
*\-- Aggregates per entity (denormalized for fast reads)*\
*create table reputation_aggregate (*\
*agg_id text primary key, \-- rag\_\...*\
*target_type text not null, \-- \'service_profile\' \| \'studio\'*\
*target_id text not null,*\
*rating_avg numeric(3,2) not null default 0,*\
*rating_count int not null default 0,*\
*rating_recent_avg numeric(3,2) not null default 0, \-- time-decayed*\
*last_review_at timestamptz,*\
*facet_avgs_json jsonb not null default \'{}\'::jsonb, \-- per-facet
averages*\
*fraud_signal numeric(3,2) not null default 0, \-- 0-1*\
*updated_at timestamptz not null default now(),*\
*unique (target_type, target_id)*\
*);*\
\
*\-- Moderation decisions (immutable)*\
*create table review_moderation_audit (*\
*audit_id text primary key, \-- rma\_\...*\
*review_id text not null references review(review_id) on delete
cascade,*\
*action text not null check (action in
(\'hide\',\'remove\',\'restore\',\'edit_mask\')),*\
*reason_code text not null, \--
\'hate_speech\',\'doxxing\',\'fraud_ring\',\'by_request\', etc.*\
*actor_user_id text not null, \-- admin*\
*details_json jsonb not null default \'{}\'::jsonb,*\
*created_at timestamptz not null default now()*\
*);*\
\
*\-- Reports (user flags)*\
*create table review_report (*\
*report_id text primary key, \-- rr\_\...*\
*review_id text not null referen