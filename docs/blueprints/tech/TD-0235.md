<!-- id: TD-0235 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 846000-850000 -->

es follow the canonical URL scheme, with
      robots/canonical tags correct and sitemaps live.
3867. **Programmatic city×role** pages render with unique copy, stats,
      FAQ schema, and pass thin‑content gate; ISR + revalidation works.
3868. **Structured data** present and valid on Studios, Services, FAQ,
      and breadcrumbs; reviews shown only when SFW and thresholds met.
3869. **Core Web Vitals** budgets pass on mobile for representative
      pages; Lighthouse CI integrated.
3870. Public surfaces **never** display NSFW assets; OG and email
      previews always SFW.
3871. DMCA/policy actions propagate to public within ≤10 minutes;
      redirects & 404 coverage monitored.
3872. Dashboards show organic CTR, indexation, and CWV; Search Console
      clear of critical coverage errors.

> 

> 

> 

> 

> 

> 

> 

> 

> 

> 

> 

> 

# **§1.18 --- Search & Discovery (Indexing, Ranking, Filters & Personalization) --- Full Technical Development Plan**

**Purpose.** Power fast, safe, and relevant discovery across **People
(Service Profiles)**, **Studios/Spaces**, and **Case Studies/Content**,
with cost‑efficient infrastructure and Safe‑Mode gating for all public
queries. Provide consistent **facets**, **geosearch**,
**spelling/synonyms**, **ranking**, and **personalization** that
integrates with Calendar (§1.12), Media (§1.11), Reviews (§1.9), and
Growth (§1.16).

## **1.18.1 Scope → Technical**

- Entities: **People/Service Profiles**, **Studios**, **Case
  Studies/Work**, **Content (Help/Guides)**.
- Features: **full‑text**, **faceted filters**, **geo proximity**,
  **availability boost**, **Verified chip boost**, **Safe‑Mode (SFW)
  enforcement**, **spelling & synonyms**, **did‑you‑mean**, **search
  suggestions**, **ANY/ALL filter logic** (compatible with §1.16),
  **cursor pagination**, and **result caching**.
- Personalization: soft boost for **followed** creators and **recent
  engagers**; hard filters for **blocked** users and **NSFW** on public.
- Cost posture: **Typesense** (recommended MVP) or **OpenSearch**
  (upgrade path) with incremental upserts; serverless indexer; cache hot
  queries.

**Choice:** For MVP, use **Typesense** (v0.25+) for simplicity, speed,
and low ops; we'll keep an adapter to support OpenSearch later if we
need custom ranking scripts or larger clusters.

## **1.18.2 Architecture**

- **Source of truth**: Aurora Postgres tables from §1.7 (profiles),
  §1.11 (media), §1.12 (availability), §1.9 (reviews), §1.14 (orders
  timeline signals).
- **Change capture**: DB **outbox** table (*search.outbox*) written by
  application services on each relevant change; EventBridge rule
  triggers **Indexer Lambda** to upsert/delete docs in search.
- **Search service**: AppSync resolvers call a **search Lambda** that
  translates GraphQL → Typesense queries (applies Safe‑Mode rules,
  personalization boosts, and facet constraints).
- **Cache**: popular queries cached in Dynamo TTL 60--300s (keyed by
  normalized filter JSON).
- **CDN**: result pages are rendered server‑side (Next.js) with
  cacheable query params when safe; otherwise, client fetch.

## **1.18.3 Collections (Typesense schemas --- paste‑ready)**

Create *ops/typesense/collections.json*:

*{*\
*\"people\": {*\
*\"fields\": \[*\
*{\"name\":\"id\",\"type\":\"string\"},*\
*{\"name\":\"handle\",\"type\":\"string\",\"facet\":false},*\
*{\"name\":\"display_name\",\"type\":\"string\"},*\
*{\"name\":\"roles\",\"type\":\"string\[\]\",\"facet\":true},*\
*{\"name\":\"city\",\"type\":\"string\",\"facet\":true},*\
*{\"name\":\"country\",\"type\":\"string\",\"facet\":true},*\
*{\"name\":\"verified\",\"type\":\"bool\",\"facet\":true},*\
*{\"name\":\"price_min\",\"type\":\"int32\",\"facet\":true},*\
*{\"name\":\"price_max\",\"type\":\"int32\",\"facet\":true},*\
*{\"name\":\"rating\",\"type\":\"float\",\"facet\":true},*\
*{\"name\":\"review_count\",\"type\":\"int32\",\"facet\":true},*\
*{\"name\":\"availability_score\",\"type\":\"float\"},*\
*{\"name\":\"lat\",\