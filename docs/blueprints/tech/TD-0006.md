<!-- id: TD-0006 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 21600-25600 -->

 compliance; diversity indices.

## **1.2.L Admin tools (console)**

**Search Admin**

- **Reindex** city/role; **dry‑run** to preview doc deltas.
- **Synonyms** & stopwords editor; import/export.
- **Density caps** (Featured/Boost) with city gates.
- **Eligibility rules** (e.g., verified‑only for certain placements).
- **Invalid click** dashboard with credit issuance.
- **Index health**: doc counts vs DB counts, last update lag, error
  logs.

**Config safety**

- All changes require reason, actor, and (for money/placement)
  **two‑person approval**.
- Rollback to previous config version.

## **1.2.M Error model (API)**

- *SEARCH_INVALID_LOCATION* --- unresolvable or mismatched city vs
  lat/lon.
- *SEARCH_UNDERAGE_SAFEMODE* --- attempted explicit toggle without age
  verification.
- *SEARCH_ROLE_FILTER_CONFLICT* --- role‑specific filter provided for
  wrong role.
- *SEARCH_CITY_GATED* --- surface disabled for this city.
- *SEARCH_TOO_MANY_PARAMS* --- exceeded allowed number of facets.
- *SEARCH_ENGINE_ERROR* --- upstream engine error (masked; logged with
  corrId).

All error payloads include *code*, *message*, *hint*, and a correlation
id.

## **1.2.N Synonyms & taxonomies (starter sets)**

**Genres (Models)**: fashion, editorial, commercial, runway, beauty,
swim, fitness.\
**Specialties (Photographers/Videographers)**: portrait, fashion,
editorial, wedding, music, commercial, product.\
**Amenities (Studios)**: natural light, cyc wall, blackout, backdrops,
makeup area, dressing room, parking, AC/heating.

**Synonyms example**

- "bnw" ↔ "black and white"; "glam" ↔ "glamour"; "studio access" ↔ "has
  studio".

## **1.2.O Security, privacy, safety controls**

- **Safe‑Mode** enforced at query and render time.
- **Age‑gate** required to see certain role tabs (Fan‑Sub); explicit
  public images still disallowed.
- **PII** never stored in index documents.
- **Abuse**: aggressive rate limiting and bot heuristics for suggest
  endpoints.

## **1.2.P Cost controls**

- **Typesense**: single small node (or managed starter), vertical scale
  when QPS rises; replica optional for HA.
- **OpenSearch Serverless** (if chosen): **OCU cap** per region; alarms
  on sustained OCU \> 80%.
- Cache TTLs keep engine calls low; nightly reindex batched to off‑peak
  hours.

## **1.2.Q Test plan (must‑pass)**

**Unit & contract**

- Filter parsing/normalization; role‑filter gating; city & safe‑mode
  checks; error codes.

**Search correctness**

- Role true: a multi‑role user queried in "Model" must link to
  */u/{handle}/model*; ratings don't leak across roles.
- Studios separated: amenities filters never affect people surface.

**Ranking & fairness**

- Diversity: same owner appears ≤K times in top N.
- New‑seller floor: at least M cold‑start profiles surface in top N
  given enough eligible docs.
- Verify boosts: ID Verified outranks equal unverified, all else equal.

**Promotions**

- Density caps obeyed; placements never bypass filters; invalid clicks
  removed from billable stream.

**Performance**

- p95 latency within SLO for cached and uncached queries under synthetic
  city load.

**Resilience**

- Indexer retry & DLQ; search fallback message (non‑blocking) if engine
  unreachable.

## **1.2.R Work packages (for your 4 Cursor agents)**

**Agent C --- Search/Index**

- WP‑SRCH‑01: Define Typesense collections; create indexer Lambda;
  implement upsert paths from outbox.
- WP‑SRCH‑02: Build query layer with normalization (city, radius) and
  safe‑mode enforcement; cursor pagination.
- WP‑SRCH‑03: Implement ranking features and fairness constraints; write
  unit tests.

**Agent A --- API/BFF**

- WP‑API‑SRCH‑01: Implement GraphQL *search*, *searchSuggest*,
  *saveSearch* with auth & rate limits; error model and correlation ids.
- WP‑API‑SRCH‑02: Result caching (SWR) + per‑user cursor cache.

**Agent B --- Web**

- WP‑WEB‑SRCH‑01: Search UI (role tabs, chips, facets, sort); result
  cards; disclosure for paid slots.
- WP‑WEB‑SRCH‑02: Saved se