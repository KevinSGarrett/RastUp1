<!-- id: TD-0246 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 885600-889600 -->

,*\
*bodyMd: String!, faqJson: AWSJSON!, category: String!, tags:
\[String!\]!,*\
*visibility: String!, publishedAt: AWSDateTime, lastReviewedAt:
AWSDateTime, reviewStatus: String!,*\
*relatedSlugs: \[String!\]!*\
*}*\
*type KBList { items: \[KBArticle!\]!, nextCursor: String }*\
\
*type Query {*\
*kbArticle(slug: String!, locale: String = \"en\"): KBArticle*\
*kbList(category: String, q: String, cursor: String, limit: Int = 24,
locale: String = \"en\"): KBList!*\
*}*\
\
*input KBArticleInput {*\
*slug: String!, kind: KBKind!, locale: String = \"en\", title: String!,
summary: String!,*\
*bodyMd: String!, faqJson: AWSJSON, category: String!, tags:
\[String!\], visibility: String*\
*}*\
*type Mutation {*\
*kbCreate(input: KBArticleInput!): ID! \@auth(role: \"editor\")*\
*kbUpdate(id: ID!, input: KBArticleInput!): Boolean! \@auth(role:
\"editor\")*\
*kbPublish(id: ID!): Boolean! \@auth(role: \"editor\")*\
*kbFeedback(slug: String!, helpful: Boolean!, comment: String):
Boolean!*\
*}*\

**Auth:**

- *editor* role for authoring; public queries are read‑only.
- Internal articles require authenticated admin/agent and **never** set
  SEO JSON‑LD or sitemaps.

## **1.20.5 Rendering & delivery**

- **Next.js** pages at */help/{slug}*.
- **Static Generation + ISR**: rebuild on publish/update; CloudFront
  cache with *stale‑while‑revalidate*.
- **Markdown/MDX**: sanitized to safe HTML; code blocks highlighted;
  internal component shortcodes allowed (*\<Step\>*, *\<Callout\>*,
  *\<FormCTA\>*).
- **JSON‑LD** injection for *FAQPage* when *faq_json* present and
  visibility is *public*.
- **OG cards**: SFW preview image per §1.16 Sharecards.
- **Hreflang**: if translated versions exist, add *hreflang* links
  (Phase‑2 i18n).

## **1.20.6 Search & suggestions integration (with §1.18)**

- **Typesense** ***help*** **collection** already defined in §1.18 (*id,
  slug, title, category, body, updated_at*).
- Add fields: *tags\[\]*, *popularity_weight* (derived from views +
  helpful ratio), *seo_noindex* (to exclude internal).
- **Query routing**: in product search box → first tab returns help
  results (top 5) before marketplace entities.
- **Zero‑result rescue**: show top 3 help articles based on q‑grams and
  synonyms, gated by SFW.

## **1.20.7 Guided troubleshooters (decision trees)**

- **Graph model**: nodes (*step*, *choice*, *outcome*, *action*).

- **Runtime**: JSON graph rendered client‑side with analytics on each
  transition.

- **Actions**:

  - *open_case* → pre‑fills Support case type & fields (§1.15)
  - *open_form* → opens embedded form (e.g., "request payout review")
  - *link_article* → deep‑link to a detailed how‑to

- **Versioning**: any change creates a new *article_version* entry; last
  stable version used by default.

## **1.20.8 Authoring workflow & governance**

- Roles: **Contributor** (draft), **Editor** (edit/publish),
  **Legal/Policy Reviewer** (approve policy articles), **Localization**
  (translate, review).
- **Review cycle**: nightly job marks *review_status* to *due*/*overdue*
  based on *review_interval_days*; dashboard shows backlog.
- **Link checker**: CI job validates external links and internal
  anchors; broken links open a task.
- **Internal vs public**: only *public* articles enter sitemaps and
  JSON‑LD.

## **1.20.9 SEO specifics (ties to §1.17)**

- **Sitemaps**: */sitemap-help.xml* chunked by locale; include
  *lastmod*.
- **Canonical**: */help/{slug}* canonicalizes to itself; legacy slugs
  301 via *kb.redirect*.
- **FAQPage** schema only when *faq_json* present and visibility is
  public.
- **Noindex**: internal or very short (\<150 words) articles set
  *noindex,follow*.

## **1.20.10 Feedback, deflection & analytics**

- **Thumbs helpful/unhelpful** with optional comment (sanitized); store
  in *kb.article_feedback*.
- **Deflection metric**: if a user visits help within **15 minutes**
  *before* abandoning a support form **or** within **5 minutes** of a
  case *not being created*, count as def