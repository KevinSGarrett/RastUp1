<!-- id: TD-0166 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 597600-601600 -->

olean not null default false*\
*);*\
\
*\-- Request → Accept / Decline / Counter (Custom Offer)*\
*create table booking.request (*\
*request_id text primary key, \-- req\_\...*\
*mode booking_mode not null,*\
*order_id text not null, \-- binds to a draft order*\
*buyer_user_id text not null,*\
*provider_user_id text not null,*\
*status text not null check (status in
(\'pending\',\'accepted\',\'declined\',\'countered\',\'expired\')),*\
*message text,*\
*expires_at timestamptz,*\
*created_at timestamptz default now()*\
*);*\
\
*\-- Smart Invite fan-out recipients*\
*create table booking.invite_recipient (*\
*invite_id text,*\
*recipient_user_id text,*\
*status text not null check (status in
(\'new\',\'responded\',\'awarded\',\'not_awarded\')),*\
*primary key (invite_id, recipient_user_id)*\
*);*\
\
*\-- Milestones (deliverable-based jobs)*\
*create table booking.milestone (*\
*milestone_id text primary key,*\
*order_id text not null,*\
*title text not null,*\
*due_ts timestamptz,*\
*amount_cents int not null, \-- portion of subtotal*\
*status text not null check (status in
(\'open\',\'delivered\',\'approved\',\'disputed\',\'refunded\'))*\
*);*\
\
*\-- Disputes*\
*create table booking.dispute (*\
*dispute_id text primary key, \-- dsp\_\...*\
*order_id text not null,*\
*opened_by text not null, \-- buyer or provider*\
*reason text not null,*\
*description text,*\
*status text not null check (status in
(\'open\',\'awaiting_evidence\',\'under_review\',\'resolved_buyer\',\'resolved_provider\',\'split\',\'chargeback\')),*\
*created_at timestamptz default now(),*\
*updated_at timestamptz default now()*\
*);*\
\
*commit;*\

**Studio damage deposits** (auth‑only holds) live in §1.24 schema;
talent bookings do not use deposit holds at launch. (Cross‑ref only; no
duplication here.)

## **1.3.4 GraphQL API (AppSync)**

**Recommended path:** *api/schema/booking.graphql*

*enum BookingMode { IB RTB INVITE }*\
*enum BookingStatus {*\
*INITIATED PENDING_ACCEPT COUNTERED ACCEPTED DECLINED*\
*CONFIRMED IN_PROGRESS DELIVERED COMPLETED*\
*CANCELLED_BUYER CANCELLED_PROVIDER DISPUTED RESOLVED*\
*}*\
\
*type LineItem { id: ID!, kind: String!, title: String!, qty: Float!,
unitCents: Int!, totalCents: Int! }*\
*type Milestone { id: ID!, title: String!, dueTs: AWSDateTime,
amountCents: Int!, status: String! }*\
\
*type Order {*\
*id: ID!, buyerId: ID!, providerId: ID!, serviceProfileId: ID!,*\
*mode: BookingMode!, status: BookingStatus!,*\
*startTs: AWSDateTime!, endTs: AWSDateTime!,*\
*locationKind: String!, city: String,*\
*licenseTier: String, subtotalCents: Int!, platformFeeCents: Int!,
taxCents: Int!, tipCents: Int!, totalCents: Int!,*\
*lineItems: \[LineItem!\]!, milestones: \[Milestone!\]!,*\
*chatThreadId: ID*\
*}*\
\
*input StartOrderInput {*\
*serviceProfileId: ID!, mode: BookingMode!, packageId: ID,*\
*startTs: AWSDateTime!, endTs: AWSDateTime!, city: String, locationKind:
String!,*\
*extras: \[ID!\], licenseTier: String, travelMiles: Float*\
*}*\
*input CounterOfferInput { orderId: ID!, newStartTs: AWSDateTime,
newEndTs: AWSDateTime, lineItemChanges: AWSJSON }*\
*input AcceptInput { requestId: ID! }*\
*input DeclineInput { requestId: ID!, reason: String }*\
*input ConfirmIBInput { orderId: ID! } \# IB fast path*\
*input CreateInviteInput { brief: String!, recipients: \[ID!\]!,
startTs: AWSDateTime!, endTs: AWSDateTime!, packageId: ID, budgetCents:
Int }*\
*input AwardInviteInput { inviteId: ID!, recipientId: ID! }*\
*input CompleteInput { orderId: ID!, milestoneId: ID } \# time- or
deliverable-based*\
*input DisputeInput { orderId: ID!, reason: String!, description: String
}*\
\
*type Query {*\
*order(id: ID!): Order*\
*myOrders(page: Int = 1): \[Order!\]!*\
*myRequests(page: Int = 1): \[AWSJSON!\]!*\
*}*\
\
*type Mutation {*\
*startOrder(input: StartOrderInput!): ID! \@auth(role: \"user\")*\
*sendRequest(orderId: ID!, message: String): ID! \@auth(role:
\"user\")*\
*confirmInstantBook(input: ConfirmIBInput!): Boolean! \@auth(role:
\"user\")*\