<!-- id: TD-0001 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 3600-7600 -->

omplete Zod schemas on request; they are
200+ lines and omitted here to keep this section readable.)*

**1.1.Q Availability model & conflict rules**

- *availability_json* is **advisory** for search hints; authoritative
  blocks come from accepted booking legs.
- When creating a draft or confirming a booking leg, we check **overlaps
  across all SPs** owned by the same account and across any **studio
  listing** the account owns if the owner will be present/required.
- Conflict outcomes: warn on soft conflicts (availability windows);
  hard-block on accepted overlaps unless the user explicitly opts for
  back-to-back with buffer (configurable minimum, e.g., 60 min).

**Overlap detection (UTC):**

- Normalize proposed *(start,end)* to UTC; query legs for the owner in
  *\[start-buffer, end+buffer\]*.
- If any accepted leg overlaps → reject; if pending holds overlap → show
  conflict UI with manage options.

**1.1.R Typesense/OpenSearch schemas & analyzers**

**People index (*****people_v1*****)**

- Fields: *id (string)*, *userId*, *role*, *city*, *geo* (lat,lon),
  *isPublished* (bool), *completenessScore (int)*, *instantBook (bool)*,
  *ratingAvg (float)*, *ratingCount (int)*, *priceFromCents (int)*,
  *verification.id (bool)*, *verification.bg (bool)*,
  *verification.social (bool)*, *availabilityBuckets (string\[\])*,
  *genres/specialties (string\[\])*, **selected role filters** (e.g.,
  *height_cm*, *studio_access*).
- Facets: *role*, *city*, *verification.id*, *instantBook*,
  *genres/specialties*, price buckets (derived).
- Sorting: *\_text_match* → *verification.id desc* → *ratingAvg desc* →
  *abs(priceFromCents - queryBudget) asc* → *created_at desc*.

**Studios index (*****studios_v1*****)**

- Fields: *id*, *city*, *geo*, *amenities (string\[\])*,
  *depositRequired (bool)*, *verifiedStudio (bool)*, *ratingAvg*,
  *ratingCount*.
- Facets: *city*, *amenities*, *verifiedStudio*.

**Analyzers & normalization**

- Lowercase/ASCII fold; synonyms for common tags (e.g., "glamour" \~
  "glam"); numeric filters for height/price.
- Safe-Mode filtering occurs in the query layer: if Safe-Mode=ON →
  exclude *nsfw_band=2* assets from cards; prefer blur on 1.

**Index refresh & backfill**

- Mutation outbox → indexer Lambda; nightly full backfill per city;
  integrity check (counts vs DB) with alert if \>1% deviation.

**1.1.S Content-safety thresholds & pipelines**

- **Upload path:** client → signed S3 upload (previews only) → SQS →
  Lambda scan.

- **Scanner result →** ***nsfw_band*****:**

  - 0 = Allow (public thumbnail fine)
  - 1 = Blur (mild adult; blur radius 8--16)
  - 2 = Block (explicit; no public display)

- **Appeals:** owner submits appeal; T&S reviews; on override, we store
  *override_reason*, *actor*, *timestamp*. All decisions audited.

**1.1.T Admin RBAC (for this section)**

  ------------------ ---------------------------------------------- -------------------------------------- -------------------------------
  **Admin role**     **Can view**                                   **Can edit**                           **Approvals required**
  Support            SP/studio status, completeness, basic fields   Unpublish SP/studio on policy breach   1 approver
  Trust & Safety     NSFW decisions, overrides, link removals       Override scan; set *nsfw_band*         2-person approval
  Promotions         N/A (1.1 only)                                 N/A                                    N/A
  City Ops           City allowlists for visibility                 Toggle city gate on SP exposure        2-person on city gate changes
  Finance            N/A                                            N/A                                    N/A
  Legal/Compliance   Audit log access                               Lock records (litigation hold)         2-person
  ------------------ ---------------------------------------------- -------------------------------------- -------------------------------

All admin actions write imm