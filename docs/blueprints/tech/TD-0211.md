<!-- id: TD-0211 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 759600-763600 -->

Aurora Postgres** (*pay*, *acc* schemas) for ledger, quotes,
    invoices, payouts, policy snapshots.
  - **S3** for PDF receipts/invoices (private); **CloudFront signed
    URLs** for downloads.
  - **Event bus**: *checkout.initiated*, *payment.captured*,
    *payout.released*, *refund.issued*, *dispute.\** →
    analytics/notifications.

- **Cost posture**: Serverless functions; minimal Stripe premium
  features at MVP; caching price/tax lookups; avoid unnecessary Radar
  add‑ons initially.

## **1.13.3 Data model --- DDL artifacts**

Create *db/migrations/021_pay_core.sql*:

*begin;*\
\
*\-- Accounts / Connect linkages (refs §1.7 IDV gates)*\
*create table acc.provider_connect (*\
*user_id text primary key,*\
*stripe_acct text not null, \-- acct\_\...*\
*status text not null check (status in
(\'pending\',\'restricted\',\'active\')),*\
*requirements jsonb not null default \'{}\',*\
*updated_at timestamptz default now()*\
*);*\
\
*\-- Quote created prior to PaymentIntent creation*\
*create table pay.quote (*\
*quote_id text primary key, \-- qte\_\...*\
*order_id text, \-- created post-payment*\
*buyer_id text not null,*\
*provider_id text not null,*\
*role_code text not null, \-- role context*\
*currency text not null default \'USD\',*\
*subtotal_cents int not null,*\
*platform_fee_cents int not null default 0,*\
*tax_cents int not null default 0,*\
*deposit_cents int not null default 0, \-- if deposit model enabled*\
*total_cents int not null,*\
*policy_snapshot jsonb not null, \-- cancellation/refund policy at time
of quote*\
*created_at timestamptz default now()*\
*);*\
\
*\-- Payment transaction envelope*\
*create table pay.txn (*\
*txn_id text primary key, \-- txn\_\...*\
*quote_id text not null,*\
*stripe_pi text, \-- pi\_\... PaymentIntent*\
*stripe_ch text, \-- ch\_\... Charge (cards)*\
*method text not null check (method in
(\'card\',\'apple_pay\',\'google_pay\',\'ach\')),*\
*status text not null check (status in
(\'requires_action\',\'authorized\',\'captured\',\'refunded\',\'failed\',\'canceled\')),*\
*authorized_at timestamptz,*\
*captured_at timestamptz,*\
*amount_cents int not null,*\
*fee_cents int not null default 0, \-- platform fee realized*\
*tax_cents int not null default 0,*\
*meta jsonb not null default \'{}\',*\
*created_at timestamptz default now(),*\
*updated_at timestamptz default now()*\
*);*\
\
*\-- Payouts (Stripe Connect transfers and payout status)*\
*create table pay.payout (*\
*payout_id text primary key, \-- pot\_\...*\
*provider_id text not null,*\
*stripe_transfer text, \-- tr\_\...*\
*stripe_payout text, \-- po\_\...*\
*currency text not null default \'USD\',*\
*gross_cents int not null,*\
*fee_cents int not null default 0, \-- Stripe/FX fees we pass-through or
absorb*\
*net_cents int not null,*\
*status text not null check (status in
(\'scheduled\',\'in_transit\',\'paid\',\'failed\',\'canceled\',\'needs_review\')),*\
*scheduled_on date not null,*\
*created_at timestamptz default now(),*\
*updated_at timestamptz default now()*\
*);*\
\
*\-- Refunds (partial or full)*\
*create table pay.refund (*\
*refund_id text primary key, \-- rfd\_\...*\
*txn_id text not null references pay.txn(txn_id) on delete cascade,*\
*stripe_ref text, \-- re\_\...*\
*amount_cents int not null,*\
*reason text not null,*\
*status text not null check (status in
(\'pending\',\'succeeded\',\'failed\',\'canceled\')),*\
*created_by text not null, \--
\'system\',\'buyer\',\'provider\',\'admin\'*\
*created_at timestamptz default now(),*\
*updated_at timestamptz default now()*\
*);*\
\
*\-- Disputes / chargebacks*\
*create table pay.dispute (*\
*dispute_id text primary key, \-- dsp\_\...*\
*txn_id text not null references pay.txn(txn_id) on delete cascade,*\
*stripe_dispute text, \-- dp\_\...*\
*reason text,*\
*status text not null check (status in
(\'needs_response\',\'under_review\',\'won\',\'lost\',\'warning_closed\')),*\
*evidence_s3 text, \-- zipped evidence bundle path*\
*due_by timestamptz,*\
*created_at timestamptz d