<!-- id: TD-0030 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 108000-112000 -->

t null,*\
*verified boolean not null default false,*\
*snapshot_json jsonb, \-- follower counts, ER, etc. (non-secret)*\
*last_checked_at timestamptz*\
*);*\
\
*\-- Trust badges (derived)*\
*create table trust_badge (*\
*badge_id text primary key, \-- tbg\_\...*\
*user_id text not null,*\
*kind text not null check (kind in
(\'id_verified\',\'trusted_pro\',\'social_verified\')),*\
*source_id text, \-- idv_id, bg_id, or soc_id*\
*issued_at timestamptz not null default now(),*\
*expires_at timestamptz \-- optional expiry for recert*\
*);*\
\
*\-- Risk signals snapshots*\
*create table trust_risk_signal (*\
*signal_id text primary key, \-- rsk\_\...*\
*user_id text not null,*\
*window daterange not null, \-- \[start,end)*\
*disputes_opened int not null default 0,*\
*refunds_asked int not null default 0,*\
*cancellations int not null default 0,*\
*late_delivery int not null default 0,*\
*charge_failures int not null default 0,*\
*bad_clicks int not null default 0,*\
*flags_json jsonb not null default \'{}\'::jsonb,*\
*score int not null default 0, \-- aggregate score (0-100; lower is
riskier)*\
*computed_at timestamptz not null default now()*\
*);*\

**DynamoDB (hot path cache):** a small *trust_cache* item per user (IDV
passed?, Trusted Pro?, social verified?, risk score) to avoid DB round
trips on search and booking.

## **1.6.C Adapters (IDV, BG, Social) --- contracts**

**Common adapter shape (idempotent):**

- *start(user_id, params)* → *{ provider_ref,
  redirect_url/embedded_session }*
- *status(provider_ref)* → status enum + minimal signals (no raw PII)
- *webhook(event)* → HMAC verified; dedupe by provider_event_id
- Emits normalized events: *idv.started\|passed\|failed\|expired*,
  *bg.invited\|clear\|consider\|disputed\|expired*,
  *social.verified\|revoked*, all correlated by *user_id*.

**IDV provider options** (choose one; both fit the contract):

- **Persona** or **Stripe Identity**. We default to **Persona** for
  breadth; Stripe Identity is acceptable if cost/licensing or Stripe
  consolidation is preferred.

**BG provider**:

- **Checkr** with FCRA flow; alternative vendors possible with same
  contract.

**Social**:

- **Instagram Graph / TikTok / YouTube / X** OAuth; nightly snapshot;
  **verified** when OAuth proof valid and platform marks the account
  verified (or our threshold met).

## **1.6.D Badge logic, gates & expiration**

- **ID Verified (badge)** → issued when IDV status transitions to
  *passed* and *age_verified = true*.
- **Trusted Pro (badge)** → issued when BG status == *clear* with no
  pending adverse action.
- **Social Verified (badge)** → issued when OAuth verified AND snapshot
  passes thresholds (e.g., follower minimum or platform verification).

**Expiration / recert (configurable):**

- IDV: re-verify after 24 months (or upon provider signal).
- BG: re-check annually or upon key incidents (dispute rate spike).
- Social: nightly refresh; badge revoked if OAuth disconnects or signals
  stale \> N days.

**Gates driven by badges:**

- **Instant Book** requires **ID Verified** (+ optionally minimum
  reputation).
- **Fan-sub role visibility** requires **age_verified** and Safe-Mode
  OFF by adult viewers.
- **Search boosts**: ID Verified \> Social Verified \> Trusted Pro
  (configurable weights); Trusted Pro may also unlock promotions
  eligibility.

## **1.6.E GraphQL API (user-facing flows)**

*type IdvSession { provider: String!, url: String, clientToken: String
}*\
*type BgInvitation { provider: String!, url: String }*\
\
*type TrustStatus {*\
*idVerified: Boolean!*\
*ageVerified: Boolean!*\
*trustedPro: Boolean!*\
*socialVerified: Boolean!*\
*riskScore: Int!*\
*lastIdvAt: AWSDateTime*\
*lastBgAt: AWSDateTime*\
*}*\
\
*type Query {*\
*trustStatus: TrustStatus!*\
*socialConnections: \[SocialConnection!\]!*\
*}*\
\
*type Mutation {*\
*startIdv: IdvSession! \# create new provider session*\
*refreshIdvStatus: TrustStatus! \# polling fallback*\
*startBackgroundCheck: BgInvitation! \# sends FC