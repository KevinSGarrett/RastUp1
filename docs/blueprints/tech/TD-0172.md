<!-- id: TD-0172 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 619200-623200 -->

:

  - **Action Required** --- threads containing pending **Action Cards**
    or **Message Requests** awaiting the user.
  - **Bookings** --- threads linked to confirmed orders or studio
    bookings.
  - **Offers/Requests** --- RTB/Smart Invite negotiations not yet
    confirmed.
  - **Archived** --- user archived.
  - **Spam/Blocked** --- declined/blocked senders; auto‑purged after N
    days.

- **Thread list cells** show: avatar(s), subject, last snippet, badges
  (**IB**, **Verified Studio**, **Pending Request**, **Action
  Required**), unread count.

- **Search** (Typesense): participants, words in **text** and **card**
  payload titles, attachment names (not full contents), date range,
  "has:cardType".

- **Pin & mute**: pin a thread to top; mute until a date/time or
  indefinitely; **Quiet Hours** globally suppress push between times
  (but keep inbox counters).

## **1.4.6 Action Cards (structured flows inside chat)**

All cards are **messages** with a typed *cardType* and *cardPayload*.
Cards support **Accept / Decline / Counter** where appropriate and drive
order updates (cross‑refs to §1.3/§1.24).

2804. Propose/Reschedule

      b.  Payload: *oldStart*, *oldEnd*, *newStart*, *newEnd*, *reason*.
      c.  Accept → updates the order/line item; conflicts trigger an
          error card.
      d.  Decline → thread note only.

2805. Extras / Overtime

      e.  Payload: *items\[\]* (title, qty, unitCents), *why*.
      f.  Accept → creates **adjustment** line items and either charges
          immediately (if captured) or at payout reconciliation.
      g.  Studio overtime can consume **deposit** before new charge (per
          policy).

2806. Proofs / Approvals

      h.  Payload: *gallery\[\]* (s3KeyWeb, thumb, count), *expiresAt*.
      i.  Buyer can **Approve** or **Request Changes** (with
          notes/markers).
      j.  On approve, triggers **milestone complete** (for
          deliverable‑based jobs).

2807. Expense / Receipt

      k.  Payload: *receipt{amountCents, image, merchant, date}*
      l.  Accept → adds to payouts or new charge (if buyer‑payable).
      m.  Good for travel, props, studio cleaning receipts.

2808. Mark Complete / Deliver

      n.  Payload: *what* (*time_based* \| *milestone_id*), *notes*.
      o.  Starts buyer's **review window**; on lapse, auto‑release
          payout.

2809. Dispute

      p.  Payload: *reason*, *details*, optional *evidence\[\]*.
      q.  Creates **dispute_case** and pauses affected payout; opens
          Admin case (T&S) with SLA.

2810. Safety Flag / Report

      r.  Payload: *reason*, *notes*.
      s.  Soft‑blocks thread, restricts new messages pending review;
          Admin case created.

**Card security**: all server‑validated (no client‑side totals). Card
execution writes **immutable audit** entries.

## **1.4.7 Message Requests & Anti‑circumvention**

- **Gated start**: new contact → *message_request_gate* created for the
  recipient. Inbox shows a preview card with **Accept / Decline /
  Block**.
- **Heuristics**: gates more aggressively for brand‑new senders (age,
  verification, prior accept ratio, text entropy).
- **Anti‑circumvention nudges**: detect phrases like off‑platform
  payment requests; show banner: "Keep payment on RastUp for
  protection." Repeated attempts → **throttle** or **soft block**.
- **Credit / contact filters** (from non‑technical spec): large‑blast
  attempts or template spam are slowed; per‑hour caps applied via Dynamo
  *msg_rate*.

## **1.4.8 Notifications & Digests**

- **Real‑time**: push (FCM/APNs) + email for mentions, card requests,
  gate accepts, RTB actions, booking confirmations, reschedules.
- **Digest**: daily/weekly depending on preference; sections (*New
  requests*, *Pending approvals*, *Upcoming bookings* with ICS links).
- **ICS attachments**: confirmed bookings include **.ics** to add to
  calendars. (Two‑way sync is covered in §1.24 Phase 2.)
- **Preference schema** (per user): channel toggles per 