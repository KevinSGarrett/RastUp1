<!-- id: TD-0252 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 907200-911200 -->

;
  kill‑switch.

**Estimators**

- CUPED for mean‑difference metrics; Bayesian beta‑binomial for rates.
- **MDE** calculator used before launch; sample size gate.
- Reporting: dbt builds *fact_experiment_result* with lift,
  p‑values/credible intervals, time‑to‑decision.

**Compliance**

- No cloaking; crawler sees control variant for public SEO pages
  (§1.17).
- Experiments never change legal texts or consent components.

## **1.21.9 Metrics catalogue (canonical definitions)**

**Marketplace health**

- *Search→View CTR*, *View→Message rate*, *Message→CheckoutStart*,
  *CheckoutStart→Complete*, *Refund rate*, *Dispute rate*, *Chargeback
  win rate*.
- *Time to first booking* (new profile/studio), *Repeat booking rate*
  (7/30/90).
- *Supply freshness* (updated in last 30 days), *Availability coverage*
  (slots next 14 days).

**Growth**

- Email/digest CTR, alert CTR, referral qualification, ROAS (for promos
  §1.20).
- SEO: Non‑brand clicks, CTR on top 100 landings, indexation rate.

**Support**

- FRT/TTR, auto‑resolved %, DMCA cycle time, SLA breach count.

**Quality & safety**

- SFW violation rate (public surfaces), doc verification lag, takedown
  propagation time.

**Standard SQL snippets** are stored in *analytics/metrics/\*.sql* and
referenced by dashboards to avoid drift.

## **1.21.10 Observability & reliability**

- **Drift**: schema‑registry check fails CI if an event payload
  adds/removes required fields.
- **Loss**: compare *app.start* count vs. delivered events per time
  bucket; alarm if \<95%.
- **Lag**: measure ingest→silver and silver→gold latencies; p95 budgets
  (e.g., 5 min / 30 min).
- **Dead‑letter**: invalid events go to *s3://analytics/dlq/* with
  reason; daily triage.
- **Dashboards**: pipeline health, event volume by type, top schemas by
  change rate.

## **1.21.11 Privacy, consent & DSAR**

- **Consent** stored per identity; marketing pixels fire only when
  *consent.marketing=true*.
- **PII**: disallow arbitrary PII keys; hardcoded allowlist only.
- **DSAR delete**: job scans *identity_id* and *user_id* across
  Bronze/Silver/Gold (including *fact_experiments* and
  *fact_attribution\_\**) and replaces with tombstones; purge cache
  keys.
- **Data retention**: raw 25 months, derived 36 months (configurable).
- **Access**: RBAC via Lake Formation (read‑only analysts, restricted
  tables for Support/Finance with views).

## **1.21.12 Cost posture**

- **Ingest Lambda**: low‑compute JSON validation; average \<50ms; keep
  warm disabled.
- **Storage**: Parquet/Iceberg compression; partition pruning by
  *event_dt*.
- **Transform**: *dbt* on Athena (serverless) for daily models; Redshift
  Serverless only for high‑QPS dashboards.
- **BI**: QuickSight reader pricing or Superset (open‑source) to keep
  per‑seat cost low.
- **Scale plan**: if QPS or joins exceed Athena comfort, promote hot
  Gold models to Redshift materialized views.

## **1.21.13 Suggested modules (open‑source/paid)**

- **Open‑source**:

  - **PostHog (self‑hosted)** for session/web analytics → forward to S3
    (optional).
  - **Apache Superset** for BI if you prefer OSS over QuickSight.
  - **dbt Core** with **dbt‑athena** adapter for modeling.

- **Paid (elastic, optional)**:

  - **QuickSight** (pay‑per‑session) for exec dashboards.
  - **Mixpanel/Amplitude** as a thin client layer while keeping S3 as
    source of truth (events dual‑written).

If we disagree with using any suggested module later, we can substitute
the AWS‑native path above with minimal friction.

## **1.21.14 Work packages (Cursor --- 4 agents)**

- **Agent A --- Ingest & Contracts**: API Gateway/Lambda */e*, JSON
  schema registry & validator, Bronze S3 writer, DLQ.
- **Agent B --- Lake & Models**: Iceberg tables, CTAS to Silver, dbt
  project for Gold (sessions, funnels, attribution, experiments).
- **Agent C --- Experiments**: assignment, exposures, CUPED/Bayesian
  estimators, SRM alerts, results table & API.
- **Agent D --- Dashboards & Ops**: QuickSig