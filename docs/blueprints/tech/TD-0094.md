<!-- id: TD-0094 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 338400-342400 -->

tId: ID!, targetKind: String!): Boolean!*\
*unfollow(targetId: ID!, targetKind: String!): Boolean!*\
\
*sendReferral(programId: ID!, inviteeEmail: String!): Boolean!*\
*redeemCredit(entryId: ID!, amountCents: Int!): Boolean! \# buyer fee
only scope validated server-side*\
*}*\

**Server guards**: Safe‑Mode checks in feed; per‑search daily dedupe;
per‑user referral caps; ID/age gate for credit redemption where
required.

## **1.16.J Comms & templates**

- **Saved search alert** (daily cap)
- **Weekly city digest** (opt‑in)
- Book again 7/30/90
- **Referral invite** and **award** confirmations\
  All templates deliver **SFW** previews only and include **preference
  links**.

NonTechBlueprint

## **1.16.K Telemetry & experiments (hooked into §1.13)**

- **Events**: *search.saved\|alert.sent\|alert.click*,
  *feed.post.publish\|impression\|click*, *sharecard.create\|click*,
  *lib.microsite.visit*, *book_again.sent\|clicked\|converted*,
  *referral.invite\|accepted\|qualified\|clawback*.
- **Gold KPIs**: alert CTR, digest CTR, follow growth, feed engagement,
  book‑again conversion, referral qualification rate, fraud/clawback
  rate.
- **Guardrails**: unsubscribe/complaint rates; Safe‑Mode breaches
  (should be zero for emails).
- **NRT** ops tiles: today's alerts/digests volume, referral awards vs
  caps, clawbacks.

## **1.16.L Performance & cost**

- **Schedulers**: EventBridge scheduled Lambdas (cron & daily); no
  long‑running workers.
- **Search**: pre‑compute **match hashes** to reduce index scans for
  alerts; use Typesense filters efficiently.
- **Storage**: S3 for sharecards, lifecycle → Intelligent‑Tiering \@30d;
  CloudFront cache hits ≥95%.
- **Email**: SES shared IPs; digest batches to keep costs low.
- **Dynamo**: TTL‑based dedupe tables; RCU/WCU caps.
- **Budgets**: alarms on SES sends/day, Lambda duration, Dynamo
  capacity.

## **1.16.M Error taxonomy (client‑safe)**

- *ALERT_FREQUENCY_LIMIT* --- already sent today for this search.
- *DIGEST_OPTOUT* --- user unsubscribed.
- *SAFE_MODE_BLOCKED* --- attempting to include 18+ in email.
- *REFERRAL_CAP_EXCEEDED* --- monthly cap reached.
- *CREDIT_SCOPE_VIOLATION* --- tried to apply buyer credit to non‑fee
  items.
- Each error returns *code*, *message*, *hint*, and *corrId*.

## **1.16.N Test plan (CI + sandbox)**

**Saved searches & alerts**

1751. ANY/ALL correctness; Safe‑Mode gates; 1/day frequency; 30‑day
      pause respected; alert contains only *new* matches.

NonTechBlueprint

NonTechBlueprint

**Weekly digest**\
2) Opt‑in/out; city content blocks; no 18+ previews in email.

NonTechBlueprint

NonTechBlueprint

**Feed & follow**\
3) Unified feed with role tabs; Verified chip; SFW previews on public;
pagination stable.

NonTechBlueprint

**Sharecards & link‑in‑bio**\
4) Image renders for IG/TT; QR & UTM present; attribution shows in §1.13
marts.

NonTechBlueprint

**Book again**\
5) 7/30/90 schedule; prefill scope; opt‑out honored; conversions
attributed.

NonTechBlueprint

**Referrals & credits**\
6) Program qualifications (publish package / post brief / award +
complete); monthly caps; device/IP checks; clawback on fraud/refund.

NonTechBlueprint

**Telemetry & cost**\
7) Events land Bronze→Silver→Gold; dashboards populate;
SES/Lambda/Dynamo within budgets.

## **1.16.O Work packages (Cursor 4‑agent lanes)**

- **Agent B --- Domain/API**: Saved Search, Feed, Referrals SQL +
  resolvers; daily/weekly schedulers; credit ledger; book‑again job.
- **Agent C --- Search/Index**: ANY/ALL query builder; match hash
  generation; Verified/Trusted facets.
- **Agent A --- Web**: Saved Search UI (ANY/ALL builder), Feed with role
  tabs & Verified chip, link‑in‑bio page, sharecard UI.
- **Agent D --- Comms/QA**: MJML templates
  (alerts/digest/book‑again/referrals), SES setup, test automation for
  dedupe and caps.

## **1.16.P Acceptance criteria (mark §1.16 FINAL only when ALL true)**

1756. Saved Searches support ANY/ALL, Safe‑Mode filters, and **≤1/day**
      alert