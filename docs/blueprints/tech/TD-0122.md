<!-- id: TD-0122 | source: ProjectPlans\TechnicalDevelopmentPlan.odt | range: 439200-443200 -->

le**: defaults ON for guests/new installs; SFW
      previews only; 18+ features gated behind age verification and
      explicit user choice, never emailed or pushed with previews.
2048. **Cost‑conscious:** APNs/FCM via Amazon **Pinpoint/SNS**, no extra
      third‑party SDK bloat; media uploads are direct‑to‑S3 presigned,
      resized on device.
2049. **Accessibility**: WCAG mobile patterns, large tap targets,
      VoiceOver/TalkBack tested, motion‑safe animations.
2050. **Privacy**: no background location; images EXIF stripped on
      upload (unless user opts in for studio proofs).

## **1.20.B Client architecture**

- **PWA shell** (Next.js): app‑router, service worker, manifest, edge
  caching; GraphQL via AppSync (JWT auth).

- **Native shells** (optional):

  - **React Native** + **Expo** (managed workflow) for iOS/Android.
  - Uses a small native bridge for push tokens, file pickers, camera,
    and device storage; renders either RN screens or a WebView wrapper
    for certain flows if we choose a hybrid approach.

- **Shared modules**: auth/session, GraphQL client, feature flags,
  Safe‑Mode, formatting (ICU), and analytics events shared across PWA
  and RN.

## **1.20.C PWA configuration (manifest, SW, caching, offline)**

**Recommended path:** *web/public/manifest.webmanifest*

*{*\
*\"name\": \"RastUp\",*\
*\"short_name\": \"RastUp\",*\
*\"start_url\": \"/?source=pwa\",*\
*\"display\": \"standalone\",*\
*\"background_color\": \"#0e1116\",*\
*\"theme_color\": \"#0e1116\",*\
*\"icons\": \[*\
*{\"src\": \"/icons/icon-192.png\", \"sizes\": \"192x192\", \"type\":
\"image/png\"},*\
*{\"src\": \"/icons/icon-512.png\", \"sizes\": \"512x512\", \"type\":
\"image/png\"}*\
*\]*\
*}*\

**Service Worker** (Workbox‑style pseudocode)\
**Recommended path:** *web/public/sw.js*

*self.addEventListener(\'install\', e =\> {*\
*e.waitUntil(caches.open(\'rastup-precache-v1\').then(c =\>
c.addAll(\[*\
*\'/\', \'/city\', \'/styles.css\', \'/manifest.webmanifest\'*\
*\])));*\
*});*\
*self.addEventListener(\'fetch\', e =\> {*\
*const url = new URL(e.request.url);*\
*// HTML: NetworkFirst with fallback to cache*\
*if (e.request.mode === \'navigate\') {*\
*e.respondWith(fetch(e.request).then(r =\> {*\
*const copy = r.clone(); caches.open(\'rastup-pages\').then(c =\>
c.put(e.request, copy));*\
*return r;*\
*}).catch(() =\> caches.match(e.request) \|\| caches.match(\'/\')));*\
*return;*\
*}*\
*// Images: Stale-While-Revalidate*\
*if (url.pathname.startsWith(\'/\_next/image\') \|\|
url.pathname.startsWith(\'/images/\')) {*\
*e.respondWith(caches.open(\'img\').then(async c =\> {*\
*const cached = await c.match(e.request);*\
*const fresh = fetch(e.request).then(r =\> { c.put(e.request,
r.clone()); return r; });*\
*return cached \|\| fresh;*\
*}));*\
*}*\
*});*\

**Offline scope:** home, city pages, profile/studio detail (last
viewed), messages list (last page cached), compose drafts.

## **1.20.D Optional native shells (React Native + Expo)**

**Project layout**\
**Recommended path:** *apps/mobile/App.tsx*

*export default function App() {*\
*return (*\
*\<SafeAreaProvider\>*\
*\<NavigationContainer linking={linking}\>*\
*\<Stack.Navigator\>*\
*\<Stack.Screen name=\"Home\" component={HomeScreen}/\>*\
*\<Stack.Screen name=\"Messages\" component={MessagesScreen}/\>*\
*\<Stack.Screen name=\"Booking\" component={BookingScreen}/\>*\
*\<Stack.Screen name=\"Web\" component={WebViewScreen}/\> {/\* for
hybrid routes if needed \*/}*\
*\</Stack.Navigator\>*\
*\</NavigationContainer\>*\
*\</SafeAreaProvider\>*\
*);*\
*}*\

**Deep link config**\
**Recommended path:** *apps/mobile/linking.ts*

*export default {*\
*prefixes: \[\'rastup://\',\'https://rastup.com\'\],*\
*config: { screens: {*\
*Home: \'\',*\
*Messages: \'messages\',*\
*Booking: \'checkout/:id\',*\
*Profile: \'p/:handle\',*\
*Studio: \'s/:slug\'*\
*}}*\
*};*\

**Platform considerations (high‑level policy):** at launch, **PWA can be
primary**. If/when we publish native apps, limit the initial nati